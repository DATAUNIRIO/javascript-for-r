<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Shiny | R and JavaScript</title>
  <meta name="description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Shiny | R and JavaScript" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="github-repo" content="yihui/bookdown-crc" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Shiny | R and JavaScript" />
  
  <meta name="twitter:description" content="Invite JavaScript into your Data Science workflow." />
  

<meta name="author" content="John Coene" />


<meta name="date" content="2020-05-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="node.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>
<script src="libs/core-js/shim.min.js"></script>
<script src="libs/react/react.min.js"></script>
<script src="libs/react/react-dom.min.js"></script>
<script src="libs/reactwidget/react-tools.js"></script>
<script src="libs/reactable-binding/reactable.js"></script>
<script src="libs/r2d3-render/r2d3-render.js"></script>
<script src="libs/webcomponents/webcomponents.js"></script>
<script src="libs/r2d3-binding/r2d3.js"></script>
<script src="libs/d3v5/d3.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R and JavaScript</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i><b>0.1</b> Disclaimer</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a>
<ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#package-development"><i class="fa fa-check"></i>Package Development</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#json"><i class="fa fa-check"></i>JSON</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#javascript"><i class="fa fa-check"></i>JavaScript</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#rationale"><i class="fa fa-check"></i>Rationale</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#methods"><i class="fa fa-check"></i>Methods</a>
<ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#v8"><i class="fa fa-check"></i>V8</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#htmlwidgets"><i class="fa fa-check"></i>htmlwidgets</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#shiny"><i class="fa fa-check"></i>Shiny</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#reactr"><i class="fa fa-check"></i>reactR</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#bubble"><i class="fa fa-check"></i>bubble</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#r2d3"><i class="fa fa-check"></i>r2d3</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I JavaScript Computations</b></span></li>
<li class="chapter" data-level="2" data-path="the-v8-engine.html"><a href="the-v8-engine.html"><i class="fa fa-check"></i><b>2</b> The V8 Engine</a>
<ul>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#installation"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#basics"><i class="fa fa-check"></i>Basics</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#external-libraries"><i class="fa fa-check"></i>External Libraries</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#with-npm"><i class="fa fa-check"></i>With Npm</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#use-in-packages"><i class="fa fa-check"></i>Use in Packages</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="node.html"><a href="node.html"><i class="fa fa-check"></i><b>3</b> Node.js with Bubble</a>
<ul>
<li class="chapter" data-level="" data-path="node.html"><a href="node.html#basics-1"><i class="fa fa-check"></i>Basics</a></li>
<li class="chapter" data-level="" data-path="node.html"><a href="node.html#r-markdown-engine"><i class="fa fa-check"></i>R Markdown Engine</a></li>
<li class="chapter" data-level="" data-path="node.html"><a href="node.html#npm"><i class="fa fa-check"></i>Npm</a></li>
<li class="chapter" data-level="" data-path="node.html"><a href="node.html#use-in-packages-1"><i class="fa fa-check"></i>Use in Packages</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="shiny-1.html"><a href="shiny-1.html"><i class="fa fa-check"></i><b>4</b> Shiny</a>
<ul>
<li class="chapter" data-level="" data-path="shiny-1.html"><a href="shiny-1.html#static-files"><i class="fa fa-check"></i>Static Files</a></li>
<li class="chapter" data-level="" data-path="shiny-1.html"><a href="shiny-1.html#integration"><i class="fa fa-check"></i>Integration</a></li>
<li class="chapter" data-level="" data-path="shiny-1.html"><a href="shiny-1.html#from-r-to-javascript"><i class="fa fa-check"></i>From R to JavaScript</a></li>
<li class="chapter" data-level="" data-path="shiny-1.html"><a href="shiny-1.html#from-javascript-to-r"><i class="fa fa-check"></i>From JavaScript to R</a></li>
<li class="chapter" data-level="" data-path="shiny-1.html"><a href="shiny-1.html#external-library"><i class="fa fa-check"></i>External Library</a></li>
<li class="chapter" data-level="" data-path="shiny-1.html"><a href="shiny-1.html#serialisation"><i class="fa fa-check"></i>Serialisation</a></li>
<li class="chapter" data-level="" data-path="shiny-1.html"><a href="shiny-1.html#events-callbacks"><i class="fa fa-check"></i>Events &amp; Callbacks</a></li>
<li class="chapter" data-level="" data-path="shiny-1.html"><a href="shiny-1.html#as-a-package"><i class="fa fa-check"></i>As a Package</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R and JavaScript</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="shiny-1" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Shiny</h1>
<p>Shiny is by far most popular, if not the only, web framework for the R programming language. In this chapter, after brushing up on the necessary to include JavaScript in shiny applications, we explore how to blend the JavaScript language with our R server and front-end.</p>
<p>Then again, the aim is not to write a lot of convoluted JavaScript, on the contrary, it is to write as little as possible and demonstrate to the reader that it is often enough to greatly improve the user experience of shiny applications. Making shiny work with JavaScript can essentially be broken down into two operations: 1) passing data from the R server to the JavaScript client and 2) the other way around, from the client to the R server.</p>
<div id="static-files" class="section level2 unnumbered" number="">
<h2>Static Files</h2>
<p>In order to introduce JavaScript to shiny applications one must understand static files and how they work with the framework. Static files are files that are downloaded by the clients, in this case web browsers accessing shiny applications, as-is, these generally include images, CSS (<code>.css</code>), and JavaScript (<code>.js</code>).</p>
<p>If you are familiar with R package development, static files are to shiny applications what the “inst” directory is to an R package, those files are installed as-is and do not require further processing as opposed to the “src” folder which contains files that need compiling for instance.</p>
<p>There are numerous ways to run a shiny application locally; the two most used probably are <code>shinyApp</code> and <code>runApp</code>. The RStudio IDE comes with a convenient “Run” button when writing a shiny application, which when clicked actually uses the function <code>shiny::runApp</code> in the background, this function looks for said static files in the <code>www</code> directory and makes them available at the same path (<code>/www</code>). If you are building your applications outside of RStudio, you should either also use <code>shiny::runApp</code> or specify the directory which then allows using <code>shiny::shinyApp</code>. Note that this only applies locally, shiny server (community and pro) as well as <a href="https://www.shinyapps.io/">shinyapps.io</a> use the same defaults as the RStudio IDE and <code>shiny::runApp</code>.</p>
<p>In order to ensure the code in this book can run regardless of the reader’s machine or editor, the asset directory is always specified explicitly. This is probably advised to steer clear of the potential headaches as, unlike the default, it’ll work regardless of the environment. If you are using <a href="https://thinkr-open.github.io/golem/">golem</a> <span class="citation">(Guyader et al. <a href="#ref-R-golem" role="doc-biblioref">2020</a>)</span> to develop your application then you should not worry about this as it specifies the directory internally.</p>
<p>Below we build a basic shiny application, however, before we define the ui and server we use the <code>shiny::addResourcePath</code> function to specify the location of the directory of static files that will be served by the server and thus accessible by the client. This function takes two arguments, first the <code>prefix</code>, which is the path (URL) at which the assets will be available, second the path to the directory of static assets.</p>
<p>We thus create the “assets” directory and a JavaScript file called <code>script.js</code> within it.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="shiny-1.html#cb115-1"></a><span class="co"># run from root of app (where app.R is located)</span></span>
<span id="cb115-2"><a href="shiny-1.html#cb115-2"></a><span class="kw">dir.create</span>(<span class="st">&quot;assets&quot;</span>)</span>
<span id="cb115-3"><a href="shiny-1.html#cb115-3"></a><span class="kw">writeLines</span>(<span class="st">&quot;console.log(&#39;Hello JS!&#39;);&quot;</span>, <span class="dt">con =</span> <span class="st">&quot;assets/script.js&quot;</span>)</span></code></pre></div>
<p>We can now use the <code>shiny::addResourcePath</code> to point to this directory. Generally the same name for the directory of static assets and prefix is used so as to avoid confusion, below we name them differently in order for the reader to clearly distinguish which is which.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="shiny-1.html#cb116-1"></a><span class="co"># app.R</span></span>
<span id="cb116-2"><a href="shiny-1.html#cb116-2"></a><span class="kw">library</span>(shiny)</span>
<span id="cb116-3"><a href="shiny-1.html#cb116-3"></a></span>
<span id="cb116-4"><a href="shiny-1.html#cb116-4"></a><span class="co"># serve the files</span></span>
<span id="cb116-5"><a href="shiny-1.html#cb116-5"></a><span class="kw">addResourcePath</span>(</span>
<span id="cb116-6"><a href="shiny-1.html#cb116-6"></a>  <span class="co"># will be accessible at /files</span></span>
<span id="cb116-7"><a href="shiny-1.html#cb116-7"></a>  <span class="dt">prefix =</span> <span class="st">&quot;files&quot;</span>, </span>
<span id="cb116-8"><a href="shiny-1.html#cb116-8"></a>  <span class="co"># path to our assets directory</span></span>
<span id="cb116-9"><a href="shiny-1.html#cb116-9"></a>  <span class="dt">directoryPath =</span> <span class="st">&quot;assets&quot;</span></span>
<span id="cb116-10"><a href="shiny-1.html#cb116-10"></a>)</span>
<span id="cb116-11"><a href="shiny-1.html#cb116-11"></a></span>
<span id="cb116-12"><a href="shiny-1.html#cb116-12"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb116-13"><a href="shiny-1.html#cb116-13"></a>  <span class="kw">h1</span>(<span class="st">&quot;R and JavaScript&quot;</span>)</span>
<span id="cb116-14"><a href="shiny-1.html#cb116-14"></a>)</span>
<span id="cb116-15"><a href="shiny-1.html#cb116-15"></a></span>
<span id="cb116-16"><a href="shiny-1.html#cb116-16"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){}</span>
<span id="cb116-17"><a href="shiny-1.html#cb116-17"></a></span>
<span id="cb116-18"><a href="shiny-1.html#cb116-18"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>If you then run the application and open it at the <code>/files/script.js</code> path (e.g.: <code>127.0.0.1:3000/files/script.js</code>) you should see the content of our JavaScript file (<code>console.log('Hello JS!')</code>), commenting the <code>addResourcePath</code> line will have a “Not Found” error displayed on the page instead.</p>
<p>All files in your asset directory will be served online and accessible to anyone: do not place sensitive files in it.</p>
<p>Though one may create multiple such directory and correspondingly use <code>addResourcePath</code> to specify multiple paths and prefixes, one will routinely specify a single one, named “assets” or “static,” which contains multiple subdirectories, one for each type of static file to obtain a directory that looks something like the tree below. This is, however, an unwritten convention which is by no means forced upon the developer: do as you wish.</p>
<pre><code>assets/
├── js/
│    └── script.js
├── css/
│    └── style.css
└── img/
     └── pic.png</code></pre>
<p>At this stage we have made the JavaScript file we created accessible by the clients but we still have to source this file in our <code>ui</code> as currently this file is, though served, not used by our application. Were one creating a static HTML page one would use the <code>script</code> to <code>src</code> the file in the <code>head</code> of the page.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb118-1"><a href="shiny-1.html#cb118-1"></a><span class="kw">&lt;html&gt;</span></span>
<span id="cb118-2"><a href="shiny-1.html#cb118-2"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb118-3"><a href="shiny-1.html#cb118-3"></a>    <span class="er">&lt;</span>!–– source the JavaScript file ––&gt;</span>
<span id="cb118-4"><a href="shiny-1.html#cb118-4"></a>    <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;path/to/script.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb118-5"><a href="shiny-1.html#cb118-5"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb118-6"><a href="shiny-1.html#cb118-6"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb118-7"><a href="shiny-1.html#cb118-7"></a>    <span class="kw">&lt;p</span><span class="ot"> id=</span><span class="st">&quot;content&quot;</span><span class="kw">&gt;</span>Trying JavaScript!<span class="kw">&lt;/p&gt;</span></span>
<span id="cb118-8"><a href="shiny-1.html#cb118-8"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb118-9"><a href="shiny-1.html#cb118-9"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>In shiny we write the ui in R and not in HTML (though this is also supported). Given the resemblance between the names of HTML tags and shiny UI functions it’s pretty straightforward, the html page above would look something like the shiny <code>ui</code> below.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="shiny-1.html#cb119-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb119-2"><a href="shiny-1.html#cb119-2"></a></span>
<span id="cb119-3"><a href="shiny-1.html#cb119-3"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb119-4"><a href="shiny-1.html#cb119-4"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb119-5"><a href="shiny-1.html#cb119-5"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="dt">src =</span> <span class="st">&quot;path/to/script.js&quot;</span>)</span>
<span id="cb119-6"><a href="shiny-1.html#cb119-6"></a>  ),</span>
<span id="cb119-7"><a href="shiny-1.html#cb119-7"></a>  <span class="kw">p</span>(<span class="dt">id =</span> <span class="st">&quot;content&quot;</span>, <span class="st">&quot;Trying JavaScript!&quot;</span>)</span>
<span id="cb119-8"><a href="shiny-1.html#cb119-8"></a>)</span></code></pre></div>
<p>Note that we use the <code>tags</code> object which comes from the shiny package and includes HTML tags that are not exported as standalone functions. For instance, you can create a <code>&lt;div&gt;</code> in shiny with the <code>div</code> function but <code>tags$div</code> will also work. This can now be applied to the shiny application, the <code>path/to/script.js</code> should be changed to <code>files/script.js</code> where <code>files</code> is the prefix we defined in <code>addResourcePath</code>.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="shiny-1.html#cb120-1"></a><span class="co"># app.R</span></span>
<span id="cb120-2"><a href="shiny-1.html#cb120-2"></a><span class="kw">library</span>(shiny)</span>
<span id="cb120-3"><a href="shiny-1.html#cb120-3"></a></span>
<span id="cb120-4"><a href="shiny-1.html#cb120-4"></a><span class="co"># serve the files</span></span>
<span id="cb120-5"><a href="shiny-1.html#cb120-5"></a><span class="kw">addResourcePath</span>(<span class="dt">prefix =</span> <span class="st">&quot;files&quot;</span>, <span class="dt">directoryPath =</span> <span class="st">&quot;assets&quot;</span>)</span>
<span id="cb120-6"><a href="shiny-1.html#cb120-6"></a></span>
<span id="cb120-7"><a href="shiny-1.html#cb120-7"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb120-8"><a href="shiny-1.html#cb120-8"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb120-9"><a href="shiny-1.html#cb120-9"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="dt">src =</span> <span class="st">&quot;files/script.js&quot;</span>)</span>
<span id="cb120-10"><a href="shiny-1.html#cb120-10"></a>  ),</span>
<span id="cb120-11"><a href="shiny-1.html#cb120-11"></a>  <span class="kw">h1</span>(<span class="st">&quot;R and JavaScript&quot;</span>)</span>
<span id="cb120-12"><a href="shiny-1.html#cb120-12"></a>)</span>
<span id="cb120-13"><a href="shiny-1.html#cb120-13"></a></span>
<span id="cb120-14"><a href="shiny-1.html#cb120-14"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){}</span>
<span id="cb120-15"><a href="shiny-1.html#cb120-15"></a></span>
<span id="cb120-16"><a href="shiny-1.html#cb120-16"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>From the browser, inspecting page (right click &gt; inspect &gt; console tab) one should see “Hello JS!” in the console which means our application correctly ran the code in our JavaScript file.</p>
</div>
<div id="integration" class="section level2 unnumbered" number="">
<h2>Integration</h2>
<p>The following sections will walk you through an example in which one first starts with a basic hello-world-like JavaScript example running in shiny and ends with a fully-fledged R package that brings new functionalities to shiny by integrating a third party library.</p>
<p>We first build an application that passes a message from the R server to the client to display said message as a vanilla JavaScript alert (pop-up), then send back to the R server whether the user has clicked “OK” on the alert. Finally we replicate that but with an external library and wrap the whole project into a fully functional package.</p>
<p>First, let’s write a barebone shiny application which includes the JavaScript code which opens an alert.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="shiny-1.html#cb121-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb121-2"><a href="shiny-1.html#cb121-2"></a></span>
<span id="cb121-3"><a href="shiny-1.html#cb121-3"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb121-4"><a href="shiny-1.html#cb121-4"></a>  tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb121-5"><a href="shiny-1.html#cb121-5"></a>    <span class="st">&quot;alert(&#39;Hello from JavaScript&#39;);&quot;</span></span>
<span id="cb121-6"><a href="shiny-1.html#cb121-6"></a>  ),</span>
<span id="cb121-7"><a href="shiny-1.html#cb121-7"></a>  <span class="kw">h1</span>(<span class="st">&quot;Hello&quot;</span>)</span>
<span id="cb121-8"><a href="shiny-1.html#cb121-8"></a>)</span>
<span id="cb121-9"><a href="shiny-1.html#cb121-9"></a></span>
<span id="cb121-10"><a href="shiny-1.html#cb121-10"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){}</span>
<span id="cb121-11"><a href="shiny-1.html#cb121-11"></a></span>
<span id="cb121-12"><a href="shiny-1.html#cb121-12"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="figure">
<img src="images/alert.png" alt="" />
<p class="caption">JavaScript alert in shiny</p>
</div>
<p>One thing important to note for later is that alerts will always block the execution of code which allows making sure some code is only run with user consent or the user being aware of the consequences.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb122-1"><a href="shiny-1.html#cb122-1"></a><span class="at">alert</span>(<span class="st">&#39;delete everything?&#39;</span>)<span class="op">;</span></span>
<span id="cb122-2"><a href="shiny-1.html#cb122-2"></a><span class="at">deleteEverythingOnlyIfUserOK</span>()<span class="op">;</span></span></code></pre></div>
</div>
<div id="from-r-to-javascript" class="section level2 unnumbered" number="">
<h2>From R to JavaScript</h2>
<p>Now that we have a simple alert displayed in the application we can tie it with our R server; the alert should display a message sent by the R server, this would enable, for instance, displaying a message taken from a database or a user input. As might be expected there are two functions required to do so, an R function and its JavaScript complementary: one to send the data from the server and another to catch said data from the client and display the alert.</p>
<p>Let us start by writing the R code to send the data, thankfully very little is required of the developer. One can send data from the R server to the client from the <code>session</code> object using the <code>sendCustomMessage</code> method. The method takes two arguments, first an identifier (where to send the data to), second the actual data to send to JavaScript.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="shiny-1.html#cb123-1"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb123-2"><a href="shiny-1.html#cb123-2"></a>  <span class="co"># set the identifier to send-alert</span></span>
<span id="cb123-3"><a href="shiny-1.html#cb123-3"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="dt">type =</span> <span class="st">&quot;send-alert&quot;</span>, <span class="dt">message =</span> <span class="st">&quot;Hi there!&quot;</span>)</span>
<span id="cb123-4"><a href="shiny-1.html#cb123-4"></a>}</span></code></pre></div>
<p>This effectively sends our message to the JavaScript client but we are yet to use that message JavaScript-side so the application still displays the same alert on load. We can add a “handler” for the identifier we defined (<code>send-alert</code>) which will so something with the message we sent from the server. This is done with the <code>addCustomMessageHandler</code> method from the <code>Shiny</code> object where the first argument is the identifier and the second is the function that handles the message, generally a function that takes a single argument: the data sent from the server.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="shiny-1.html#cb124-1"></a>tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb124-2"><a href="shiny-1.html#cb124-2"></a>  <span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb124-3"><a href="shiny-1.html#cb124-3"></a><span class="st">    alert(message);</span></span>
<span id="cb124-4"><a href="shiny-1.html#cb124-4"></a><span class="st">  });&quot;</span></span>
<span id="cb124-5"><a href="shiny-1.html#cb124-5"></a>)</span></code></pre></div>
<div class="figure">
<img src="images/alert-shiny.png" alt="" />
<p class="caption">Alert sent from shiny server</p>
</div>
<p>This enables you to pass a message that is taken from a database for instance, or as shown below from a user input, to the alert.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="shiny-1.html#cb125-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb125-2"><a href="shiny-1.html#cb125-2"></a></span>
<span id="cb125-3"><a href="shiny-1.html#cb125-3"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb125-4"><a href="shiny-1.html#cb125-4"></a>  tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb125-5"><a href="shiny-1.html#cb125-5"></a>    <span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb125-6"><a href="shiny-1.html#cb125-6"></a><span class="st">      alert(message);</span></span>
<span id="cb125-7"><a href="shiny-1.html#cb125-7"></a><span class="st">    });&quot;</span></span>
<span id="cb125-8"><a href="shiny-1.html#cb125-8"></a>  ),</span>
<span id="cb125-9"><a href="shiny-1.html#cb125-9"></a>  <span class="kw">h1</span>(<span class="st">&quot;Hello&quot;</span>),</span>
<span id="cb125-10"><a href="shiny-1.html#cb125-10"></a>  <span class="kw">textInput</span>(<span class="st">&quot;text&quot;</span>, <span class="st">&quot;Text to show in alert&quot;</span>),</span>
<span id="cb125-11"><a href="shiny-1.html#cb125-11"></a>  <span class="kw">actionButton</span>(<span class="st">&quot;submit&quot;</span>, <span class="st">&quot;Show alert&quot;</span>)</span>
<span id="cb125-12"><a href="shiny-1.html#cb125-12"></a>)</span>
<span id="cb125-13"><a href="shiny-1.html#cb125-13"></a></span>
<span id="cb125-14"><a href="shiny-1.html#cb125-14"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb125-15"><a href="shiny-1.html#cb125-15"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>submit, {</span>
<span id="cb125-16"><a href="shiny-1.html#cb125-16"></a>    session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="dt">type =</span> <span class="st">&quot;send-alert&quot;</span>, <span class="dt">message =</span> input<span class="op">$</span>text)</span>
<span id="cb125-17"><a href="shiny-1.html#cb125-17"></a>  })</span>
<span id="cb125-18"><a href="shiny-1.html#cb125-18"></a>}</span>
<span id="cb125-19"><a href="shiny-1.html#cb125-19"></a></span>
<span id="cb125-20"><a href="shiny-1.html#cb125-20"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>In the application above, notice the path that our message follows: it goes from the client to the server which sends it back to the client. This might be considered suboptimal by some as it is not necessary to use the server as intermediary (in this example at least). Though there is some truth to this the above will work perfectly fine—and our aim here is to make JavaScript work with R—not alongside it.</p>
</div>
<div id="from-javascript-to-r" class="section level2 unnumbered" number="">
<h2>From JavaScript to R</h2>
<p>Imagine if you will that instead of displaying a somewhat anodyne alert it was one that actually mattered where the user is warned that clicking “OK” will execute an irreversible action like the deletion of a record. In order to implement this the server would need to “know” whether the user has clicked said “OK” button. To do so one needs to pass data from the client to the server.</p>
<p>This can be done by defining a new <em>simplified</em> shiny input. While one can define a fully-fledged shiny input that can be registered, updated, etc. there is also a simplified version of the latter which allows sending reactive input value to the server where it can be used just like any other inputs (<code>input$id</code>). The value of the input can be defined using the <code>setInputValue</code> method which takes the id of the input and the value to give it.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="shiny-1.html#cb126-1"></a>tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb126-2"><a href="shiny-1.html#cb126-2"></a>  <span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb126-3"><a href="shiny-1.html#cb126-3"></a><span class="st">    </span></span>
<span id="cb126-4"><a href="shiny-1.html#cb126-4"></a><span class="st">    // show alert</span></span>
<span id="cb126-5"><a href="shiny-1.html#cb126-5"></a><span class="st">    alert(message);</span></span>
<span id="cb126-6"><a href="shiny-1.html#cb126-6"></a></span>
<span id="cb126-7"><a href="shiny-1.html#cb126-7"></a><span class="st">    // set to true when clicked OK</span></span>
<span id="cb126-8"><a href="shiny-1.html#cb126-8"></a><span class="st">    Shiny.setInputValue(&#39;delete_alert&#39;, true);</span></span>
<span id="cb126-9"><a href="shiny-1.html#cb126-9"></a><span class="st">  });&quot;</span></span>
<span id="cb126-10"><a href="shiny-1.html#cb126-10"></a>)</span></code></pre></div>
<p>As mentioned earlier <code>alert</code> blocks code execution, therefore the input value will not be defined before the button “OK” is pressed. The server can now access the <code>input$delete_alert</code> input which is by default <code>NULL</code> and set to <code>TRUE</code> when the user has pressed “OK,” as done in the application below which prints the input to the console when the button is clicked.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="shiny-1.html#cb127-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb127-2"><a href="shiny-1.html#cb127-2"></a></span>
<span id="cb127-3"><a href="shiny-1.html#cb127-3"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb127-4"><a href="shiny-1.html#cb127-4"></a>  tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb127-5"><a href="shiny-1.html#cb127-5"></a>    <span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb127-6"><a href="shiny-1.html#cb127-6"></a><span class="st">      alert(message);</span></span>
<span id="cb127-7"><a href="shiny-1.html#cb127-7"></a><span class="st">      Shiny.setInputValue(&#39;delete_alert&#39;, true);</span></span>
<span id="cb127-8"><a href="shiny-1.html#cb127-8"></a><span class="st">    });&quot;</span></span>
<span id="cb127-9"><a href="shiny-1.html#cb127-9"></a>  ),</span>
<span id="cb127-10"><a href="shiny-1.html#cb127-10"></a>  <span class="kw">h1</span>(<span class="st">&quot;Hello&quot;</span>)</span>
<span id="cb127-11"><a href="shiny-1.html#cb127-11"></a>)</span>
<span id="cb127-12"><a href="shiny-1.html#cb127-12"></a></span>
<span id="cb127-13"><a href="shiny-1.html#cb127-13"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb127-14"><a href="shiny-1.html#cb127-14"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="dt">type =</span> <span class="st">&quot;send-alert&quot;</span>, <span class="dt">message =</span> <span class="st">&quot;Deleting a record!&quot;</span>)</span>
<span id="cb127-15"><a href="shiny-1.html#cb127-15"></a></span>
<span id="cb127-16"><a href="shiny-1.html#cb127-16"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>delete_alert, {</span>
<span id="cb127-17"><a href="shiny-1.html#cb127-17"></a>    <span class="co"># print TRUE when button is clicked</span></span>
<span id="cb127-18"><a href="shiny-1.html#cb127-18"></a>    <span class="kw">print</span>(input<span class="op">$</span>delete_alert) </span>
<span id="cb127-19"><a href="shiny-1.html#cb127-19"></a>  })</span>
<span id="cb127-20"><a href="shiny-1.html#cb127-20"></a>}</span>
<span id="cb127-21"><a href="shiny-1.html#cb127-21"></a></span>
<span id="cb127-22"><a href="shiny-1.html#cb127-22"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
</div>
<div id="external-library" class="section level2 unnumbered" number="">
<h2>External Library</h2>
<p>Thus far this chapter has covered both ways data travels between JavaScript and R in Shiny. However, the alerts displayed in the previous sections are rather hideous and, though demonstrates how both languages can work together within shiny, comes short of illustrating how to make use of external libraries, which is something frequently performed.</p>
<p>Let’s exploit an external library to improve upon the work done so far: <a href="https://github.com/StephanWagner/jBox">jBox</a> allows displaying modals (pop-ups), very similar to the vanilla JavaScript alerts, but much better looking and with additional functionalities.</p>
<p>The very first thing to do is to import jBox in our project, we could download the files and use them as described in the previous static files section but it comes with very convenient CDNs detailed in the <a href="https://stephanwagner.me/jBox/get_started">get-started page of the documentation</a>.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb128-1"><a href="shiny-1.html#cb128-1"></a><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://code.jquery.com/jquery-3.5.1.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb128-2"><a href="shiny-1.html#cb128-2"></a><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb128-3"><a href="shiny-1.html#cb128-3"></a><span class="kw">&lt;link</span><span class="ot"> href=</span><span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.css&quot;</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="kw">&gt;</span></span></code></pre></div>
<p>Note that the “j” in jBox stands for jQuery which is already a dependency of shiny itself, there is therefore no need to import it, on the contrary one should not in order to avoid clashes. We can adapt the ui of the shiny application built up to this point to import the dependencies, keeping the handler, to obtain the code below.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="shiny-1.html#cb129-1"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb129-2"><a href="shiny-1.html#cb129-2"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb129-3"><a href="shiny-1.html#cb129-3"></a>    tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb129-4"><a href="shiny-1.html#cb129-4"></a>      <span class="dt">src=</span><span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.js&quot;</span></span>
<span id="cb129-5"><a href="shiny-1.html#cb129-5"></a>    ),</span>
<span id="cb129-6"><a href="shiny-1.html#cb129-6"></a>    tags<span class="op">$</span><span class="kw">link</span>(</span>
<span id="cb129-7"><a href="shiny-1.html#cb129-7"></a>      <span class="dt">rel=</span><span class="st">&quot;stylesheet&quot;</span>,</span>
<span id="cb129-8"><a href="shiny-1.html#cb129-8"></a>      <span class="dt">href=</span><span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.css&quot;</span></span>
<span id="cb129-9"><a href="shiny-1.html#cb129-9"></a>    ),</span>
<span id="cb129-10"><a href="shiny-1.html#cb129-10"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb129-11"><a href="shiny-1.html#cb129-11"></a><span class="st">      // TO DO: code jBox</span></span>
<span id="cb129-12"><a href="shiny-1.html#cb129-12"></a><span class="st">    });&quot;</span>)</span>
<span id="cb129-13"><a href="shiny-1.html#cb129-13"></a>  )</span>
<span id="cb129-14"><a href="shiny-1.html#cb129-14"></a>)</span></code></pre></div>
<p>The jBox library comes with numerous features to display tooltips, modals, notices, and more, which would make for too long a chapter; only notices shall be covered here. Further down the <a href="https://stephanwagner.me/jBox/get_started#notices">get-started document</a> lies an example of a jBox notice.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb130-1"><a href="shiny-1.html#cb130-1"></a><span class="kw">new</span> <span class="at">jBox</span>(<span class="st">&#39;Notice&#39;</span><span class="op">,</span> <span class="op">{</span></span>
<span id="cb130-2"><a href="shiny-1.html#cb130-2"></a>  <span class="dt">content</span><span class="op">:</span> <span class="st">&#39;Hurray! A notice!&#39;</span><span class="op">,</span></span>
<span id="cb130-3"><a href="shiny-1.html#cb130-3"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;blue&#39;</span></span>
<span id="cb130-4"><a href="shiny-1.html#cb130-4"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Let us copy that in the placeholder of the shiny ui already put together.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="shiny-1.html#cb131-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb131-2"><a href="shiny-1.html#cb131-2"></a></span>
<span id="cb131-3"><a href="shiny-1.html#cb131-3"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb131-4"><a href="shiny-1.html#cb131-4"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb131-5"><a href="shiny-1.html#cb131-5"></a>    tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb131-6"><a href="shiny-1.html#cb131-6"></a>      <span class="dt">src=</span><span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.js&quot;</span></span>
<span id="cb131-7"><a href="shiny-1.html#cb131-7"></a>    ),</span>
<span id="cb131-8"><a href="shiny-1.html#cb131-8"></a>    tags<span class="op">$</span><span class="kw">link</span>(</span>
<span id="cb131-9"><a href="shiny-1.html#cb131-9"></a>      <span class="dt">rel=</span><span class="st">&quot;stylesheet&quot;</span>,</span>
<span id="cb131-10"><a href="shiny-1.html#cb131-10"></a>      <span class="dt">href=</span><span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.css&quot;</span></span>
<span id="cb131-11"><a href="shiny-1.html#cb131-11"></a>    ),</span>
<span id="cb131-12"><a href="shiny-1.html#cb131-12"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb131-13"><a href="shiny-1.html#cb131-13"></a><span class="st">      new jBox(&#39;Notice&#39;, {</span></span>
<span id="cb131-14"><a href="shiny-1.html#cb131-14"></a><span class="st">        content: &#39;Hurray! A notice!&#39;,</span></span>
<span id="cb131-15"><a href="shiny-1.html#cb131-15"></a><span class="st">        color: &#39;blue&#39;</span></span>
<span id="cb131-16"><a href="shiny-1.html#cb131-16"></a><span class="st">      });</span></span>
<span id="cb131-17"><a href="shiny-1.html#cb131-17"></a><span class="st">    });&quot;</span>)</span>
<span id="cb131-18"><a href="shiny-1.html#cb131-18"></a>  )</span>
<span id="cb131-19"><a href="shiny-1.html#cb131-19"></a>)</span>
<span id="cb131-20"><a href="shiny-1.html#cb131-20"></a></span>
<span id="cb131-21"><a href="shiny-1.html#cb131-21"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb131-22"><a href="shiny-1.html#cb131-22"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="dt">type =</span> <span class="st">&quot;send-alert&quot;</span>, <span class="dt">message =</span> <span class="st">&quot;Deleting a record!&quot;</span>)</span>
<span id="cb131-23"><a href="shiny-1.html#cb131-23"></a>}</span>
<span id="cb131-24"><a href="shiny-1.html#cb131-24"></a></span>
<span id="cb131-25"><a href="shiny-1.html#cb131-25"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="figure">
<img src="images/notice-1.png" alt="" />
<p class="caption">First jBox Notice</p>
</div>
<p>With some minor changes the application can display the message passed, one only needs to replace ‘Hurray! A notice!’ with the <code>message</code> variable.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="shiny-1.html#cb132-1"></a>tags<span class="op">$</span><span class="kw">script</span>(<span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb132-2"><a href="shiny-1.html#cb132-2"></a><span class="st">  new jBox(&#39;Notice&#39;, {</span></span>
<span id="cb132-3"><a href="shiny-1.html#cb132-3"></a><span class="st">    content: message,</span></span>
<span id="cb132-4"><a href="shiny-1.html#cb132-4"></a><span class="st">    color: &#39;blue&#39;</span></span>
<span id="cb132-5"><a href="shiny-1.html#cb132-5"></a><span class="st">  });</span></span>
<span id="cb132-6"><a href="shiny-1.html#cb132-6"></a><span class="st">});&quot;</span>)</span></code></pre></div>
<p>This though only allows passing a single variable, the message, to JavaScript but jBox has many more options.</p>
</div>
<div id="serialisation" class="section level2 unnumbered" number="">
<h2>Serialisation</h2>
<p>Let’s delve deeper into the communication between the server and the front-end to understand how we can further customise the notice displayed, e.g.: change the colour.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb133-1"><a href="shiny-1.html#cb133-1"></a><span class="op">{</span></span>
<span id="cb133-2"><a href="shiny-1.html#cb133-2"></a>  <span class="dt">content</span><span class="op">:</span> <span class="st">&#39;Hurray! A notice!&#39;</span><span class="op">,</span></span>
<span id="cb133-3"><a href="shiny-1.html#cb133-3"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;blue&#39;</span></span>
<span id="cb133-4"><a href="shiny-1.html#cb133-4"></a><span class="op">}</span></span></code></pre></div>
<p>Notice that the jBox notice takes a JSON object containing the options that define said notice to display, including but not limited to the message. The most straightforward way to make all those options accessible to the server is to construct that list of options server-side before sending it to the the front-end. For instance the JSON of options displayed above would look like the R list below.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="shiny-1.html#cb134-1"></a><span class="kw">list</span>(</span>
<span id="cb134-2"><a href="shiny-1.html#cb134-2"></a>  <span class="dt">content =</span> <span class="st">&#39;Hurray! A notice!&#39;</span>,</span>
<span id="cb134-3"><a href="shiny-1.html#cb134-3"></a>  <span class="dt">color =</span> <span class="st">&#39;blue&#39;</span></span>
<span id="cb134-4"><a href="shiny-1.html#cb134-4"></a>)</span></code></pre></div>
<p>Therefore one could construct this list server-side and use it in jBox straight away, without any further processing from the client. Doing so means we can simplify the JavaScript to <code>new jBox('Notice', message);</code> rather than use <code>message</code> within the JSON.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="shiny-1.html#cb135-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb135-2"><a href="shiny-1.html#cb135-2"></a></span>
<span id="cb135-3"><a href="shiny-1.html#cb135-3"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb135-4"><a href="shiny-1.html#cb135-4"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb135-5"><a href="shiny-1.html#cb135-5"></a>    tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb135-6"><a href="shiny-1.html#cb135-6"></a>      <span class="dt">src=</span><span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.js&quot;</span></span>
<span id="cb135-7"><a href="shiny-1.html#cb135-7"></a>    ),</span>
<span id="cb135-8"><a href="shiny-1.html#cb135-8"></a>    tags<span class="op">$</span><span class="kw">link</span>(</span>
<span id="cb135-9"><a href="shiny-1.html#cb135-9"></a>      <span class="dt">rel=</span><span class="st">&quot;stylesheet&quot;</span>,</span>
<span id="cb135-10"><a href="shiny-1.html#cb135-10"></a>      <span class="dt">href=</span><span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.css&quot;</span></span>
<span id="cb135-11"><a href="shiny-1.html#cb135-11"></a>    ),</span>
<span id="cb135-12"><a href="shiny-1.html#cb135-12"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb135-13"><a href="shiny-1.html#cb135-13"></a><span class="st">      // use notice send from the server</span></span>
<span id="cb135-14"><a href="shiny-1.html#cb135-14"></a><span class="st">      new jBox(&#39;Notice&#39;, message);</span></span>
<span id="cb135-15"><a href="shiny-1.html#cb135-15"></a><span class="st">    });&quot;</span>)</span>
<span id="cb135-16"><a href="shiny-1.html#cb135-16"></a>  )</span>
<span id="cb135-17"><a href="shiny-1.html#cb135-17"></a>)</span>
<span id="cb135-18"><a href="shiny-1.html#cb135-18"></a></span>
<span id="cb135-19"><a href="shiny-1.html#cb135-19"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb135-20"><a href="shiny-1.html#cb135-20"></a></span>
<span id="cb135-21"><a href="shiny-1.html#cb135-21"></a>  <span class="co"># define notice options</span></span>
<span id="cb135-22"><a href="shiny-1.html#cb135-22"></a>  notice =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb135-23"><a href="shiny-1.html#cb135-23"></a>    <span class="dt">content =</span> <span class="st">&#39;Hello from the server&#39;</span>,</span>
<span id="cb135-24"><a href="shiny-1.html#cb135-24"></a>    <span class="dt">color =</span> <span class="st">&#39;black&#39;</span></span>
<span id="cb135-25"><a href="shiny-1.html#cb135-25"></a>  )</span>
<span id="cb135-26"><a href="shiny-1.html#cb135-26"></a></span>
<span id="cb135-27"><a href="shiny-1.html#cb135-27"></a>  <span class="co"># send the notice</span></span>
<span id="cb135-28"><a href="shiny-1.html#cb135-28"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="dt">type =</span> <span class="st">&quot;send-alert&quot;</span>, <span class="dt">message =</span> notice)</span>
<span id="cb135-29"><a href="shiny-1.html#cb135-29"></a>}</span>
<span id="cb135-30"><a href="shiny-1.html#cb135-30"></a></span>
<span id="cb135-31"><a href="shiny-1.html#cb135-31"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="figure">
<img src="images/notice-2.png" alt="" />
<p class="caption">Customised jBox Notice</p>
</div>
<p>This sets a solid basis to further integrate other functionalities of jBox or any other JavaScript library one finds useful in Shiny.</p>
</div>
<div id="events-callbacks" class="section level2 unnumbered" number="">
<h2>Events &amp; Callbacks</h2>
<p>In the example of the vanilla JavaScript alert one could simply place a line of code after the <code>alert()</code> function in order to “tell” the server whether the button on the alert had been clicked. This was feasible because <code>alert</code> stops the execution of code, this is however rather uncommon in JavaScript. What is far more used are events or callback functions which are triggered upon an action is performed by the user (like the click of a button) or when other interesting things happen in the code (when something errors). <a href="https://stephanwagner.me/jBox/options#events">jBox provides numerous such events</a>: callback functions can be used when a modal is closed or when it is created for instance.</p>
<p>The concept of callback function is not totally foreign to R albeit rarely used. Shiny comes with such functions, e.g.: <code>shiny::onStop</code>. This allows having a function be triggered when the application exits (useful to close database connections for instance).</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="shiny-1.html#cb136-1"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</span>
<span id="cb136-2"><a href="shiny-1.html#cb136-2"></a>  shiny<span class="op">::</span><span class="kw">onStop</span>(</span>
<span id="cb136-3"><a href="shiny-1.html#cb136-3"></a>    <span class="co"># callback function fired when app is closed</span></span>
<span id="cb136-4"><a href="shiny-1.html#cb136-4"></a>    <span class="cf">function</span>(){</span>
<span id="cb136-5"><a href="shiny-1.html#cb136-5"></a>      <span class="kw">cat</span>(<span class="st">&quot;App has been closed&quot;</span>)</span>
<span id="cb136-6"><a href="shiny-1.html#cb136-6"></a>    } <span class="cf">for</span> instance</span>
<span id="cb136-7"><a href="shiny-1.html#cb136-7"></a>  )</span>
<span id="cb136-8"><a href="shiny-1.html#cb136-8"></a>}</span></code></pre></div>
<p>In jBox, these callback functions are included in the JSON of options, below the <code>onClose</code> event is fired when the notice is closed.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb137-1"><a href="shiny-1.html#cb137-1"></a><span class="op">{</span></span>
<span id="cb137-2"><a href="shiny-1.html#cb137-2"></a>  <span class="dt">content</span><span class="op">:</span> <span class="st">&#39;Alert!&#39;</span><span class="op">,</span></span>
<span id="cb137-3"><a href="shiny-1.html#cb137-3"></a>  <span class="dt">onClose</span><span class="op">:</span> <span class="kw">function</span>()<span class="op">{</span></span>
<span id="cb137-4"><a href="shiny-1.html#cb137-4"></a>    <span class="co">// Fired when closed </span></span>
<span id="cb137-5"><a href="shiny-1.html#cb137-5"></a>    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Alert is closed&#39;</span>)<span class="op">;</span></span>
<span id="cb137-6"><a href="shiny-1.html#cb137-6"></a>  <span class="op">}</span></span>
<span id="cb137-7"><a href="shiny-1.html#cb137-7"></a><span class="op">}</span></span></code></pre></div>
<p>This raises one issue, one cannot truly serialise an object of type function (there are exceptions later in the book). The callback function must therefore be appended to the object of options in JavaScript.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="shiny-1.html#cb138-1"></a>tags<span class="op">$</span><span class="kw">script</span>(<span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb138-2"><a href="shiny-1.html#cb138-2"></a><span class="st">  // append callback</span></span>
<span id="cb138-3"><a href="shiny-1.html#cb138-3"></a><span class="st">  message.onClose = function(){</span></span>
<span id="cb138-4"><a href="shiny-1.html#cb138-4"></a><span class="st">    Shiny.setInputValue(&#39;alert_close&#39;, true);</span></span>
<span id="cb138-5"><a href="shiny-1.html#cb138-5"></a><span class="st">  }</span></span>
<span id="cb138-6"><a href="shiny-1.html#cb138-6"></a><span class="st">  new jBox(&#39;Notice&#39;, message);</span></span>
<span id="cb138-7"><a href="shiny-1.html#cb138-7"></a><span class="st">});&quot;</span>)</span></code></pre></div>
<p>Placing a function inside a JSON object is common in JavaScript, in contrast with R where, though it works is rarely if ever done. The above JavaScript code to append the callback function could look something like the snippet below in R.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="shiny-1.html#cb139-1"></a>message &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">content =</span> <span class="st">&quot;hello&quot;</span>)</span>
<span id="cb139-2"><a href="shiny-1.html#cb139-2"></a>message<span class="op">$</span>onClose &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb139-3"><a href="shiny-1.html#cb139-3"></a>  x <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb139-4"><a href="shiny-1.html#cb139-4"></a>}</span>
<span id="cb139-5"><a href="shiny-1.html#cb139-5"></a></span>
<span id="cb139-6"><a href="shiny-1.html#cb139-6"></a>message<span class="op">$</span><span class="kw">onClose</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Incorporating this into the application built thus far.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="shiny-1.html#cb141-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb141-2"><a href="shiny-1.html#cb141-2"></a></span>
<span id="cb141-3"><a href="shiny-1.html#cb141-3"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb141-4"><a href="shiny-1.html#cb141-4"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb141-5"><a href="shiny-1.html#cb141-5"></a>    tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb141-6"><a href="shiny-1.html#cb141-6"></a>      <span class="dt">src=</span><span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.js&quot;</span></span>
<span id="cb141-7"><a href="shiny-1.html#cb141-7"></a>    ),</span>
<span id="cb141-8"><a href="shiny-1.html#cb141-8"></a>    tags<span class="op">$</span><span class="kw">link</span>(</span>
<span id="cb141-9"><a href="shiny-1.html#cb141-9"></a>      <span class="dt">rel=</span><span class="st">&quot;stylesheet&quot;</span>,</span>
<span id="cb141-10"><a href="shiny-1.html#cb141-10"></a>      <span class="dt">href=</span><span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.css&quot;</span></span>
<span id="cb141-11"><a href="shiny-1.html#cb141-11"></a>    ),</span>
<span id="cb141-12"><a href="shiny-1.html#cb141-12"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb141-13"><a href="shiny-1.html#cb141-13"></a><span class="st">      message.onClose = function(){</span></span>
<span id="cb141-14"><a href="shiny-1.html#cb141-14"></a><span class="st">        Shiny.setInputValue(&#39;alert_close&#39;, true);</span></span>
<span id="cb141-15"><a href="shiny-1.html#cb141-15"></a><span class="st">      }</span></span>
<span id="cb141-16"><a href="shiny-1.html#cb141-16"></a><span class="st">      new jBox(&#39;Notice&#39;, message);</span></span>
<span id="cb141-17"><a href="shiny-1.html#cb141-17"></a><span class="st">    });&quot;</span>)</span>
<span id="cb141-18"><a href="shiny-1.html#cb141-18"></a>  )</span>
<span id="cb141-19"><a href="shiny-1.html#cb141-19"></a>)</span>
<span id="cb141-20"><a href="shiny-1.html#cb141-20"></a></span>
<span id="cb141-21"><a href="shiny-1.html#cb141-21"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb141-22"><a href="shiny-1.html#cb141-22"></a></span>
<span id="cb141-23"><a href="shiny-1.html#cb141-23"></a>  <span class="co"># define notice options</span></span>
<span id="cb141-24"><a href="shiny-1.html#cb141-24"></a>  notice =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb141-25"><a href="shiny-1.html#cb141-25"></a>    <span class="dt">content =</span> <span class="st">&#39;Hello from the server&#39;</span>,</span>
<span id="cb141-26"><a href="shiny-1.html#cb141-26"></a>    <span class="dt">color =</span> <span class="st">&#39;black&#39;</span></span>
<span id="cb141-27"><a href="shiny-1.html#cb141-27"></a>  )</span>
<span id="cb141-28"><a href="shiny-1.html#cb141-28"></a></span>
<span id="cb141-29"><a href="shiny-1.html#cb141-29"></a>  <span class="co"># send the notice</span></span>
<span id="cb141-30"><a href="shiny-1.html#cb141-30"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="dt">type =</span> <span class="st">&quot;send-alert&quot;</span>, <span class="dt">message =</span> notice)</span>
<span id="cb141-31"><a href="shiny-1.html#cb141-31"></a></span>
<span id="cb141-32"><a href="shiny-1.html#cb141-32"></a>  <span class="co"># print the output of the alert_close event (when fired)</span></span>
<span id="cb141-33"><a href="shiny-1.html#cb141-33"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>alert_close, {</span>
<span id="cb141-34"><a href="shiny-1.html#cb141-34"></a>    <span class="kw">print</span>(input<span class="op">$</span>alert_close)</span>
<span id="cb141-35"><a href="shiny-1.html#cb141-35"></a>  })</span>
<span id="cb141-36"><a href="shiny-1.html#cb141-36"></a>}</span>
<span id="cb141-37"><a href="shiny-1.html#cb141-37"></a></span>
<span id="cb141-38"><a href="shiny-1.html#cb141-38"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
</div>
<div id="as-a-package" class="section level2 unnumbered" number="">
<h2>As a Package</h2>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-golem">
<p>Guyader, Vincent, Colin Fay, Sébastien Rochette, and Cervan Girard. 2020. <em>Golem: A Framework for Robust Shiny Applications</em>. <a href="https://CRAN.R-project.org/package=golem">https://CRAN.R-project.org/package=golem</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="node.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/JohnCoene/r-and-javascript/edit/master/04-Shiny.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
