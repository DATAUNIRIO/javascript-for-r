<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 The Full Monty | JavaScript for R</title>
  <meta name="description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 The Full Monty | JavaScript for R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="github-repo" content="JohnCoene/javascript-for-r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 The Full Monty | JavaScript for R" />
  
  <meta name="twitter:description" content="Invite JavaScript into your Data Science workflow." />
  

<meta name="author" content="John Coene" />


<meta name="date" content="2020-08-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="a-realistic-widget.html"/>
<link rel="next" href="advanced-topics.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block/empty-anchor.js"></script>
<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>
<script src="libs/core-js/shim.min.js"></script>
<script src="libs/react/react.min.js"></script>
<script src="libs/react/react-dom.min.js"></script>
<script src="libs/reactwidget/react-tools.js"></script>
<script src="libs/reactable-binding/reactable.js"></script>
<script src="libs/r2d3-render/r2d3-render.js"></script>
<script src="libs/webcomponents/webcomponents.js"></script>
<script src="libs/r2d3-binding/r2d3.js"></script>
<script src="libs/d3v5/d3.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">JavaScript for R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#premise"><i class="fa fa-check"></i>Premise</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-structure"><i class="fa fa-check"></i>Book Structure</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgement"><i class="fa fa-check"></i>Acknowledgement</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i>Disclaimer</a></li>
</ul></li>
<li class="part"><span><b>I Basics &amp; Roadmap</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#rationale"><i class="fa fa-check"></i>Rationale</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#methods"><i class="fa fa-check"></i>Methods</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#v8"><i class="fa fa-check"></i>V8</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#htmlwidgets"><i class="fa fa-check"></i>htmlwidgets</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#shiny"><i class="fa fa-check"></i>Shiny</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#bubble"><i class="fa fa-check"></i>bubble</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#methods-amiss"><i class="fa fa-check"></i>Methods Amiss</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#reactr"><i class="fa fa-check"></i>reactR</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#r2d3"><i class="fa fa-check"></i>r2d3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>2</b> Prerequisites</a>
<ul>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#package-development"><i class="fa fa-check"></i>Package Development</a>
<ul>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#structure"><i class="fa fa-check"></i>Structure</a></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#creating-a-package"><i class="fa fa-check"></i>Creating a Package</a></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#metadata"><i class="fa fa-check"></i>Metadata</a></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#r-code"><i class="fa fa-check"></i>R code</a></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#documentation"><i class="fa fa-check"></i>Documentation</a></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#installed-files"><i class="fa fa-check"></i>Installed files</a></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#build-load-and-install"><i class="fa fa-check"></i>Build, Load, and Install</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#json"><i class="fa fa-check"></i>JSON</a></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#javascript"><i class="fa fa-check"></i>JavaScript</a></li>
</ul></li>
<li class="part"><span><b>II Data Visualisation</b></span></li>
<li class="chapter" data-level="3" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>3</b> Basics</a>
<ul>
<li class="chapter" data-level="" data-path="basics.html"><a href="basics.html#candidate-libraries"><i class="fa fa-check"></i>Candidate Libraries</a>
<ul>
<li class="chapter" data-level="" data-path="basics.html"><a href="basics.html#plotly"><i class="fa fa-check"></i>Plotly</a></li>
<li class="chapter" data-level="" data-path="basics.html"><a href="basics.html#highchart.js"><i class="fa fa-check"></i>Highchart.js</a></li>
<li class="chapter" data-level="" data-path="basics.html"><a href="basics.html#chart.js"><i class="fa fa-check"></i>Chart.js</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="basics.html"><a href="basics.html#how-it-works"><i class="fa fa-check"></i>How it works</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="your-first-widget.html"><a href="your-first-widget.html"><i class="fa fa-check"></i><b>4</b> Your First Widget</a>
<ul>
<li class="chapter" data-level="" data-path="your-first-widget.html"><a href="your-first-widget.html#the-scaffold"><i class="fa fa-check"></i>The Scaffold</a></li>
<li class="chapter" data-level="" data-path="your-first-widget.html"><a href="your-first-widget.html#the-output"><i class="fa fa-check"></i>The Output</a></li>
<li class="chapter" data-level="" data-path="your-first-widget.html"><a href="your-first-widget.html#javascript-side"><i class="fa fa-check"></i>JavaScript-side</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-realistic-widget.html"><a href="a-realistic-widget.html"><i class="fa fa-check"></i><b>5</b> A Realistic Widget</a>
<ul>
<li class="chapter" data-level="" data-path="a-realistic-widget.html"><a href="a-realistic-widget.html#dependency"><i class="fa fa-check"></i>Dependency</a></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#javascript"><i class="fa fa-check"></i>JavaScript</a></li>
<li class="chapter" data-level="" data-path="a-realistic-widget.html"><a href="a-realistic-widget.html#html-element"><i class="fa fa-check"></i>HTML Element</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-full-monty.html"><a href="the-full-monty.html"><i class="fa fa-check"></i><b>6</b> The Full Monty</a>
<ul>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#dependencies"><i class="fa fa-check"></i>Dependencies</a></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#javascript"><i class="fa fa-check"></i>JavaScript</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#working-with-data"><i class="fa fa-check"></i>Working with Data</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#transforming-data"><i class="fa fa-check"></i>Transforming Data</a>
<ul>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#in-javascript"><i class="fa fa-check"></i>In JavaScript</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#in-r"><i class="fa fa-check"></i>In R</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#pros-cons"><i class="fa fa-check"></i>Pros &amp; Cons</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#on-print"><i class="fa fa-check"></i>On Print</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="advanced-topics.html"><a href="advanced-topics.html"><i class="fa fa-check"></i><b>7</b> Advanced Topics</a>
<ul>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#shared-variables"><i class="fa fa-check"></i>Shared Variables</a>
<ul>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#sizing"><i class="fa fa-check"></i>Sizing</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#sizing-policy"><i class="fa fa-check"></i>Sizing Policy</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#resizing"><i class="fa fa-check"></i>Resizing</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#pre-render-hooks-security"><i class="fa fa-check"></i>Pre Render Hooks &amp; Security</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#javascript-code"><i class="fa fa-check"></i>JavaScript Code</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#prepend-append-content"><i class="fa fa-check"></i>Prepend &amp; Append Content</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#dependencies"><i class="fa fa-check"></i>Dependencies</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#compatibility"><i class="fa fa-check"></i>Compatibility</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#unit-tests"><i class="fa fa-check"></i>Unit Tests</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#performances"><i class="fa fa-check"></i>Performances</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="working-with-shiny.html"><a href="working-with-shiny.html"><i class="fa fa-check"></i><b>8</b> Working with Shiny</a>
<ul>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#javascript-to-r"><i class="fa fa-check"></i>JavaScript to R</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#input-handler"><i class="fa fa-check"></i>Input Handler</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#r-to-javascript"><i class="fa fa-check"></i>R to JavaScript</a>
<ul>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#send-data"><i class="fa fa-check"></i>Send Data</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#retrieve-widget-instance"><i class="fa fa-check"></i>Retrieve Widget Instance</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#handle-data"><i class="fa fa-check"></i>Handle Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#proxy-function"><i class="fa fa-check"></i>Proxy Function</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#clear-data"><i class="fa fa-check"></i>Clear Data</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#update"><i class="fa fa-check"></i>Update</a></li>
</ul></li>
<li class="part"><span><b>III Web Development with Shiny</b></span></li>
<li class="chapter" data-level="9" data-path="discover.html"><a href="discover.html"><i class="fa fa-check"></i><b>9</b> Discover</a>
<ul>
<li class="chapter" data-level="" data-path="discover.html"><a href="discover.html#static-files"><i class="fa fa-check"></i>Static Files</a></li>
<li class="chapter" data-level="" data-path="discover.html"><a href="discover.html#example---alerts"><i class="fa fa-check"></i>Example - Alerts</a></li>
<li class="chapter" data-level="" data-path="discover.html"><a href="discover.html#from-r-to-javascript"><i class="fa fa-check"></i>From R to JavaScript</a></li>
<li class="chapter" data-level="" data-path="discover.html"><a href="discover.html#from-javascript-to-r"><i class="fa fa-check"></i>From JavaScript to R</a></li>
<li class="chapter" data-level="" data-path="discover.html"><a href="discover.html#deserialise"><i class="fa fa-check"></i>Deserialise</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="a-complete-integration.html"><a href="a-complete-integration.html"><i class="fa fa-check"></i><b>10</b> A Complete Integration</a>
<ul>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#serialisation"><i class="fa fa-check"></i>Serialisation</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#events-callbacks"><i class="fa fa-check"></i>Events &amp; Callbacks</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#as-a-package"><i class="fa fa-check"></i>As a Package</a>
<ul>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#dependencies"><i class="fa fa-check"></i>Dependencies</a></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#r-code"><i class="fa fa-check"></i>R Code</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#javascript-code"><i class="fa fa-check"></i>JavaScript Code</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#input-handler"><i class="fa fa-check"></i>Input Handler</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#wrapping-up"><i class="fa fa-check"></i>Wrapping up</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="tips-tricks.html"><a href="tips-tricks.html"><i class="fa fa-check"></i><b>11</b> Tips &amp; Tricks</a>
<ul>
<li class="chapter" data-level="" data-path="tips-tricks.html"><a href="tips-tricks.html#shiny-events"><i class="fa fa-check"></i>Shiny Events</a></li>
<li class="chapter" data-level="" data-path="tips-tricks.html"><a href="tips-tricks.html#table-buttons"><i class="fa fa-check"></i>Table Buttons</a></li>
<li class="chapter" data-level="" data-path="tips-tricks.html"><a href="tips-tricks.html#jquery---toggle"><i class="fa fa-check"></i>jQuery - Toggle</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="custom-outputs.html"><a href="custom-outputs.html"><i class="fa fa-check"></i><b>12</b> Custom Outputs</a>
<ul>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#inner-workings"><i class="fa fa-check"></i>Inner-workings</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#discover-lena.js"><i class="fa fa-check"></i>Discover Lena.js</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#setup"><i class="fa fa-check"></i>Setup</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#output"><i class="fa fa-check"></i>Output</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#render"><i class="fa fa-check"></i>Render</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#javascript-binding"><i class="fa fa-check"></i>JavaScript Binding</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#test"><i class="fa fa-check"></i>Test</a></li>
</ul></li>
<li class="part"><span><b>IV JavaScript for Computations</b></span></li>
<li class="chapter" data-level="13" data-path="the-v8-engine.html"><a href="the-v8-engine.html"><i class="fa fa-check"></i><b>13</b> The V8 Engine</a>
<ul>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#installation"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="basics.html"><a href="basics.html#basics"><i class="fa fa-check"></i>Basics</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#external-libraries"><i class="fa fa-check"></i>External Libraries</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#with-npm"><i class="fa fa-check"></i>With Npm</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#use-in-packages"><i class="fa fa-check"></i>Use in Packages</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="node.html"><a href="node.html"><i class="fa fa-check"></i><b>14</b> Node.js with Bubble</a>
<ul>
<li class="chapter" data-level="" data-path="basics.html"><a href="basics.html#basics"><i class="fa fa-check"></i>Basics</a></li>
<li class="chapter" data-level="" data-path="node.html"><a href="node.html#r-markdown-engine"><i class="fa fa-check"></i>R Markdown Engine</a></li>
<li class="chapter" data-level="" data-path="node.html"><a href="node.html#npm"><i class="fa fa-check"></i>Npm</a></li>
</ul></li>
<li class="part"><span><b>V Examples</b></span></li>
<li class="chapter" data-level="15" data-path="ploty.html"><a href="ploty.html"><i class="fa fa-check"></i><b>15</b> Ploty</a>
<ul>
<li class="chapter" data-level="" data-path="discover.html"><a href="discover.html#discover"><i class="fa fa-check"></i>Discover</a></li>
<li class="chapter" data-level="" data-path="basics.html"><a href="basics.html#basics"><i class="fa fa-check"></i>Basics</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#javascript-to-r"><i class="fa fa-check"></i>JavaScript to R</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#r-to-javascript"><i class="fa fa-check"></i>R to JavaScript</a></li>
<li class="chapter" data-level="" data-path="ploty.html"><a href="ploty.html#size-resize"><i class="fa fa-check"></i>Size &amp; Resize</a></li>
<li class="chapter" data-level="" data-path="ploty.html"><a href="ploty.html#performance-security"><i class="fa fa-check"></i>Performance &amp; Security</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="image-classifier.html"><a href="image-classifier.html"><i class="fa fa-check"></i><b>16</b> Image Classifier</a>
<ul>
<li class="chapter" data-level="" data-path="discover.html"><a href="discover.html#discover"><i class="fa fa-check"></i>Discover</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#setup"><i class="fa fa-check"></i>Setup</a></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#javascript"><i class="fa fa-check"></i>JavaScript</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#input-handler"><i class="fa fa-check"></i>Input Handler</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="progress-bar.html"><a href="progress-bar.html"><i class="fa fa-check"></i><b>17</b> Progress Bar</a>
<ul>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#r-code"><i class="fa fa-check"></i>R code</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#javascript-code"><i class="fa fa-check"></i>JavaScript code</a></li>
<li class="chapter" data-level="" data-path="progress-bar.html"><a href="progress-bar.html#events"><i class="fa fa-check"></i>Events</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>18</b> Machine Learning</a>
<ul>
<li class="chapter" data-level="" data-path="a-realistic-widget.html"><a href="a-realistic-widget.html#dependency"><i class="fa fa-check"></i>Dependency</a></li>
<li class="chapter" data-level="" data-path="machine-learning.html"><a href="machine-learning.html#simple-regression"><i class="fa fa-check"></i>Simple Regression</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="cookies.html"><a href="cookies.html"><i class="fa fa-check"></i><b>19</b> Cookies</a>
<ul>
<li class="chapter" data-level="" data-path="cookies.html"><a href="cookies.html#discover-js-cookie"><i class="fa fa-check"></i>Discover js-cookie</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#setup"><i class="fa fa-check"></i>Setup</a></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#javascript"><i class="fa fa-check"></i>JavaScript</a></li>
<li class="chapter" data-level="" data-path="prerequisites.html"><a href="prerequisites.html#r-code"><i class="fa fa-check"></i>R Code</a></li>
</ul></li>
<li class="part"><span><b>VI Closing Remarks</b></span></li>
<li class="chapter" data-level="20" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>20</b> Conclusion</a>
<ul>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#performances"><i class="fa fa-check"></i>Performances</a></li>
<li class="chapter" data-level="" data-path="conclusion.html"><a href="conclusion.html#road-ahead"><i class="fa fa-check"></i>Road ahead</a>
<ul>
<li class="chapter" data-level="" data-path="conclusion.html"><a href="conclusion.html#computation"><i class="fa fa-check"></i>Computation</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#shiny"><i class="fa fa-check"></i>Shiny</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#htmlwidgets"><i class="fa fa-check"></i>htmlwidgets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">JavaScript for R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-full-monty" class="section level1" number="6">
<h1><span class="header-section-number">Chapter 6</span> The Full Monty</h1>
<p>With a first widget built one can jump onto another one: <a href="https://giojs.org/">gio.js</a>, a library to draw arcs between countries on a 3 dimensional globe. This will include many more functionalities such packages can comprise.</p>
<p>Then again, the first order of business when looking to integrate a library is to look at the documentation to understand what should be reproduced in R.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb100-1"><a href="the-full-monty.html#cb100-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb100-2"><a href="the-full-monty.html#cb100-2"></a><span class="kw">&lt;html</span><span class="ot"> xmlns=</span><span class="st">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="ot"> lang=</span><span class="st">&quot;&quot;</span><span class="ot"> xml:lang=</span><span class="st">&quot;&quot;</span><span class="kw">&gt;</span></span>
<span id="cb100-3"><a href="the-full-monty.html#cb100-3"></a></span>
<span id="cb100-4"><a href="the-full-monty.html#cb100-4"></a><span class="kw">&lt;head&gt;</span></span>
<span id="cb100-5"><a href="the-full-monty.html#cb100-5"></a>  <span class="co">&lt;!-- Import libraries --&gt;</span></span>
<span id="cb100-6"><a href="the-full-monty.html#cb100-6"></a>  <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;three.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb100-7"><a href="the-full-monty.html#cb100-7"></a>  <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;gio.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb100-8"><a href="the-full-monty.html#cb100-8"></a><span class="kw">&lt;/head&gt;</span></span>
<span id="cb100-9"><a href="the-full-monty.html#cb100-9"></a></span>
<span id="cb100-10"><a href="the-full-monty.html#cb100-10"></a><span class="kw">&lt;body&gt;</span></span>
<span id="cb100-11"><a href="the-full-monty.html#cb100-11"></a>  <span class="co">&lt;!-- div to hold visualisation --&gt;</span></span>
<span id="cb100-12"><a href="the-full-monty.html#cb100-12"></a>  <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;globe&quot;</span><span class="ot"> style=</span><span class="st">&quot;width: 200px; height: 200px&quot;</span><span class="kw">&gt;&lt;/div&gt;</span></span>
<span id="cb100-13"><a href="the-full-monty.html#cb100-13"></a></span>
<span id="cb100-14"><a href="the-full-monty.html#cb100-14"></a>  <span class="co">&lt;!-- Script to create visualisation --&gt;</span></span>
<span id="cb100-15"><a href="the-full-monty.html#cb100-15"></a>  <span class="kw">&lt;script&gt;</span></span>
<span id="cb100-16"><a href="the-full-monty.html#cb100-16"></a>    <span class="kw">var</span> container <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;globe&quot;</span>)<span class="op">;</span></span>
<span id="cb100-17"><a href="the-full-monty.html#cb100-17"></a>    <span class="kw">var</span> controller <span class="op">=</span> <span class="kw">new</span> <span class="va">GIO</span>.<span class="at">Controller</span>(container)<span class="op">;</span></span>
<span id="cb100-18"><a href="the-full-monty.html#cb100-18"></a>    <span class="va">controller</span>.<span class="at">addData</span>(data)<span class="op">;</span></span>
<span id="cb100-19"><a href="the-full-monty.html#cb100-19"></a>    <span class="va">controller</span>.<span class="at">init</span>()<span class="op">;</span></span>
<span id="cb100-20"><a href="the-full-monty.html#cb100-20"></a>  <span class="kw">&lt;/script&gt;</span></span>
<span id="cb100-21"><a href="the-full-monty.html#cb100-21"></a><span class="kw">&lt;/body&gt;</span></span>
<span id="cb100-22"><a href="the-full-monty.html#cb100-22"></a></span>
<span id="cb100-23"><a href="the-full-monty.html#cb100-23"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<div class="figure">
<img src="images/gio-example.png" alt="" />
<p class="caption">Example of Gio.js visualisation</p>
</div>
<p>Gio.js has itself a dependency, <a href="https://threejs.org/">three.js</a>, which needs to be imported before gio.js, other than that not much differs from libraries previously explored in this chapter.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="the-full-monty.html#cb101-1"></a>usethis<span class="op">::</span><span class="kw">create_package</span>(<span class="st">&quot;gio&quot;</span>)</span>
<span id="cb101-2"><a href="the-full-monty.html#cb101-2"></a>htmlwidgets<span class="op">::</span><span class="kw">scaffoldWidget</span>(<span class="st">&quot;gio&quot;</span>)</span></code></pre></div>
<div id="dependencies" class="section level2 unnumbered" number="">
<h2>Dependencies</h2>
<p>Handling the dependencies does not differ much, we only need to download two libraries instead of one.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="the-full-monty.html#cb102-1"></a><span class="co"># create directories for JS dependencies</span></span>
<span id="cb102-2"><a href="the-full-monty.html#cb102-2"></a><span class="kw">dir.create</span>(<span class="st">&quot;./inst/htmlwidgets/three&quot;</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</span>
<span id="cb102-3"><a href="the-full-monty.html#cb102-3"></a><span class="kw">dir.create</span>(<span class="st">&quot;./inst/htmlwidgets/gio&quot;</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</span>
<span id="cb102-4"><a href="the-full-monty.html#cb102-4"></a></span>
<span id="cb102-5"><a href="the-full-monty.html#cb102-5"></a><span class="co"># download JS dependencies</span></span>
<span id="cb102-6"><a href="the-full-monty.html#cb102-6"></a>three &lt;-<span class="st"> &quot;https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js&quot;</span></span>
<span id="cb102-7"><a href="the-full-monty.html#cb102-7"></a>gio &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/syt123450/giojs/master/build/gio.min.js&quot;</span></span>
<span id="cb102-8"><a href="the-full-monty.html#cb102-8"></a></span>
<span id="cb102-9"><a href="the-full-monty.html#cb102-9"></a><span class="kw">download.file</span>(three, <span class="st">&quot;./inst/htmlwidgets/three/three.min.js&quot;</span>)</span>
<span id="cb102-10"><a href="the-full-monty.html#cb102-10"></a><span class="kw">download.file</span>(gio, <span class="st">&quot;./inst/htmlwidgets/gio/gio.min.js&quot;</span>)</span></code></pre></div>
<p>This should produce the following working directory.</p>
<pre><code>.
├── DESCRIPTION
├── NAMESPACE
├── R
│   └── gio.R
└── inst
    └── htmlwidgets
        ├── gio
        │   └── gio.min.js
        ├── gio.js
        ├── gio.yaml
        └── three
            └── three.min.js</code></pre>
<p>The libraries have been downloaded but the <code>gio.yml</code> file is yet to be edited. The order in which the libraries are listed matters; just as in HTML three.js needs to precede gio.js as the latter depends on the former and not vice versa.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb104-1"><a href="the-full-monty.html#cb104-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb104-2"><a href="the-full-monty.html#cb104-2"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> three</span></span>
<span id="cb104-3"><a href="the-full-monty.html#cb104-3"></a><span class="at">    </span><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="dv">110</span></span>
<span id="cb104-4"><a href="the-full-monty.html#cb104-4"></a><span class="at">    </span><span class="fu">src</span><span class="kw">:</span><span class="at"> htmlwidgets/three</span></span>
<span id="cb104-5"><a href="the-full-monty.html#cb104-5"></a><span class="at">    </span><span class="fu">script</span><span class="kw">:</span><span class="at"> three.min.js</span></span>
<span id="cb104-6"><a href="the-full-monty.html#cb104-6"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> gio</span></span>
<span id="cb104-7"><a href="the-full-monty.html#cb104-7"></a><span class="at">    </span><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="fl">2.0</span></span>
<span id="cb104-8"><a href="the-full-monty.html#cb104-8"></a><span class="at">    </span><span class="fu">src</span><span class="kw">:</span><span class="at"> htmlwidgets/gio</span></span>
<span id="cb104-9"><a href="the-full-monty.html#cb104-9"></a><span class="at">    </span><span class="fu">script</span><span class="kw">:</span><span class="at"> gio.min.js</span></span></code></pre></div>
</div>
<div id="javascript" class="section level2 unnumbered" number="">
<h2>JavaScript</h2>
<p>Let’s copy the JavaScript code from the <a href="https://giojs.org/index.html">Get Started section of gio.js</a> in the <code>gio.js</code> file’s <code>renderValue</code> function. At this point the data format is not known so we comment the line which adds data to the visualisation.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb105-1"><a href="the-full-monty.html#cb105-1"></a><span class="co">// gio.js</span></span>
<span id="cb105-2"><a href="the-full-monty.html#cb105-2"></a><span class="va">HTMLWidgets</span>.<span class="at">widget</span>(<span class="op">{</span></span>
<span id="cb105-3"><a href="the-full-monty.html#cb105-3"></a></span>
<span id="cb105-4"><a href="the-full-monty.html#cb105-4"></a>  <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;gio&#39;</span><span class="op">,</span></span>
<span id="cb105-5"><a href="the-full-monty.html#cb105-5"></a></span>
<span id="cb105-6"><a href="the-full-monty.html#cb105-6"></a>  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;output&#39;</span><span class="op">,</span></span>
<span id="cb105-7"><a href="the-full-monty.html#cb105-7"></a></span>
<span id="cb105-8"><a href="the-full-monty.html#cb105-8"></a>  <span class="dt">factory</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> width<span class="op">,</span> height) <span class="op">{</span></span>
<span id="cb105-9"><a href="the-full-monty.html#cb105-9"></a></span>
<span id="cb105-10"><a href="the-full-monty.html#cb105-10"></a>    <span class="co">// </span><span class="al">TODO</span><span class="co">: define shared variables for this instance</span></span>
<span id="cb105-11"><a href="the-full-monty.html#cb105-11"></a></span>
<span id="cb105-12"><a href="the-full-monty.html#cb105-12"></a>    <span class="cf">return</span> <span class="op">{</span></span>
<span id="cb105-13"><a href="the-full-monty.html#cb105-13"></a></span>
<span id="cb105-14"><a href="the-full-monty.html#cb105-14"></a>      <span class="dt">renderValue</span><span class="op">:</span> <span class="kw">function</span>(x) <span class="op">{</span></span>
<span id="cb105-15"><a href="the-full-monty.html#cb105-15"></a></span>
<span id="cb105-16"><a href="the-full-monty.html#cb105-16"></a>        <span class="kw">var</span> container <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;globe&quot;</span>)<span class="op">;</span></span>
<span id="cb105-17"><a href="the-full-monty.html#cb105-17"></a>        <span class="kw">var</span> controller <span class="op">=</span> <span class="kw">new</span> <span class="va">GIO</span>.<span class="at">Controller</span>(container)<span class="op">;</span></span>
<span id="cb105-18"><a href="the-full-monty.html#cb105-18"></a>        <span class="co">//controller.addData(data);</span></span>
<span id="cb105-19"><a href="the-full-monty.html#cb105-19"></a>        <span class="va">controller</span>.<span class="at">init</span>()<span class="op">;</span></span>
<span id="cb105-20"><a href="the-full-monty.html#cb105-20"></a></span>
<span id="cb105-21"><a href="the-full-monty.html#cb105-21"></a>      <span class="op">},</span></span>
<span id="cb105-22"><a href="the-full-monty.html#cb105-22"></a></span>
<span id="cb105-23"><a href="the-full-monty.html#cb105-23"></a>      <span class="dt">resize</span><span class="op">:</span> <span class="kw">function</span>(width<span class="op">,</span> height) <span class="op">{</span></span>
<span id="cb105-24"><a href="the-full-monty.html#cb105-24"></a></span>
<span id="cb105-25"><a href="the-full-monty.html#cb105-25"></a>        <span class="co">// </span><span class="al">TODO</span><span class="co">: code to re-render the widget with a new size</span></span>
<span id="cb105-26"><a href="the-full-monty.html#cb105-26"></a></span>
<span id="cb105-27"><a href="the-full-monty.html#cb105-27"></a>      <span class="op">}</span></span>
<span id="cb105-28"><a href="the-full-monty.html#cb105-28"></a></span>
<span id="cb105-29"><a href="the-full-monty.html#cb105-29"></a>    <span class="op">};</span></span>
<span id="cb105-30"><a href="the-full-monty.html#cb105-30"></a>  <span class="op">}</span></span>
<span id="cb105-31"><a href="the-full-monty.html#cb105-31"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>One can document and load the package but it will not work as the code above attempts to place the visualisation in a <code>div</code> with <code>id = "globe"</code>. As for the previously written widget, this needs to be changed to <code>el.id</code>.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb106-1"><a href="the-full-monty.html#cb106-1"></a><span class="co">// gio.js</span></span>
<span id="cb106-2"><a href="the-full-monty.html#cb106-2"></a>renderValue<span class="op">:</span> <span class="kw">function</span>(x) <span class="op">{</span></span>
<span id="cb106-3"><a href="the-full-monty.html#cb106-3"></a></span>
<span id="cb106-4"><a href="the-full-monty.html#cb106-4"></a>  <span class="kw">var</span> container <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="va">el</span>.<span class="at">id</span>)<span class="op">;</span></span>
<span id="cb106-5"><a href="the-full-monty.html#cb106-5"></a>  <span class="kw">var</span> controller <span class="op">=</span> <span class="kw">new</span> <span class="va">GIO</span>.<span class="at">Controller</span>(container)<span class="op">;</span></span>
<span id="cb106-6"><a href="the-full-monty.html#cb106-6"></a>  <span class="co">//controller.addData(data);</span></span>
<span id="cb106-7"><a href="the-full-monty.html#cb106-7"></a>  <span class="va">controller</span>.<span class="at">init</span>()<span class="op">;</span></span>
<span id="cb106-8"><a href="the-full-monty.html#cb106-8"></a></span>
<span id="cb106-9"><a href="the-full-monty.html#cb106-9"></a><span class="op">}</span></span></code></pre></div>
<p>At this stage the widget should generate a visualisation.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="the-full-monty.html#cb107-1"></a>devtools<span class="op">::</span><span class="kw">document</span>()</span>
<span id="cb107-2"><a href="the-full-monty.html#cb107-2"></a>devtools<span class="op">::</span><span class="kw">load_all</span>()</span>
<span id="cb107-3"><a href="the-full-monty.html#cb107-3"></a><span class="kw">gio</span>(<span class="dt">message =</span> <span class="st">&quot;This required but not used&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="images/gio-init.png" alt="" />
<p class="caption">Output without data</p>
</div>
<p>Not too shabby given how little work was put into this! Before we move on let us optimise something. In the JavaScript code we retrieve the <code>container</code> using <code>el.id</code> but this in effect is very inefficient: <code>el</code> is identical to <code>container</code>.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb108-1"><a href="the-full-monty.html#cb108-1"></a><span class="co">// gio.js</span></span>
<span id="cb108-2"><a href="the-full-monty.html#cb108-2"></a>renderValue<span class="op">:</span> <span class="kw">function</span>(x) <span class="op">{</span></span>
<span id="cb108-3"><a href="the-full-monty.html#cb108-3"></a></span>
<span id="cb108-4"><a href="the-full-monty.html#cb108-4"></a>  <span class="kw">var</span> controller <span class="op">=</span> <span class="kw">new</span> <span class="va">GIO</span>.<span class="at">Controller</span>(el)<span class="op">;</span></span>
<span id="cb108-5"><a href="the-full-monty.html#cb108-5"></a>  <span class="co">//controller.addData(data);</span></span>
<span id="cb108-6"><a href="the-full-monty.html#cb108-6"></a>  <span class="va">controller</span>.<span class="at">init</span>()<span class="op">;</span></span>
<span id="cb108-7"><a href="the-full-monty.html#cb108-7"></a></span>
<span id="cb108-8"><a href="the-full-monty.html#cb108-8"></a><span class="op">}</span></span></code></pre></div>
</div>
<div id="working-with-data" class="section level2 unnumbered" number="">
<h2>Working with Data</h2>
<p>An interesting start, now onto adding data. Let’s take a look at the <a href="https://giojs.org/html/docs/dataAdd.html">documentation</a> to see what data the library expects.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb109-1"><a href="the-full-monty.html#cb109-1"></a><span class="ot">[</span></span>
<span id="cb109-2"><a href="the-full-monty.html#cb109-2"></a>  <span class="fu">{</span></span>
<span id="cb109-3"><a href="the-full-monty.html#cb109-3"></a>    <span class="dt">&quot;e&quot;</span><span class="fu">:</span> <span class="st">&quot;CN&quot;</span><span class="fu">,</span></span>
<span id="cb109-4"><a href="the-full-monty.html#cb109-4"></a>    <span class="dt">&quot;i&quot;</span><span class="fu">:</span> <span class="st">&quot;US&quot;</span><span class="fu">,</span></span>
<span id="cb109-5"><a href="the-full-monty.html#cb109-5"></a>    <span class="dt">&quot;v&quot;</span><span class="fu">:</span> <span class="dv">3300000</span></span>
<span id="cb109-6"><a href="the-full-monty.html#cb109-6"></a>  <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb109-7"><a href="the-full-monty.html#cb109-7"></a>  <span class="fu">{</span></span>
<span id="cb109-8"><a href="the-full-monty.html#cb109-8"></a>    <span class="dt">&quot;e&quot;</span><span class="fu">:</span> <span class="st">&quot;CN&quot;</span><span class="fu">,</span></span>
<span id="cb109-9"><a href="the-full-monty.html#cb109-9"></a>    <span class="dt">&quot;i&quot;</span><span class="fu">:</span> <span class="st">&quot;RU&quot;</span><span class="fu">,</span></span>
<span id="cb109-10"><a href="the-full-monty.html#cb109-10"></a>    <span class="dt">&quot;v&quot;</span><span class="fu">:</span> <span class="dv">10000</span></span>
<span id="cb109-11"><a href="the-full-monty.html#cb109-11"></a>  <span class="fu">}</span></span>
<span id="cb109-12"><a href="the-full-monty.html#cb109-12"></a><span class="ot">]</span></span></code></pre></div>
<p>The JSON data should constitutes of arrays that denote arcs to draw on the globe where each arc is defined by an exporting country (<code>e</code>), an importing country (<code>i</code>), and is given a value (<code>v</code>). The importing and exporting country, the source and target of the arc, are indicated by ISO alpha-2 country codes. We can read this JSON into R.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="the-full-monty.html#cb110-1"></a><span class="co"># data.frame to test</span></span>
<span id="cb110-2"><a href="the-full-monty.html#cb110-2"></a>arcs &lt;-<span class="st"> </span>jsonlite<span class="op">::</span><span class="kw">fromJSON</span>(</span>
<span id="cb110-3"><a href="the-full-monty.html#cb110-3"></a>  <span class="st">&#39;[</span></span>
<span id="cb110-4"><a href="the-full-monty.html#cb110-4"></a><span class="st">    {</span></span>
<span id="cb110-5"><a href="the-full-monty.html#cb110-5"></a><span class="st">      &quot;e&quot;: &quot;CN&quot;,</span></span>
<span id="cb110-6"><a href="the-full-monty.html#cb110-6"></a><span class="st">      &quot;i&quot;: &quot;US&quot;,</span></span>
<span id="cb110-7"><a href="the-full-monty.html#cb110-7"></a><span class="st">      &quot;v&quot;: 3300000</span></span>
<span id="cb110-8"><a href="the-full-monty.html#cb110-8"></a><span class="st">    },</span></span>
<span id="cb110-9"><a href="the-full-monty.html#cb110-9"></a><span class="st">    {</span></span>
<span id="cb110-10"><a href="the-full-monty.html#cb110-10"></a><span class="st">      &quot;e&quot;: &quot;CN&quot;,</span></span>
<span id="cb110-11"><a href="the-full-monty.html#cb110-11"></a><span class="st">      &quot;i&quot;: &quot;RU&quot;,</span></span>
<span id="cb110-12"><a href="the-full-monty.html#cb110-12"></a><span class="st">      &quot;v&quot;: 10000</span></span>
<span id="cb110-13"><a href="the-full-monty.html#cb110-13"></a><span class="st">    }</span></span>
<span id="cb110-14"><a href="the-full-monty.html#cb110-14"></a><span class="st">  ]&#39;</span></span>
<span id="cb110-15"><a href="the-full-monty.html#cb110-15"></a>)</span>
<span id="cb110-16"><a href="the-full-monty.html#cb110-16"></a></span>
<span id="cb110-17"><a href="the-full-monty.html#cb110-17"></a><span class="kw">print</span>(arcs)</span></code></pre></div>
<pre><code>##    e  i       v
## 1 CN US 3300000
## 2 CN RU   10000</code></pre>
<p>Jsonlite automagically converts the JSON into a data frame where each row is an arc, which is great as R users tend to prefer rectangular data over lists: this is probably what the package should use as input too. Let us make some changes to the <code>gio</code> function so it takes data as input.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="the-full-monty.html#cb112-1"></a>gio &lt;-<span class="st"> </span><span class="cf">function</span>(data, <span class="dt">width =</span> <span class="ot">NULL</span>, <span class="dt">height =</span> <span class="ot">NULL</span>, <span class="dt">elementId =</span> <span class="ot">NULL</span>) {</span>
<span id="cb112-2"><a href="the-full-monty.html#cb112-2"></a></span>
<span id="cb112-3"><a href="the-full-monty.html#cb112-3"></a>  <span class="co"># forward options using x</span></span>
<span id="cb112-4"><a href="the-full-monty.html#cb112-4"></a>  x =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb112-5"><a href="the-full-monty.html#cb112-5"></a>    <span class="dt">data =</span> data</span>
<span id="cb112-6"><a href="the-full-monty.html#cb112-6"></a>  )</span>
<span id="cb112-7"><a href="the-full-monty.html#cb112-7"></a></span>
<span id="cb112-8"><a href="the-full-monty.html#cb112-8"></a>  <span class="co"># create widget</span></span>
<span id="cb112-9"><a href="the-full-monty.html#cb112-9"></a>  htmlwidgets<span class="op">::</span><span class="kw">createWidget</span>(</span>
<span id="cb112-10"><a href="the-full-monty.html#cb112-10"></a>    <span class="dt">name =</span> <span class="st">&#39;gio&#39;</span>,</span>
<span id="cb112-11"><a href="the-full-monty.html#cb112-11"></a>    x,</span>
<span id="cb112-12"><a href="the-full-monty.html#cb112-12"></a>    <span class="dt">width =</span> width,</span>
<span id="cb112-13"><a href="the-full-monty.html#cb112-13"></a>    <span class="dt">height =</span> height,</span>
<span id="cb112-14"><a href="the-full-monty.html#cb112-14"></a>    <span class="dt">package =</span> <span class="st">&#39;gio&#39;</span>,</span>
<span id="cb112-15"><a href="the-full-monty.html#cb112-15"></a>    <span class="dt">elementId =</span> elementId</span>
<span id="cb112-16"><a href="the-full-monty.html#cb112-16"></a>  )</span>
<span id="cb112-17"><a href="the-full-monty.html#cb112-17"></a>}</span></code></pre></div>
<p>This must be reflected in the <code>play.js</code> file where we uncomment the line previously commented and use <code>x.data</code> passed from R.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb113-1"><a href="the-full-monty.html#cb113-1"></a><span class="co">// gio.js</span></span>
<span id="cb113-2"><a href="the-full-monty.html#cb113-2"></a>renderValue<span class="op">:</span> <span class="kw">function</span>(x) <span class="op">{</span></span>
<span id="cb113-3"><a href="the-full-monty.html#cb113-3"></a></span>
<span id="cb113-4"><a href="the-full-monty.html#cb113-4"></a>  <span class="kw">var</span> controller <span class="op">=</span> <span class="kw">new</span> <span class="va">GIO</span>.<span class="at">Controller</span>(el)<span class="op">;</span></span>
<span id="cb113-5"><a href="the-full-monty.html#cb113-5"></a>  <span class="va">controller</span>.<span class="at">addData</span>(<span class="va">x</span>.<span class="at">data</span>)<span class="op">;</span> <span class="co">// uncomment &amp; use x.data</span></span>
<span id="cb113-6"><a href="the-full-monty.html#cb113-6"></a>  <span class="va">controller</span>.<span class="at">init</span>()<span class="op">;</span></span>
<span id="cb113-7"><a href="the-full-monty.html#cb113-7"></a></span>
<span id="cb113-8"><a href="the-full-monty.html#cb113-8"></a><span class="op">}</span></span></code></pre></div>
<p>We can now use the function with the data to plot arcs!</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="the-full-monty.html#cb114-1"></a>devtools<span class="op">::</span><span class="kw">document</span>()</span>
<span id="cb114-2"><a href="the-full-monty.html#cb114-2"></a>devtools<span class="op">::</span><span class="kw">load_all</span>()</span>
<span id="cb114-3"><a href="the-full-monty.html#cb114-3"></a><span class="kw">gio</span>(arcs)</span></code></pre></div>
<p>Unfortunately, this breaks everything and we are presented with a blank screen. Using <code>console.log</code> or looking at the source code the rendered widget reveals the problem: the data isn’t actually in the correct format!</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb115-1"><a href="the-full-monty.html#cb115-1"></a><span class="fu">{</span><span class="dt">&quot;x&quot;</span><span class="fu">:{</span><span class="dt">&quot;data&quot;</span><span class="fu">:{</span><span class="dt">&quot;e&quot;</span><span class="fu">:</span><span class="ot">[</span><span class="st">&quot;CN&quot;</span><span class="ot">,</span><span class="st">&quot;CN&quot;</span><span class="ot">]</span><span class="fu">,</span><span class="dt">&quot;i&quot;</span><span class="fu">:</span><span class="ot">[</span><span class="st">&quot;US&quot;</span><span class="ot">,</span><span class="st">&quot;RU&quot;</span><span class="ot">]</span><span class="fu">,</span><span class="dt">&quot;v&quot;</span><span class="fu">:</span><span class="ot">[</span><span class="dv">3300000</span><span class="ot">,</span><span class="dv">10000</span><span class="ot">]</span><span class="fu">}},</span><span class="dt">&quot;evals&quot;</span><span class="fu">:</span><span class="ot">[]</span><span class="fu">,</span><span class="dt">&quot;jsHooks&quot;</span><span class="fu">:</span><span class="ot">[]</span><span class="fu">}</span></span></code></pre></div>
<p>Htmlwidgets actually serialised the data frame column-wise (long) where each array is a column, whereas gio.js expect the data to be wide (row-wise serialisation) where each array is a arc (row).</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="the-full-monty.html#cb116-1"></a><span class="co"># column-wise</span></span>
<span id="cb116-2"><a href="the-full-monty.html#cb116-2"></a>jsonlite<span class="op">::</span><span class="kw">toJSON</span>(arcs, <span class="dt">dataframe =</span> <span class="st">&quot;columns&quot;</span>)</span></code></pre></div>
<pre><code>## {&quot;e&quot;:[&quot;CN&quot;,&quot;CN&quot;],&quot;i&quot;:[&quot;US&quot;,&quot;RU&quot;],&quot;v&quot;:[3300000,10000]}</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="the-full-monty.html#cb118-1"></a><span class="co"># row-wise</span></span>
<span id="cb118-2"><a href="the-full-monty.html#cb118-2"></a>jsonlite<span class="op">::</span><span class="kw">toJSON</span>(arcs, <span class="dt">dataframe =</span> <span class="st">&quot;rows&quot;</span>)</span></code></pre></div>
<pre><code>## [{&quot;e&quot;:&quot;CN&quot;,&quot;i&quot;:&quot;US&quot;,&quot;v&quot;:3300000},{&quot;e&quot;:&quot;CN&quot;,&quot;i&quot;:&quot;RU&quot;,&quot;v&quot;:10000}]</code></pre>
<p>As mentioned previously, convention has it that rectangular data (data frames) are serialised row-wise. This is likely to be a recurring problem.</p>
</div>
<div id="transforming-data" class="section level2 unnumbered" number="">
<h2>Transforming Data</h2>
<p>There are multiple ways to transform the data and ensure the serialised JSON is as the JavaScript library expects it to be.</p>
<div id="in-javascript" class="section level3 unnumbered" number="">
<h3>In JavaScript</h3>
<p>JavaScript can be used to transform the data, leaving the serialiser as-is to reshape the data in the client. The HTMLwidget JavaScript library (already imported by default) exports an object which provides a method, <code>dataframeToD3</code>, to transform the data from long to wide.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb120-1"><a href="the-full-monty.html#cb120-1"></a><span class="co">// gio.js</span></span>
<span id="cb120-2"><a href="the-full-monty.html#cb120-2"></a>renderValue<span class="op">:</span> <span class="kw">function</span>(x) <span class="op">{</span></span>
<span id="cb120-3"><a href="the-full-monty.html#cb120-3"></a></span>
<span id="cb120-4"><a href="the-full-monty.html#cb120-4"></a>  <span class="co">// long to wide</span></span>
<span id="cb120-5"><a href="the-full-monty.html#cb120-5"></a>  <span class="va">x</span>.<span class="at">data</span> <span class="op">=</span> <span class="va">HTMLWidgets</span>.<span class="at">dataframeToD3</span>(<span class="va">x</span>.<span class="at">data</span>)<span class="op">;</span></span>
<span id="cb120-6"><a href="the-full-monty.html#cb120-6"></a></span>
<span id="cb120-7"><a href="the-full-monty.html#cb120-7"></a>  <span class="kw">var</span> controller <span class="op">=</span> <span class="kw">new</span> <span class="va">GIO</span>.<span class="at">Controller</span>(el)<span class="op">;</span></span>
<span id="cb120-8"><a href="the-full-monty.html#cb120-8"></a>  <span class="va">controller</span>.<span class="at">addData</span>(<span class="va">x</span>.<span class="at">data</span>)<span class="op">;</span> </span>
<span id="cb120-9"><a href="the-full-monty.html#cb120-9"></a>  <span class="va">controller</span>.<span class="at">init</span>()<span class="op">;</span></span>
<span id="cb120-10"><a href="the-full-monty.html#cb120-10"></a></span>
<span id="cb120-11"><a href="the-full-monty.html#cb120-11"></a><span class="op">}</span></span></code></pre></div>
</div>
<div id="in-r" class="section level3 unnumbered" number="">
<h3>In R</h3>
<p>Instead of serialising the data a certain way then correct in JavaScript as demonstrated previously, one can also modify, or even replace, htmlwidgets’ default serialiser. Speaking of which, below is the default serializer used by htmlwidgets.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="the-full-monty.html#cb121-1"></a><span class="cf">function</span> (x, ..., <span class="dt">dataframe =</span> <span class="st">&quot;columns&quot;</span>, <span class="dt">null =</span> <span class="st">&quot;null&quot;</span>, <span class="dt">na =</span> <span class="st">&quot;null&quot;</span>, </span>
<span id="cb121-2"><a href="the-full-monty.html#cb121-2"></a>  <span class="dt">auto_unbox =</span> <span class="ot">TRUE</span>, <span class="dt">digits =</span> <span class="kw">getOption</span>(<span class="st">&quot;shiny.json.digits&quot;</span>, <span class="dv">16</span>), </span>
<span id="cb121-3"><a href="the-full-monty.html#cb121-3"></a>  <span class="dt">use_signif =</span> <span class="ot">TRUE</span>, <span class="dt">force =</span> <span class="ot">TRUE</span>, <span class="dt">POSIXt =</span> <span class="st">&quot;ISO8601&quot;</span>, <span class="dt">UTC =</span> <span class="ot">TRUE</span>, </span>
<span id="cb121-4"><a href="the-full-monty.html#cb121-4"></a>  <span class="dt">rownames =</span> <span class="ot">FALSE</span>, <span class="dt">keep_vec_names =</span> <span class="ot">TRUE</span>, <span class="dt">strict_atomic =</span> <span class="ot">TRUE</span>) </span>
<span id="cb121-5"><a href="the-full-monty.html#cb121-5"></a>{</span>
<span id="cb121-6"><a href="the-full-monty.html#cb121-6"></a>  <span class="cf">if</span> (strict_atomic) </span>
<span id="cb121-7"><a href="the-full-monty.html#cb121-7"></a>      x &lt;-<span class="st"> </span><span class="kw">I</span>(x)</span>
<span id="cb121-8"><a href="the-full-monty.html#cb121-8"></a>  jsonlite<span class="op">::</span><span class="kw">toJSON</span>(x, <span class="dt">dataframe =</span> dataframe, <span class="dt">null =</span> null, <span class="dt">na =</span> na, </span>
<span id="cb121-9"><a href="the-full-monty.html#cb121-9"></a>    <span class="dt">auto_unbox =</span> auto_unbox, <span class="dt">digits =</span> digits, <span class="dt">use_signif =</span> use_signif, </span>
<span id="cb121-10"><a href="the-full-monty.html#cb121-10"></a>    <span class="dt">force =</span> force, <span class="dt">POSIXt =</span> POSIXt, <span class="dt">UTC =</span> UTC, <span class="dt">rownames =</span> rownames, </span>
<span id="cb121-11"><a href="the-full-monty.html#cb121-11"></a>    <span class="dt">keep_vec_names =</span> keep_vec_names, <span class="dt">json_verbatim =</span> <span class="ot">TRUE</span>, ...)</span>
<span id="cb121-12"><a href="the-full-monty.html#cb121-12"></a>}</span></code></pre></div>
<p>The problem at hand is caused by the <code>dataframe</code> argument which is set to <code>columns</code> where it should be set <code>rows</code> (for row-wise). Arguments are passed to the serialiser indirectly, in the form of a list set as <code>TOJSON_ARGS</code> attribute to the object <code>x</code> that is serialised. We could thus change the <code>gio</code> function to reflect the aforementioned change.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="the-full-monty.html#cb122-1"></a>gio &lt;-<span class="st"> </span><span class="cf">function</span>(data, <span class="dt">width =</span> <span class="ot">NULL</span>, <span class="dt">height =</span> <span class="ot">NULL</span>, <span class="dt">elementId =</span> <span class="ot">NULL</span>) {</span>
<span id="cb122-2"><a href="the-full-monty.html#cb122-2"></a></span>
<span id="cb122-3"><a href="the-full-monty.html#cb122-3"></a>  <span class="co"># forward options using x</span></span>
<span id="cb122-4"><a href="the-full-monty.html#cb122-4"></a>  x =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb122-5"><a href="the-full-monty.html#cb122-5"></a>    <span class="dt">data =</span> data</span>
<span id="cb122-6"><a href="the-full-monty.html#cb122-6"></a>  )</span>
<span id="cb122-7"><a href="the-full-monty.html#cb122-7"></a></span>
<span id="cb122-8"><a href="the-full-monty.html#cb122-8"></a>  <span class="co"># serialise data.frames to wide (not long as default)</span></span>
<span id="cb122-9"><a href="the-full-monty.html#cb122-9"></a>  <span class="kw">attr</span>(x, <span class="st">&#39;TOJSON_ARGS&#39;</span>) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">dataframe =</span> <span class="st">&quot;rows&quot;</span>)</span>
<span id="cb122-10"><a href="the-full-monty.html#cb122-10"></a></span>
<span id="cb122-11"><a href="the-full-monty.html#cb122-11"></a>  <span class="co"># create widget</span></span>
<span id="cb122-12"><a href="the-full-monty.html#cb122-12"></a>  htmlwidgets<span class="op">::</span><span class="kw">createWidget</span>(</span>
<span id="cb122-13"><a href="the-full-monty.html#cb122-13"></a>    <span class="dt">name =</span> <span class="st">&#39;gio&#39;</span>,</span>
<span id="cb122-14"><a href="the-full-monty.html#cb122-14"></a>    x,</span>
<span id="cb122-15"><a href="the-full-monty.html#cb122-15"></a>    <span class="dt">width =</span> width,</span>
<span id="cb122-16"><a href="the-full-monty.html#cb122-16"></a>    <span class="dt">height =</span> height,</span>
<span id="cb122-17"><a href="the-full-monty.html#cb122-17"></a>    <span class="dt">package =</span> <span class="st">&#39;gio&#39;</span>,</span>
<span id="cb122-18"><a href="the-full-monty.html#cb122-18"></a>    <span class="dt">elementId =</span> elementId</span>
<span id="cb122-19"><a href="the-full-monty.html#cb122-19"></a>  )</span>
<span id="cb122-20"><a href="the-full-monty.html#cb122-20"></a>}</span></code></pre></div>
<p>The above may appear confusing at first as one rarely encounters the <code>attr</code> replacement function.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="the-full-monty.html#cb123-1"></a><span class="kw">attr</span>(cars, <span class="st">&quot;hello&quot;</span>) &lt;-<span class="st"> &quot;world&quot;</span> <span class="co"># set </span></span>
<span id="cb123-2"><a href="the-full-monty.html#cb123-2"></a><span class="kw">attr</span>(cars, <span class="st">&quot;hello&quot;</span>) <span class="co"># get </span></span></code></pre></div>
<pre><code>## [1] &quot;world&quot;</code></pre>
<p>Otherwise the serializer can also be replaced in its entirety, also by setting an attribute, <code>TOJSON_FUNC</code>, to the <code>x</code> object. Below the serialiser is changed to jsonify <span class="citation">(Cooley <a href="#ref-R-jsonify" role="doc-biblioref">2020</a>)</span> which by default serialises data frames to wide, unlike htmlwidgets’ serialiser, thereby also fixing the issue.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="the-full-monty.html#cb125-1"></a>gio &lt;-<span class="st"> </span><span class="cf">function</span>(data, <span class="dt">width =</span> <span class="ot">NULL</span>, <span class="dt">height =</span> <span class="ot">NULL</span>, <span class="dt">elementId =</span> <span class="ot">NULL</span>) {</span>
<span id="cb125-2"><a href="the-full-monty.html#cb125-2"></a></span>
<span id="cb125-3"><a href="the-full-monty.html#cb125-3"></a>  <span class="co"># forward options using x</span></span>
<span id="cb125-4"><a href="the-full-monty.html#cb125-4"></a>  x =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb125-5"><a href="the-full-monty.html#cb125-5"></a>    <span class="dt">data =</span> data</span>
<span id="cb125-6"><a href="the-full-monty.html#cb125-6"></a>  )</span>
<span id="cb125-7"><a href="the-full-monty.html#cb125-7"></a></span>
<span id="cb125-8"><a href="the-full-monty.html#cb125-8"></a>  <span class="co"># replace serialiser</span></span>
<span id="cb125-9"><a href="the-full-monty.html#cb125-9"></a>  <span class="kw">attr</span>(x, <span class="st">&#39;TOJSON_FUNC&#39;</span>) &lt;-<span class="st"> </span>gio_serialiser</span>
<span id="cb125-10"><a href="the-full-monty.html#cb125-10"></a></span>
<span id="cb125-11"><a href="the-full-monty.html#cb125-11"></a>  <span class="co"># create widget</span></span>
<span id="cb125-12"><a href="the-full-monty.html#cb125-12"></a>  htmlwidgets<span class="op">::</span><span class="kw">createWidget</span>(</span>
<span id="cb125-13"><a href="the-full-monty.html#cb125-13"></a>    <span class="dt">name =</span> <span class="st">&#39;gio&#39;</span>,</span>
<span id="cb125-14"><a href="the-full-monty.html#cb125-14"></a>    x,</span>
<span id="cb125-15"><a href="the-full-monty.html#cb125-15"></a>    <span class="dt">width =</span> width,</span>
<span id="cb125-16"><a href="the-full-monty.html#cb125-16"></a>    <span class="dt">height =</span> height,</span>
<span id="cb125-17"><a href="the-full-monty.html#cb125-17"></a>    <span class="dt">package =</span> <span class="st">&#39;gio&#39;</span>,</span>
<span id="cb125-18"><a href="the-full-monty.html#cb125-18"></a>    <span class="dt">elementId =</span> elementId</span>
<span id="cb125-19"><a href="the-full-monty.html#cb125-19"></a>  )</span>
<span id="cb125-20"><a href="the-full-monty.html#cb125-20"></a>}</span>
<span id="cb125-21"><a href="the-full-monty.html#cb125-21"></a></span>
<span id="cb125-22"><a href="the-full-monty.html#cb125-22"></a><span class="co"># serialiser</span></span>
<span id="cb125-23"><a href="the-full-monty.html#cb125-23"></a>gio_serialiser &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb125-24"><a href="the-full-monty.html#cb125-24"></a>  jsonify<span class="op">::</span><span class="kw">to_json</span>(x, <span class="dt">unbox =</span> <span class="ot">TRUE</span>)</span>
<span id="cb125-25"><a href="the-full-monty.html#cb125-25"></a>}</span></code></pre></div>
<p>Alternatively, one can also leave all serialisers unchanged and instead format the data in R prior to the serialisation, changing the dataframe to a row-wise list.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="the-full-monty.html#cb126-1"></a>x =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb126-2"><a href="the-full-monty.html#cb126-2"></a>  <span class="dt">data =</span> <span class="kw">apply</span>(data, <span class="dv">1</span>, as.list)</span>
<span id="cb126-3"><a href="the-full-monty.html#cb126-3"></a>)</span></code></pre></div>
</div>
<div id="pros-cons" class="section level3 unnumbered" number="">
<h3>Pros &amp; Cons</h3>
<p>There are pros and cons to each methods. The preferable method is probably to only alter the argument(s) where needed, this is the method used in the remainder of the book. Replacing the serialiser in its entirety should not be necessary, only do this once you are very familiar with serialisation and truly see a need for it. Moreover htmlwidgets’ serialiser extends jsonlite to allow converting JavaScript code which will come in handy later on. Transforming the data in JavaScript has one drawback, <code>HTMLWidgets.dataframeToD3</code> cannot be applied to the entire <code>x</code> object, it will only work on the subsets that hold the column-wise data (<code>x.data</code>) which tends to lead to clunky code as one uses said function in various places.</p>
<div class="figure">
<img src="images/gio-data.png" alt="" />
<p class="caption">Gio output with correct serialisation</p>
</div>
</div>
</div>
<div id="on-print" class="section level2 unnumbered" number="">
<h2>On Print</h2>
<p>Let’s add the option to style the globe, gio.js provides mutliple <a href="https://giojs.org/html/docs/colorStyle.html">themes</a> but they are currently not applicable from R. As a matter of fact, gio.js provides dozens of customisation options that should be available in the package as well. These, however, probably should be split across different functions, just like they are in gio.js, rather than all be accessible from a single function containing hundreds of arguments. This begs the question, when would one use another function given the function <code>gio</code> generates the visualisation? As it happens <code>gio</code> itself (or rather the function <code>htmlwidgets::createWidget</code> it contains) does not render the output, it returns an object of class “htmlwidget” which actually renders the visualisation on print (literally <code>htmlwidget.print</code> method).</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="the-full-monty.html#cb127-1"></a>g &lt;-<span class="st"> </span><span class="kw">gio</span>(arcs) <span class="co"># nothing renders</span></span>
<span id="cb127-2"><a href="the-full-monty.html#cb127-2"></a>g <span class="co"># visualisation renders</span></span></code></pre></div>
<p>Therefore, one can use functions on the object returned by <code>gio</code> which contains, amongst other things, the <code>x</code> list to which we can make changes, append data, or do any other operation that standard R lists allow.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="the-full-monty.html#cb128-1"></a><span class="kw">print</span>(g<span class="op">$</span>x)</span>
<span id="cb128-2"><a href="the-full-monty.html#cb128-2"></a></span>
<span id="cb128-3"><a href="the-full-monty.html#cb128-3"></a><span class="co">## $data</span></span>
<span id="cb128-4"><a href="the-full-monty.html#cb128-4"></a><span class="co">##    e  i       v</span></span>
<span id="cb128-5"><a href="the-full-monty.html#cb128-5"></a><span class="co">## 1 CN US 3300000</span></span>
<span id="cb128-6"><a href="the-full-monty.html#cb128-6"></a><span class="co">## 2 CN RU   10000</span></span>
<span id="cb128-7"><a href="the-full-monty.html#cb128-7"></a><span class="co">## </span></span>
<span id="cb128-8"><a href="the-full-monty.html#cb128-8"></a><span class="co">## attr(,&quot;TOJSON_ARGS&quot;)</span></span>
<span id="cb128-9"><a href="the-full-monty.html#cb128-9"></a><span class="co">## attr(,&quot;TOJSON_ARGS&quot;)$dataframe</span></span>
<span id="cb128-10"><a href="the-full-monty.html#cb128-10"></a><span class="co">## [1] &quot;rows&quot;</span></span></code></pre></div>
<p>This clarified the function to change the style of the visualisation can be added to the package. It would take as input the output of <code>gio</code> and append the style (name of theme) to the <code>x</code> list, this would then be used in JavaScript to change the look of the visualisation.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="the-full-monty.html#cb129-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb129-2"><a href="the-full-monty.html#cb129-2"></a>gio_style &lt;-<span class="st"> </span><span class="cf">function</span>(g, <span class="dt">style =</span> <span class="st">&quot;magic&quot;</span>){</span>
<span id="cb129-3"><a href="the-full-monty.html#cb129-3"></a>  g<span class="op">$</span>x<span class="op">$</span>style &lt;-<span class="st"> </span>style</span>
<span id="cb129-4"><a href="the-full-monty.html#cb129-4"></a>  <span class="kw">return</span>(g)</span>
<span id="cb129-5"><a href="the-full-monty.html#cb129-5"></a>}</span></code></pre></div>
<p>The style is applied using the <code>setStyle</code> method on the controller before the visualisation is created, before the <code>init</code> method is called, using the style passed from R: <code>x.style</code>.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb130-1"><a href="the-full-monty.html#cb130-1"></a><span class="co">// gio.js</span></span>
<span id="cb130-2"><a href="the-full-monty.html#cb130-2"></a>renderValue<span class="op">:</span> <span class="kw">function</span>(x) <span class="op">{</span></span>
<span id="cb130-3"><a href="the-full-monty.html#cb130-3"></a></span>
<span id="cb130-4"><a href="the-full-monty.html#cb130-4"></a>  <span class="kw">var</span> controller <span class="op">=</span> <span class="kw">new</span> <span class="va">GIO</span>.<span class="at">Controller</span>(el)<span class="op">;</span></span>
<span id="cb130-5"><a href="the-full-monty.html#cb130-5"></a>  <span class="va">controller</span>.<span class="at">addData</span>(<span class="va">x</span>.<span class="at">data</span>)<span class="op">;</span> </span>
<span id="cb130-6"><a href="the-full-monty.html#cb130-6"></a></span>
<span id="cb130-7"><a href="the-full-monty.html#cb130-7"></a>  <span class="va">controller</span>.<span class="at">setStyle</span>(<span class="va">x</span>.<span class="at">style</span>)<span class="op">;</span> <span class="co">// set style</span></span>
<span id="cb130-8"><a href="the-full-monty.html#cb130-8"></a></span>
<span id="cb130-9"><a href="the-full-monty.html#cb130-9"></a>  <span class="va">controller</span>.<span class="at">init</span>()<span class="op">;</span></span>
<span id="cb130-10"><a href="the-full-monty.html#cb130-10"></a></span>
<span id="cb130-11"><a href="the-full-monty.html#cb130-11"></a><span class="op">}</span></span></code></pre></div>
<p>We can now run <code>devtools::load_all</code> to export the newly written function and load the functions in the environment with <code>devtools::load_all</code>.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="the-full-monty.html#cb131-1"></a>g1 &lt;-<span class="st"> </span><span class="kw">gio</span>(arcs)</span>
<span id="cb131-2"><a href="the-full-monty.html#cb131-2"></a>g2 &lt;-<span class="st"> </span><span class="kw">gio_style</span>(g1, <span class="st">&quot;juicyCake&quot;</span>)</span>
<span id="cb131-3"><a href="the-full-monty.html#cb131-3"></a></span>
<span id="cb131-4"><a href="the-full-monty.html#cb131-4"></a>g2</span></code></pre></div>
<div class="figure">
<img src="images/gio-style.png" alt="" />
<p class="caption">Gio with a new style</p>
</div>
<p>This is great but can be greatly improved upon with the magrittr pipe <span class="citation">(Bache and Wickham <a href="#ref-R-magrittr" role="doc-biblioref">2014</a>)</span>, it would allow easily passing the output of each function to the next to obtain an API akin to that of plotly or highcharter.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="the-full-monty.html#cb132-1"></a><span class="kw">library</span>(magrittr)</span>
<span id="cb132-2"><a href="the-full-monty.html#cb132-2"></a></span>
<span id="cb132-3"><a href="the-full-monty.html#cb132-3"></a><span class="kw">gio</span>(arcs) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb132-4"><a href="the-full-monty.html#cb132-4"></a><span class="st">  </span><span class="kw">gio_style</span>(<span class="st">&quot;juicyCake&quot;</span>)</span></code></pre></div>
<p>The pipe drastically improves the API that gio provides its users and thus probably should be exported by the package; the usethis package provides a function to easily do so.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="the-full-monty.html#cb133-1"></a><span class="co"># export the pipe</span></span>
<span id="cb133-2"><a href="the-full-monty.html#cb133-2"></a>usethis<span class="op">::</span><span class="kw">use_pipe</span>()</span></code></pre></div>
<p>This closes this chapter but is not the last we see of gio.js, we shall use it as example in the next chapters as we extend its functionalities, polish certain aspects such as sizing and security.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-magrittr">
<p>Bache, Stefan Milton, and Hadley Wickham. 2014. <em>Magrittr: A Forward-Pipe Operator for R</em>. <a href="https://CRAN.R-project.org/package=magrittr">https://CRAN.R-project.org/package=magrittr</a>.</p>
</div>
<div id="ref-R-jsonify">
<p>Cooley, David. 2020. <em>Jsonify: Convert Between ’R’ Objects and Javascript Object Notation (Json)</em>. <a href="https://CRAN.R-project.org/package=jsonify">https://CRAN.R-project.org/package=jsonify</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="a-realistic-widget.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="advanced-topics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/JohnCoene/javascript-for-r/edit/master/3-23-htmlwidgets-gio.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
