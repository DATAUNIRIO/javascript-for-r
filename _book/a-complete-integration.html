<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 A Complete Integration | JavaScript for R</title>
  <meta name="description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 A Complete Integration | JavaScript for R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="github-repo" content="yihui/bookdown-crc" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 A Complete Integration | JavaScript for R" />
  
  <meta name="twitter:description" content="Invite JavaScript into your Data Science workflow." />
  

<meta name="author" content="John Coene" />


<meta name="date" content="2020-07-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-1.html"/>
<link rel="next" href="tips-tricks.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>
<script src="libs/core-js/shim.min.js"></script>
<script src="libs/react/react.min.js"></script>
<script src="libs/react/react-dom.min.js"></script>
<script src="libs/reactwidget/react-tools.js"></script>
<script src="libs/reactable-binding/reactable.js"></script>
<script src="libs/r2d3-render/r2d3-render.js"></script>
<script src="libs/webcomponents/webcomponents.js"></script>
<script src="libs/r2d3-binding/r2d3.js"></script>
<script src="libs/d3v5/d3.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R and JavaScript</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i>Disclaimer</a></li>
</ul></li>
<li class="part"><span><b>I Basics &amp; Roadmap</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#rationale"><i class="fa fa-check"></i>Rationale</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#package-development"><i class="fa fa-check"></i>Package Development</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#json"><i class="fa fa-check"></i>JSON</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#javascript"><i class="fa fa-check"></i>JavaScript</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#methods"><i class="fa fa-check"></i>Methods</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#v8"><i class="fa fa-check"></i>V8</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#htmlwidgets"><i class="fa fa-check"></i>htmlwidgets</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#shiny"><i class="fa fa-check"></i>Shiny</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#reactr"><i class="fa fa-check"></i>reactR</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#bubble"><i class="fa fa-check"></i>bubble</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#r2d3"><i class="fa fa-check"></i>r2d3</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II JavaScript for Computations</b></span></li>
<li class="chapter" data-level="2" data-path="the-v8-engine.html"><a href="the-v8-engine.html"><i class="fa fa-check"></i><b>2</b> The V8 Engine</a>
<ul>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#installation"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#basics"><i class="fa fa-check"></i>Basics</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#external-libraries"><i class="fa fa-check"></i>External Libraries</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#with-npm"><i class="fa fa-check"></i>With Npm</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#use-in-packages"><i class="fa fa-check"></i>Use in Packages</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="node.html"><a href="node.html"><i class="fa fa-check"></i><b>3</b> Node.js with Bubble</a>
<ul>
<li class="chapter" data-level="" data-path="node.html"><a href="node.html#basics-1"><i class="fa fa-check"></i>Basics</a></li>
<li class="chapter" data-level="" data-path="node.html"><a href="node.html#r-markdown-engine"><i class="fa fa-check"></i>R Markdown Engine</a></li>
<li class="chapter" data-level="" data-path="node.html"><a href="node.html#npm"><i class="fa fa-check"></i>Npm</a></li>
</ul></li>
<li class="part"><span><b>III Web Development with Shiny</b></span></li>
<li class="chapter" data-level="4" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>4</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction-1.html"><a href="introduction-1.html#static-files"><i class="fa fa-check"></i>Static Files</a></li>
<li class="chapter" data-level="" data-path="introduction-1.html"><a href="introduction-1.html#example---alerts"><i class="fa fa-check"></i>Example - Alerts</a></li>
<li class="chapter" data-level="" data-path="introduction-1.html"><a href="introduction-1.html#from-r-to-javascript"><i class="fa fa-check"></i>From R to JavaScript</a></li>
<li class="chapter" data-level="" data-path="introduction-1.html"><a href="introduction-1.html#from-javascript-to-r"><i class="fa fa-check"></i>From JavaScript to R</a></li>
<li class="chapter" data-level="" data-path="introduction-1.html"><a href="introduction-1.html#deserialise"><i class="fa fa-check"></i>Deserialise</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-complete-integration.html"><a href="a-complete-integration.html"><i class="fa fa-check"></i><b>5</b> A Complete Integration</a>
<ul>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#serialisation"><i class="fa fa-check"></i>Serialisation</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#events-callbacks"><i class="fa fa-check"></i>Events &amp; Callbacks</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#as-a-package"><i class="fa fa-check"></i>As a Package</a>
<ul>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#dependencies"><i class="fa fa-check"></i>Dependencies</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#r-code"><i class="fa fa-check"></i>R Code</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#javascript-code"><i class="fa fa-check"></i>JavaScript Code</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#input-handler"><i class="fa fa-check"></i>Input Handler</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#wrapping-up"><i class="fa fa-check"></i>Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#exercises"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tips-tricks.html"><a href="tips-tricks.html"><i class="fa fa-check"></i><b>6</b> Tips &amp; Tricks</a>
<ul>
<li class="chapter" data-level="" data-path="tips-tricks.html"><a href="tips-tricks.html#events"><i class="fa fa-check"></i>Events</a></li>
<li class="chapter" data-level="" data-path="tips-tricks.html"><a href="tips-tricks.html#table-buttons"><i class="fa fa-check"></i>Table Buttons</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="custom-outputs.html"><a href="custom-outputs.html"><i class="fa fa-check"></i><b>7</b> Custom Outputs</a>
<ul>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#inner-workings"><i class="fa fa-check"></i>Inner-workings</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#discover-lena.js"><i class="fa fa-check"></i>Discover Lena.js</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#setup"><i class="fa fa-check"></i>Setup</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#output"><i class="fa fa-check"></i>Output</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#render"><i class="fa fa-check"></i>Render</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#javascript-binding"><i class="fa fa-check"></i>JavaScript Binding</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#test"><i class="fa fa-check"></i>Test</a></li>
</ul></li>
<li class="part"><span><b>IV Data Visualisation</b></span></li>
<li class="chapter" data-level="8" data-path="introduction-2.html"><a href="introduction-2.html"><i class="fa fa-check"></i><b>8</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction-2.html"><a href="introduction-2.html#candidate-libraries"><i class="fa fa-check"></i>Candidate Libraries</a>
<ul>
<li class="chapter" data-level="" data-path="introduction-2.html"><a href="introduction-2.html#plotly"><i class="fa fa-check"></i>Plotly</a></li>
<li class="chapter" data-level="" data-path="introduction-2.html"><a href="introduction-2.html#highchart.js"><i class="fa fa-check"></i>Highchart.js</a></li>
<li class="chapter" data-level="" data-path="introduction-2.html"><a href="introduction-2.html#chart.js"><i class="fa fa-check"></i>Chart.js</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction-2.html"><a href="introduction-2.html#how-it-works"><i class="fa fa-check"></i>How it works</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="your-first-widget.html"><a href="your-first-widget.html"><i class="fa fa-check"></i><b>9</b> Your First Widget</a>
<ul>
<li class="chapter" data-level="" data-path="your-first-widget.html"><a href="your-first-widget.html#the-scaffold"><i class="fa fa-check"></i>The Scaffold</a></li>
<li class="chapter" data-level="" data-path="your-first-widget.html"><a href="your-first-widget.html#the-output"><i class="fa fa-check"></i>The Output</a></li>
<li class="chapter" data-level="" data-path="your-first-widget.html"><a href="your-first-widget.html#javascript-side"><i class="fa fa-check"></i>JavaScript-side</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="a-realistic-widget.html"><a href="a-realistic-widget.html"><i class="fa fa-check"></i><b>10</b> A Realistic Widget</a>
<ul>
<li class="chapter" data-level="" data-path="a-realistic-widget.html"><a href="a-realistic-widget.html#dependency"><i class="fa fa-check"></i>Dependency</a></li>
<li class="chapter" data-level="" data-path="a-realistic-widget.html"><a href="a-realistic-widget.html#javascript-1"><i class="fa fa-check"></i>JavaScript</a></li>
<li class="chapter" data-level="" data-path="a-realistic-widget.html"><a href="a-realistic-widget.html#html-element"><i class="fa fa-check"></i>HTML Element</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="the-full-monty.html"><a href="the-full-monty.html"><i class="fa fa-check"></i><b>11</b> The Full Monty</a>
<ul>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#dependencies-1"><i class="fa fa-check"></i>Dependencies</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#javascript-2"><i class="fa fa-check"></i>JavaScript</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#working-with-data"><i class="fa fa-check"></i>Working with Data</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#transforming-data"><i class="fa fa-check"></i>Transforming Data</a>
<ul>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#in-javascript"><i class="fa fa-check"></i>In JavaScript</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#in-r"><i class="fa fa-check"></i>In R</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#pros-cons"><i class="fa fa-check"></i>Pros &amp; Cons</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#on-print"><i class="fa fa-check"></i>On Print</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="advanced-topics.html"><a href="advanced-topics.html"><i class="fa fa-check"></i><b>12</b> Advanced Topics</a>
<ul>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#shared-variables"><i class="fa fa-check"></i>Shared Variables</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#sizing"><i class="fa fa-check"></i>Sizing</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#sizing-policy"><i class="fa fa-check"></i>Sizing Policy</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#resizing"><i class="fa fa-check"></i>Resizing</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#pre-render-hooks-security"><i class="fa fa-check"></i>Pre Render Hooks &amp; Security</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#javascript-code-1"><i class="fa fa-check"></i>JavaScript Code</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#prepend-append-content"><i class="fa fa-check"></i>Prepend &amp; Append Content</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#dependencies-2"><i class="fa fa-check"></i>Dependencies</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#compatibility"><i class="fa fa-check"></i>Compatibility</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="working-with-shiny.html"><a href="working-with-shiny.html"><i class="fa fa-check"></i><b>13</b> Working with Shiny</a>
<ul>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#javascript-to-r"><i class="fa fa-check"></i>JavaScript to R</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#input-handler-1"><i class="fa fa-check"></i>Input Handler</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#r-to-javascript"><i class="fa fa-check"></i>R to JavaScript</a>
<ul>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#send-data"><i class="fa fa-check"></i>Send Data</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#retrieve-widget-instance"><i class="fa fa-check"></i>Retrieve Widget Instance</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#handle-data"><i class="fa fa-check"></i>Handle Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#proxy-function"><i class="fa fa-check"></i>Proxy Function</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#example"><i class="fa fa-check"></i>Example</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#update"><i class="fa fa-check"></i>Update</a></li>
</ul></li>
<li class="part"><span><b>V Examples</b></span></li>
<li class="chapter" data-level="14" data-path="ploty.html"><a href="ploty.html"><i class="fa fa-check"></i><b>14</b> Ploty</a>
<ul>
<li class="chapter" data-level="" data-path="ploty.html"><a href="ploty.html#discover"><i class="fa fa-check"></i>Discover</a></li>
<li class="chapter" data-level="" data-path="ploty.html"><a href="ploty.html#basics-2"><i class="fa fa-check"></i>Basics</a></li>
<li class="chapter" data-level="" data-path="ploty.html"><a href="ploty.html#javascript-to-r-1"><i class="fa fa-check"></i>JavaScript to R</a></li>
<li class="chapter" data-level="" data-path="ploty.html"><a href="ploty.html#r-to-javascript-1"><i class="fa fa-check"></i>R to JavaScript</a></li>
<li class="chapter" data-level="" data-path="ploty.html"><a href="ploty.html#performance-security"><i class="fa fa-check"></i>Performance &amp; Security</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="image-classifier.html"><a href="image-classifier.html"><i class="fa fa-check"></i><b>15</b> Image Classifier</a></li>
<li class="chapter" data-level="16" data-path="progress-bar.html"><a href="progress-bar.html"><i class="fa fa-check"></i><b>16</b> Progress Bar</a>
<ul>
<li class="chapter" data-level="" data-path="progress-bar.html"><a href="progress-bar.html#r-code-1"><i class="fa fa-check"></i>R code</a></li>
<li class="chapter" data-level="" data-path="progress-bar.html"><a href="progress-bar.html#javascript-code-2"><i class="fa fa-check"></i>JavaScript code</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="events-1.html"><a href="events-1.html"><i class="fa fa-check"></i>Events</a></li>
<li class="chapter" data-level="17" data-path="math-evaluator.html"><a href="math-evaluator.html"><i class="fa fa-check"></i><b>17</b> Math Evaluator</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">JavaScript for R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="a-complete-integration" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> A Complete Integration</h1>
<p>Thus far, this collection of chapters has covered both ways data travels between JavaScript and R in Shiny. However, the alerts displayed in the previous chapter are rather hideous and, though demonstrates how both languages can work together within shiny, comes short of illustrating how to make use of external libraries or how to package such code.</p>
<p>Let’s exploit an external library to improve upon the work done so far: <a href="https://github.com/StephanWagner/jBox">jBox</a> allows displaying modals (pop-ups), very similar to the vanilla JavaScript alerts, but much better looking and with additional functionalities.</p>
<p>The very first thing to do is to import jBox in our project, we could download the files and use them as described in the previous static files section but it comes with very convenient CDNs detailed in the <a href="https://stephanwagner.me/jBox/get_started">get-started page of the documentation</a>.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb139-1"><a href="a-complete-integration.html#cb139-1"></a><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://code.jquery.com/jquery-3.5.1.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb139-2"><a href="a-complete-integration.html#cb139-2"></a><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb139-3"><a href="a-complete-integration.html#cb139-3"></a><span class="kw">&lt;link</span><span class="ot"> href=</span><span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.css&quot;</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="kw">&gt;</span></span></code></pre></div>
<p>Note that the “j” in jBox stands for jQuery which is already a dependency of shiny itself, there is therefore no need to import it, on the contrary one should not in order to avoid clashes. We can adapt the ui of the shiny application built up to this point to import the dependencies, keeping the handler, to obtain the code below.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="a-complete-integration.html#cb140-1"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb140-2"><a href="a-complete-integration.html#cb140-2"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb140-3"><a href="a-complete-integration.html#cb140-3"></a>    tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb140-4"><a href="a-complete-integration.html#cb140-4"></a>      <span class="dt">src =</span> <span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.js&quot;</span></span>
<span id="cb140-5"><a href="a-complete-integration.html#cb140-5"></a>    ),</span>
<span id="cb140-6"><a href="a-complete-integration.html#cb140-6"></a>    tags<span class="op">$</span><span class="kw">link</span>(</span>
<span id="cb140-7"><a href="a-complete-integration.html#cb140-7"></a>      <span class="dt">rel =</span> <span class="st">&quot;stylesheet&quot;</span>,</span>
<span id="cb140-8"><a href="a-complete-integration.html#cb140-8"></a>      <span class="dt">href =</span> <span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.css&quot;</span></span>
<span id="cb140-9"><a href="a-complete-integration.html#cb140-9"></a>    ),</span>
<span id="cb140-10"><a href="a-complete-integration.html#cb140-10"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb140-11"><a href="a-complete-integration.html#cb140-11"></a><span class="st">      // TO DO: code jBox</span></span>
<span id="cb140-12"><a href="a-complete-integration.html#cb140-12"></a><span class="st">    });&quot;</span>)</span>
<span id="cb140-13"><a href="a-complete-integration.html#cb140-13"></a>  )</span>
<span id="cb140-14"><a href="a-complete-integration.html#cb140-14"></a>)</span></code></pre></div>
<p>The jBox library comes with numerous features to display tooltips, modals, notices, and more, which would make for too long a chapter; only notices shall be covered here. Further down the <a href="https://stephanwagner.me/jBox/get_started#notices">get-started document</a> lies an example of a jBox notice.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb141-1"><a href="a-complete-integration.html#cb141-1"></a><span class="kw">new</span> <span class="at">jBox</span>(<span class="st">&#39;Notice&#39;</span><span class="op">,</span> <span class="op">{</span></span>
<span id="cb141-2"><a href="a-complete-integration.html#cb141-2"></a>  <span class="dt">content</span><span class="op">:</span> <span class="st">&#39;Hurray! A notice!&#39;</span><span class="op">,</span></span>
<span id="cb141-3"><a href="a-complete-integration.html#cb141-3"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;blue&#39;</span></span>
<span id="cb141-4"><a href="a-complete-integration.html#cb141-4"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Let us copy that in the placeholder of the shiny ui already put together.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="a-complete-integration.html#cb142-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb142-2"><a href="a-complete-integration.html#cb142-2"></a></span>
<span id="cb142-3"><a href="a-complete-integration.html#cb142-3"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb142-4"><a href="a-complete-integration.html#cb142-4"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb142-5"><a href="a-complete-integration.html#cb142-5"></a>    tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb142-6"><a href="a-complete-integration.html#cb142-6"></a>      <span class="dt">src =</span> <span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.js&quot;</span></span>
<span id="cb142-7"><a href="a-complete-integration.html#cb142-7"></a>    ),</span>
<span id="cb142-8"><a href="a-complete-integration.html#cb142-8"></a>    tags<span class="op">$</span><span class="kw">link</span>(</span>
<span id="cb142-9"><a href="a-complete-integration.html#cb142-9"></a>      <span class="dt">rel =</span> <span class="st">&quot;stylesheet&quot;</span>,</span>
<span id="cb142-10"><a href="a-complete-integration.html#cb142-10"></a>      <span class="dt">href =</span> <span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.css&quot;</span></span>
<span id="cb142-11"><a href="a-complete-integration.html#cb142-11"></a>    ),</span>
<span id="cb142-12"><a href="a-complete-integration.html#cb142-12"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb142-13"><a href="a-complete-integration.html#cb142-13"></a><span class="st">      new jBox(&#39;Notice&#39;, {</span></span>
<span id="cb142-14"><a href="a-complete-integration.html#cb142-14"></a><span class="st">        content: &#39;Hurray! A notice!&#39;,</span></span>
<span id="cb142-15"><a href="a-complete-integration.html#cb142-15"></a><span class="st">        color: &#39;blue&#39;</span></span>
<span id="cb142-16"><a href="a-complete-integration.html#cb142-16"></a><span class="st">      });</span></span>
<span id="cb142-17"><a href="a-complete-integration.html#cb142-17"></a><span class="st">    });&quot;</span>)</span>
<span id="cb142-18"><a href="a-complete-integration.html#cb142-18"></a>  )</span>
<span id="cb142-19"><a href="a-complete-integration.html#cb142-19"></a>)</span>
<span id="cb142-20"><a href="a-complete-integration.html#cb142-20"></a></span>
<span id="cb142-21"><a href="a-complete-integration.html#cb142-21"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb142-22"><a href="a-complete-integration.html#cb142-22"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="dt">type =</span> <span class="st">&quot;send-alert&quot;</span>, <span class="dt">message =</span> <span class="st">&quot;Deleting a record!&quot;</span>)</span>
<span id="cb142-23"><a href="a-complete-integration.html#cb142-23"></a>}</span>
<span id="cb142-24"><a href="a-complete-integration.html#cb142-24"></a></span>
<span id="cb142-25"><a href="a-complete-integration.html#cb142-25"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="figure">
<img src="images/notice-1.png" alt="" />
<p class="caption">First jBox Notice</p>
</div>
<p>With some minor changes the application can display the message passed, one only needs to replace ‘Hurray! A notice!’ with the <code>message</code> variable.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="a-complete-integration.html#cb143-1"></a>tags<span class="op">$</span><span class="kw">script</span>(<span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb143-2"><a href="a-complete-integration.html#cb143-2"></a><span class="st">  new jBox(&#39;Notice&#39;, {</span></span>
<span id="cb143-3"><a href="a-complete-integration.html#cb143-3"></a><span class="st">    content: message,</span></span>
<span id="cb143-4"><a href="a-complete-integration.html#cb143-4"></a><span class="st">    color: &#39;blue&#39;</span></span>
<span id="cb143-5"><a href="a-complete-integration.html#cb143-5"></a><span class="st">  });</span></span>
<span id="cb143-6"><a href="a-complete-integration.html#cb143-6"></a><span class="st">});&quot;</span>)</span></code></pre></div>
<p>This though only allows passing a single variable, the message, to JavaScript but jBox has many more options.</p>
<div id="serialisation" class="section level2 unnumbered" number="">
<h2>Serialisation</h2>
<p>Let’s delve deeper into the communication between the server and the front-end to understand how we can further customise the notice displayed, e.g.: change the colour.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb144-1"><a href="a-complete-integration.html#cb144-1"></a><span class="op">{</span></span>
<span id="cb144-2"><a href="a-complete-integration.html#cb144-2"></a>  <span class="dt">content</span><span class="op">:</span> <span class="st">&#39;Hurray! A notice!&#39;</span><span class="op">,</span></span>
<span id="cb144-3"><a href="a-complete-integration.html#cb144-3"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;blue&#39;</span></span>
<span id="cb144-4"><a href="a-complete-integration.html#cb144-4"></a><span class="op">}</span></span></code></pre></div>
<p>Notice that the jBox notice takes a JSON object containing the options that define said notice to display, including but not limited to the message. The most straightforward way to make all those options accessible to the server is to construct that list of options server-side before sending it to the the front-end. For instance the JSON of options displayed above would look like the R list below.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="a-complete-integration.html#cb145-1"></a><span class="kw">list</span>(</span>
<span id="cb145-2"><a href="a-complete-integration.html#cb145-2"></a>  <span class="dt">content =</span> <span class="st">&#39;Hurray! A notice!&#39;</span>,</span>
<span id="cb145-3"><a href="a-complete-integration.html#cb145-3"></a>  <span class="dt">color =</span> <span class="st">&#39;blue&#39;</span></span>
<span id="cb145-4"><a href="a-complete-integration.html#cb145-4"></a>)</span></code></pre></div>
<pre><code>## $content
## [1] &quot;Hurray! A notice!&quot;
## 
## $color
## [1] &quot;blue&quot;</code></pre>
<p>Therefore one could construct this list server-side and use it in jBox straight away, without any further processing from the client. Doing so means we can simplify the JavaScript to <code>new jBox('Notice', message);</code> rather than use <code>message</code> within the JSON.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="a-complete-integration.html#cb147-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb147-2"><a href="a-complete-integration.html#cb147-2"></a></span>
<span id="cb147-3"><a href="a-complete-integration.html#cb147-3"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb147-4"><a href="a-complete-integration.html#cb147-4"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb147-5"><a href="a-complete-integration.html#cb147-5"></a>    tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb147-6"><a href="a-complete-integration.html#cb147-6"></a>      <span class="dt">src =</span> <span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.js&quot;</span></span>
<span id="cb147-7"><a href="a-complete-integration.html#cb147-7"></a>    ),</span>
<span id="cb147-8"><a href="a-complete-integration.html#cb147-8"></a>    tags<span class="op">$</span><span class="kw">link</span>(</span>
<span id="cb147-9"><a href="a-complete-integration.html#cb147-9"></a>      <span class="dt">rel =</span> <span class="st">&quot;stylesheet&quot;</span>,</span>
<span id="cb147-10"><a href="a-complete-integration.html#cb147-10"></a>      <span class="dt">href =</span> <span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.css&quot;</span></span>
<span id="cb147-11"><a href="a-complete-integration.html#cb147-11"></a>    ),</span>
<span id="cb147-12"><a href="a-complete-integration.html#cb147-12"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb147-13"><a href="a-complete-integration.html#cb147-13"></a><span class="st">      // use notice send from the server</span></span>
<span id="cb147-14"><a href="a-complete-integration.html#cb147-14"></a><span class="st">      new jBox(&#39;Notice&#39;, message);</span></span>
<span id="cb147-15"><a href="a-complete-integration.html#cb147-15"></a><span class="st">    });&quot;</span>)</span>
<span id="cb147-16"><a href="a-complete-integration.html#cb147-16"></a>  )</span>
<span id="cb147-17"><a href="a-complete-integration.html#cb147-17"></a>)</span>
<span id="cb147-18"><a href="a-complete-integration.html#cb147-18"></a></span>
<span id="cb147-19"><a href="a-complete-integration.html#cb147-19"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb147-20"><a href="a-complete-integration.html#cb147-20"></a></span>
<span id="cb147-21"><a href="a-complete-integration.html#cb147-21"></a>  <span class="co"># define notice options</span></span>
<span id="cb147-22"><a href="a-complete-integration.html#cb147-22"></a>  notice =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb147-23"><a href="a-complete-integration.html#cb147-23"></a>    <span class="dt">content =</span> <span class="st">&#39;Hello from the server&#39;</span>,</span>
<span id="cb147-24"><a href="a-complete-integration.html#cb147-24"></a>    <span class="dt">color =</span> <span class="st">&#39;black&#39;</span></span>
<span id="cb147-25"><a href="a-complete-integration.html#cb147-25"></a>  )</span>
<span id="cb147-26"><a href="a-complete-integration.html#cb147-26"></a></span>
<span id="cb147-27"><a href="a-complete-integration.html#cb147-27"></a>  <span class="co"># send the notice</span></span>
<span id="cb147-28"><a href="a-complete-integration.html#cb147-28"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="dt">type =</span> <span class="st">&quot;send-alert&quot;</span>, <span class="dt">message =</span> notice)</span>
<span id="cb147-29"><a href="a-complete-integration.html#cb147-29"></a>}</span>
<span id="cb147-30"><a href="a-complete-integration.html#cb147-30"></a></span>
<span id="cb147-31"><a href="a-complete-integration.html#cb147-31"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="figure">
<img src="images/notice-2.png" alt="" />
<p class="caption">Customised jBox Notice</p>
</div>
<p>This sets a solid basis to further integrate other functionalities of jBox.</p>
</div>
<div id="events-callbacks" class="section level2 unnumbered" number="">
<h2>Events &amp; Callbacks</h2>
<p>In the example of the vanilla JavaScript alert one could simply place a line of code after the <code>alert()</code> function in order to “tell” the server whether the button on the alert had been clicked. This was feasible because <code>alert</code> stops the execution of code, this is, however, rather uncommon in JavaScript. What is far more used are events and callback functions which are triggered upon an action is performed by the user (like the click of a button) or when other interesting things happen in the code. <a href="https://stephanwagner.me/jBox/options#events">jBox provides numerous such events</a>: callback functions can be used when a modal is closed or when it is created for instance.</p>
<p>The concept of the callback function is not totally foreign to R albeit rarely used. Shiny comes with such functions, e.g.: <code>shiny::onStop</code>. This allows having a function be triggered when the application exits (useful to close database connections for instance).</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="a-complete-integration.html#cb148-1"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</span>
<span id="cb148-2"><a href="a-complete-integration.html#cb148-2"></a>  shiny<span class="op">::</span><span class="kw">onStop</span>(</span>
<span id="cb148-3"><a href="a-complete-integration.html#cb148-3"></a>    <span class="co"># callback function fired when app is closed</span></span>
<span id="cb148-4"><a href="a-complete-integration.html#cb148-4"></a>    <span class="cf">function</span>(){</span>
<span id="cb148-5"><a href="a-complete-integration.html#cb148-5"></a>      <span class="kw">cat</span>(<span class="st">&quot;App has been closed&quot;</span>)</span>
<span id="cb148-6"><a href="a-complete-integration.html#cb148-6"></a>    } <span class="cf">for</span> instance</span>
<span id="cb148-7"><a href="a-complete-integration.html#cb148-7"></a>  )</span>
<span id="cb148-8"><a href="a-complete-integration.html#cb148-8"></a>}</span></code></pre></div>
<p>In jBox, these callback functions are included in the JSON of options, below the <code>onClose</code> event is fired when the notice is closed.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb149-1"><a href="a-complete-integration.html#cb149-1"></a><span class="op">{</span></span>
<span id="cb149-2"><a href="a-complete-integration.html#cb149-2"></a>  <span class="dt">content</span><span class="op">:</span> <span class="st">&#39;Alert!&#39;</span><span class="op">,</span></span>
<span id="cb149-3"><a href="a-complete-integration.html#cb149-3"></a>  <span class="dt">onClose</span><span class="op">:</span> <span class="kw">function</span>()<span class="op">{</span></span>
<span id="cb149-4"><a href="a-complete-integration.html#cb149-4"></a>    <span class="co">// Fired when closed </span></span>
<span id="cb149-5"><a href="a-complete-integration.html#cb149-5"></a>    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Alert is closed&#39;</span>)<span class="op">;</span></span>
<span id="cb149-6"><a href="a-complete-integration.html#cb149-6"></a>  <span class="op">}</span></span>
<span id="cb149-7"><a href="a-complete-integration.html#cb149-7"></a><span class="op">}</span></span></code></pre></div>
<p>This raises one issue, one cannot truly serialise an object of type function (there are exceptions later in the book).</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="a-complete-integration.html#cb150-1"></a><span class="co"># try to serialise an R function</span></span>
<span id="cb150-2"><a href="a-complete-integration.html#cb150-2"></a>jsonlite<span class="op">::</span><span class="kw">toJSON</span>(<span class="cf">function</span>(x){x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>})</span></code></pre></div>
<pre><code>## [&quot;function (x) &quot;,&quot;{&quot;,&quot;    x + 1&quot;,&quot;}&quot;]</code></pre>
<p>One solution is to append the callback function to the object of options JavaScript-side.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="a-complete-integration.html#cb152-1"></a>tags<span class="op">$</span><span class="kw">script</span>(<span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb152-2"><a href="a-complete-integration.html#cb152-2"></a><span class="st">  // append callback</span></span>
<span id="cb152-3"><a href="a-complete-integration.html#cb152-3"></a><span class="st">  message.onClose = function(){</span></span>
<span id="cb152-4"><a href="a-complete-integration.html#cb152-4"></a><span class="st">    Shiny.setInputValue(&#39;alert_close&#39;, true);</span></span>
<span id="cb152-5"><a href="a-complete-integration.html#cb152-5"></a><span class="st">  }</span></span>
<span id="cb152-6"><a href="a-complete-integration.html#cb152-6"></a><span class="st">  new jBox(&#39;Notice&#39;, message);</span></span>
<span id="cb152-7"><a href="a-complete-integration.html#cb152-7"></a><span class="st">});&quot;</span>)</span></code></pre></div>
<p>Placing a function inside a JSON object is common in JavaScript, in contrast with R where though it works is rarely if ever done (outside of reference class/R6). The above JavaScript code to append the callback function could look something like the snippet below in R.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="a-complete-integration.html#cb153-1"></a>message &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">content =</span> <span class="st">&quot;hello&quot;</span>)</span>
<span id="cb153-2"><a href="a-complete-integration.html#cb153-2"></a>message<span class="op">$</span>onClose &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb153-3"><a href="a-complete-integration.html#cb153-3"></a>  x <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb153-4"><a href="a-complete-integration.html#cb153-4"></a>}</span>
<span id="cb153-5"><a href="a-complete-integration.html#cb153-5"></a></span>
<span id="cb153-6"><a href="a-complete-integration.html#cb153-6"></a>message<span class="op">$</span><span class="kw">onClose</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>That done it can be incorporated into the application built thus far. Something interesting could be done server-side but for the sake of this example we merely print the value of the input to the R console.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="a-complete-integration.html#cb155-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb155-2"><a href="a-complete-integration.html#cb155-2"></a></span>
<span id="cb155-3"><a href="a-complete-integration.html#cb155-3"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb155-4"><a href="a-complete-integration.html#cb155-4"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb155-5"><a href="a-complete-integration.html#cb155-5"></a>    tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb155-6"><a href="a-complete-integration.html#cb155-6"></a>      <span class="dt">src =</span> <span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.js&quot;</span></span>
<span id="cb155-7"><a href="a-complete-integration.html#cb155-7"></a>    ),</span>
<span id="cb155-8"><a href="a-complete-integration.html#cb155-8"></a>    tags<span class="op">$</span><span class="kw">link</span>(</span>
<span id="cb155-9"><a href="a-complete-integration.html#cb155-9"></a>      <span class="dt">rel =</span> <span class="st">&quot;stylesheet&quot;</span>,</span>
<span id="cb155-10"><a href="a-complete-integration.html#cb155-10"></a>      <span class="dt">href =</span> <span class="st">&quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.css&quot;</span></span>
<span id="cb155-11"><a href="a-complete-integration.html#cb155-11"></a>    ),</span>
<span id="cb155-12"><a href="a-complete-integration.html#cb155-12"></a>    tags<span class="op">$</span><span class="kw">script</span>(<span class="st">&quot;Shiny.addCustomMessageHandler(type = &#39;send-alert&#39;, function(message) {</span></span>
<span id="cb155-13"><a href="a-complete-integration.html#cb155-13"></a><span class="st">      message.onClose = function(){</span></span>
<span id="cb155-14"><a href="a-complete-integration.html#cb155-14"></a><span class="st">        Shiny.setInputValue(&#39;alert_close&#39;, true);</span></span>
<span id="cb155-15"><a href="a-complete-integration.html#cb155-15"></a><span class="st">      }</span></span>
<span id="cb155-16"><a href="a-complete-integration.html#cb155-16"></a><span class="st">      new jBox(&#39;Notice&#39;, message);</span></span>
<span id="cb155-17"><a href="a-complete-integration.html#cb155-17"></a><span class="st">    });&quot;</span>)</span>
<span id="cb155-18"><a href="a-complete-integration.html#cb155-18"></a>  )</span>
<span id="cb155-19"><a href="a-complete-integration.html#cb155-19"></a>)</span>
<span id="cb155-20"><a href="a-complete-integration.html#cb155-20"></a></span>
<span id="cb155-21"><a href="a-complete-integration.html#cb155-21"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session){</span>
<span id="cb155-22"><a href="a-complete-integration.html#cb155-22"></a></span>
<span id="cb155-23"><a href="a-complete-integration.html#cb155-23"></a>  <span class="co"># define notice options</span></span>
<span id="cb155-24"><a href="a-complete-integration.html#cb155-24"></a>  notice =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb155-25"><a href="a-complete-integration.html#cb155-25"></a>    <span class="dt">content =</span> <span class="st">&#39;Hello from the server&#39;</span>,</span>
<span id="cb155-26"><a href="a-complete-integration.html#cb155-26"></a>    <span class="dt">color =</span> <span class="st">&#39;black&#39;</span></span>
<span id="cb155-27"><a href="a-complete-integration.html#cb155-27"></a>  )</span>
<span id="cb155-28"><a href="a-complete-integration.html#cb155-28"></a></span>
<span id="cb155-29"><a href="a-complete-integration.html#cb155-29"></a>  <span class="co"># send the notice</span></span>
<span id="cb155-30"><a href="a-complete-integration.html#cb155-30"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="dt">type =</span> <span class="st">&quot;send-alert&quot;</span>, <span class="dt">message =</span> notice)</span>
<span id="cb155-31"><a href="a-complete-integration.html#cb155-31"></a></span>
<span id="cb155-32"><a href="a-complete-integration.html#cb155-32"></a>  <span class="co"># print the output of the alert_close event (when fired)</span></span>
<span id="cb155-33"><a href="a-complete-integration.html#cb155-33"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>alert_close, {</span>
<span id="cb155-34"><a href="a-complete-integration.html#cb155-34"></a>    <span class="kw">print</span>(input<span class="op">$</span>alert_close)</span>
<span id="cb155-35"><a href="a-complete-integration.html#cb155-35"></a>  })</span>
<span id="cb155-36"><a href="a-complete-integration.html#cb155-36"></a>}</span>
<span id="cb155-37"><a href="a-complete-integration.html#cb155-37"></a></span>
<span id="cb155-38"><a href="a-complete-integration.html#cb155-38"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
</div>
<div id="as-a-package" class="section level2 unnumbered" number="">
<h2>As a Package</h2>
<p><em>If confused by any of the following please visit the <a href="package-development">package development section</a> in the first chapter.</em></p>
<p>Packages are a fundamental part of R and allow conveniently sharing and reusing code. The work done so far is probably fitting for a single application but one should not have to reproduce all of that every time one wants to use jBox in a shiny application: we ought to wrap these functionalities into a handy package that can be used, reused and shared with others. Moreover, this will benefit from all the other advantages that R packages bring to code such as documentation, reproducibility, and tests.</p>
<p>Before we delve into building the package let us think through what it should include. The application using jBox gives some indication as to what the package will look like. Users of the package should be able to reproduce what is executed in the application, namely import dependencies (including the message handler) as well as send data to the JavaScript front-end. Finally, we shall provide, with the package, a static directory of dependencies to avoid relying on the CDNs as this ensures reproducibility (code hosted online by third-party might change and break the package). Concretely, the package will export a <code>useJbox</code> function to be placed in the shiny ui to import the dependencies (essentially replacing the <code>tags$*</code>) and a function to send the alert from the server to the client.</p>
<p>Let’s start by creating an R package, here we name it “jbox,” after the JavaScript of the same name, partly because the author lacks creativity: feel free to name it however you want.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="a-complete-integration.html#cb156-1"></a>usethis<span class="op">::</span><span class="kw">create_package</span>(<span class="st">&quot;jbox&quot;</span>)</span></code></pre></div>
<div id="dependencies" class="section level3 unnumbered" number="">
<h3>Dependencies</h3>
<p><em>If confused by any of the following please visit the <a href="introduction-1.html#static-files">static files section</a> of this chapter.</em></p>
<p>The very first thing that is required are the dependencies without which nothing can work, let’s create a directory of static assets, download and place the jBox CSS and JavaScript files within it. We create the directory “inst” as per the R package convention and within it create another to hold our assets.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="a-complete-integration.html#cb157-1"></a><span class="co"># create directories</span></span>
<span id="cb157-2"><a href="a-complete-integration.html#cb157-2"></a><span class="kw">dir.create</span>(<span class="st">&quot;inst/assets&quot;</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>The jBox files can be downloaded from the CDN and placed within the directory that was created above. Moreover, we also create an empty JavaScript file that will eventually contain the custom JavaScript code that “connects” R to JavaScript.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="a-complete-integration.html#cb158-1"></a><span class="co"># URLs of CDNs</span></span>
<span id="cb158-2"><a href="a-complete-integration.html#cb158-2"></a>js_dep &lt;-<span class="st"> &quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.js&quot;</span></span>
<span id="cb158-3"><a href="a-complete-integration.html#cb158-3"></a>css_dep &lt;-<span class="st"> &quot;https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.2.0/dist/jBox.all.min.css&quot;</span></span>
<span id="cb158-4"><a href="a-complete-integration.html#cb158-4"></a></span>
<span id="cb158-5"><a href="a-complete-integration.html#cb158-5"></a><span class="co"># download</span></span>
<span id="cb158-6"><a href="a-complete-integration.html#cb158-6"></a><span class="kw">download.file</span>(js_dep, <span class="dt">destfile =</span> <span class="st">&quot;./inst/assets/jBox.all.min.js&quot;</span>)</span>
<span id="cb158-7"><a href="a-complete-integration.html#cb158-7"></a><span class="kw">download.file</span>(css_dep, <span class="dt">destfile =</span> <span class="st">&quot;./inst/assets/jBox.all.min.css&quot;</span>)</span>
<span id="cb158-8"><a href="a-complete-integration.html#cb158-8"></a></span>
<span id="cb158-9"><a href="a-complete-integration.html#cb158-9"></a><span class="co"># create file to eventually hold custom JavaScript</span></span>
<span id="cb158-10"><a href="a-complete-integration.html#cb158-10"></a><span class="kw">file.create</span>(<span class="st">&quot;./inst/assets/custom.js&quot;</span>)</span></code></pre></div>
<p>This done one should obtain a directory that looks similar to the tree below (some files and folders omitted for brevity).</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb159-1"><a href="a-complete-integration.html#cb159-1"></a><span class="ex">DESCRIPTION</span></span>
<span id="cb159-2"><a href="a-complete-integration.html#cb159-2"></a><span class="ex">R/</span></span>
<span id="cb159-3"><a href="a-complete-integration.html#cb159-3"></a><span class="ex">inst/</span></span>
<span id="cb159-4"><a href="a-complete-integration.html#cb159-4"></a>├── <span class="ex">assets/</span></span>
<span id="cb159-5"><a href="a-complete-integration.html#cb159-5"></a>│    ├── <span class="ex">jBox.all.min.js</span></span>
<span id="cb159-6"><a href="a-complete-integration.html#cb159-6"></a>│    └── <span class="ex">jBox.all.min.css</span></span></code></pre></div>
<p>Next, one needs to have those files served, the user of the package could be asked to use <code>shiny::addResourcePath</code> but it’s very inelegant, this should be built-in the package so the user does not even have to know this happening in the background. Therefore, we ought to ensure the static files are served when the user uses the package. Packages can optionally run functions when it is loaded or attached, Hadley Wickham writes about it extensively in the namespace chapter of his <a href="http://r-pkgs.had.co.nz/namespace.html">book on R packages</a>. By convention, these functions are placed in a <code>zzz.R</code> file.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="a-complete-integration.html#cb160-1"></a><span class="kw">file.create</span>(<span class="st">&quot;./R/zzz.R&quot;</span>)</span></code></pre></div>
<p>The difference between loading and attaching a package can be subtle, in this case it’s probably best to run the function when the package is loaded using <code>onLoad</code> which the R Packages book describes as:</p>
<blockquote>
<p>Loading will load code, data and any DLLs; register S3 and S4 methods; and run the .onLoad() function. After loading, the package is available in memory, but because it’s not in the search path, you won’t be able to access its components without using ::. Confusingly, :: will also load a package automatically if it isn’t already loaded. It’s rare to load a package explicitly, but you can do so with requireNamespace() or loadNamespace().</p>
</blockquote>
<p>The <code>addResourcePath</code> function should thus be placed within the <code>.onLoad</code> function, this way the files are served by shiny when the package is loaded. Note the few changes below, we refer to the path using <code>system.file</code> (detailed in the <a href="introduction.html#package-development">Package Development section</a>) and change the the prefix to <code>jbox-assets</code> to avoid the url serving our static files to clash with others.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="a-complete-integration.html#cb161-1"></a><span class="co"># R/zzz.R</span></span>
<span id="cb161-2"><a href="a-complete-integration.html#cb161-2"></a>.onLoad &lt;-<span class="st"> </span><span class="cf">function</span>(libname, pkgname) {</span>
<span id="cb161-3"><a href="a-complete-integration.html#cb161-3"></a>  shiny<span class="op">::</span><span class="kw">addResourcePath</span>(</span>
<span id="cb161-4"><a href="a-complete-integration.html#cb161-4"></a>    <span class="st">&quot;jbox-assets&quot;</span>,</span>
<span id="cb161-5"><a href="a-complete-integration.html#cb161-5"></a>    <span class="kw">system.file</span>(<span class="st">&quot;assets&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;jbox&quot;</span>)</span>
<span id="cb161-6"><a href="a-complete-integration.html#cb161-6"></a>  )</span>
<span id="cb161-7"><a href="a-complete-integration.html#cb161-7"></a>}</span></code></pre></div>
<p>This serves the file and allows not having to explicitly use <code>addResourcePath</code> but the package nonetheless needs to feature a function to let the user import them into their application.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="a-complete-integration.html#cb162-1"></a><span class="co">#&#39; Import Dependencies</span></span>
<span id="cb162-2"><a href="a-complete-integration.html#cb162-2"></a><span class="co">#&#39; @export</span></span>
<span id="cb162-3"><a href="a-complete-integration.html#cb162-3"></a>usejBox &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb162-4"><a href="a-complete-integration.html#cb162-4"></a>  shiny<span class="op">::</span>tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb162-5"><a href="a-complete-integration.html#cb162-5"></a>    shiny<span class="op">::</span>tags<span class="op">$</span><span class="kw">script</span>(<span class="dt">src =</span> <span class="st">&quot;jbox-assets/jBox.all.min.js&quot;</span>),</span>
<span id="cb162-6"><a href="a-complete-integration.html#cb162-6"></a>    shiny<span class="op">::</span>tags<span class="op">$</span><span class="kw">link</span>(<span class="dt">rel =</span> <span class="st">&quot;stylesheet&quot;</span>, <span class="dt">href =</span> <span class="st">&quot;jbox-assets/jBox.all.min.css&quot;</span>),</span>
<span id="cb162-7"><a href="a-complete-integration.html#cb162-7"></a>    shiny<span class="op">::</span>tags<span class="op">$</span><span class="kw">script</span>(<span class="dt">src =</span> <span class="st">&quot;jbox-assets/custom.js&quot;</span>)</span>
<span id="cb162-8"><a href="a-complete-integration.html#cb162-8"></a>  )</span>
<span id="cb162-9"><a href="a-complete-integration.html#cb162-9"></a>}</span></code></pre></div>
<p>Users of the package can place the function defined above in the UI of their application to import the dependencies.</p>
</div>
<div id="r-code" class="section level3 unnumbered" number="">
<h3>R Code</h3>
<p>Not much changes from what was written before, however, it poses interesting questions with regard to the interface we want to provide users. From the user’s perspective the core of the package is the function that actually sends an alert to the clients, here created in <code>R/core.R</code>.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="a-complete-integration.html#cb163-1"></a><span class="co">#&#39; Create an Alert</span></span>
<span id="cb163-2"><a href="a-complete-integration.html#cb163-2"></a><span class="co">#&#39; @export</span></span>
<span id="cb163-3"><a href="a-complete-integration.html#cb163-3"></a>send_alert &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">content =</span> <span class="st">&quot;alert&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, session){</span>
<span id="cb163-4"><a href="a-complete-integration.html#cb163-4"></a>  <span class="co"># define notice options</span></span>
<span id="cb163-5"><a href="a-complete-integration.html#cb163-5"></a>  notice =<span class="st"> </span><span class="kw">list</span>(<span class="dt">content =</span> content, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb163-6"><a href="a-complete-integration.html#cb163-6"></a></span>
<span id="cb163-7"><a href="a-complete-integration.html#cb163-7"></a>  <span class="co"># send the notice</span></span>
<span id="cb163-8"><a href="a-complete-integration.html#cb163-8"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="dt">type =</span> <span class="st">&quot;send-alert&quot;</span>, <span class="dt">message =</span> notice)</span>
<span id="cb163-9"><a href="a-complete-integration.html#cb163-9"></a>}</span></code></pre></div>
<p>One could leave it at the function above, it could be sufficient in providing a functional R package. However one could improve somewhat on it, currently, the function requires the <code>session</code> object, which confuses many, most R developers, including I, have little understanding of it. This can be mitigated by providing a default using <code>shiny::getDefaultReactiveDomain</code> which, notwithstanding its grandiose name, simply returns the shiny <code>session</code>. This means that function has be run from a shiny server function but that is no limitation in this case.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="a-complete-integration.html#cb164-1"></a><span class="co">#&#39; Create an Alert</span></span>
<span id="cb164-2"><a href="a-complete-integration.html#cb164-2"></a><span class="co">#&#39; @export</span></span>
<span id="cb164-3"><a href="a-complete-integration.html#cb164-3"></a>send_alert &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">content =</span> <span class="st">&quot;alert&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">session =</span> shiny<span class="op">::</span><span class="kw">getDefaultReactiveDomain</span>()){</span>
<span id="cb164-4"><a href="a-complete-integration.html#cb164-4"></a>  <span class="co"># define notice options</span></span>
<span id="cb164-5"><a href="a-complete-integration.html#cb164-5"></a>  notice =<span class="st"> </span><span class="kw">list</span>(<span class="dt">content =</span> content, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb164-6"><a href="a-complete-integration.html#cb164-6"></a></span>
<span id="cb164-7"><a href="a-complete-integration.html#cb164-7"></a>  <span class="co"># send the notice</span></span>
<span id="cb164-8"><a href="a-complete-integration.html#cb164-8"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="dt">type =</span> <span class="st">&quot;send-alert&quot;</span>, <span class="dt">message =</span> notice)</span>
<span id="cb164-9"><a href="a-complete-integration.html#cb164-9"></a>}</span></code></pre></div>
<p>This covers most of the R code that needs to be written, though we will come back to it shortly on as we uncover an interesting caveat.</p>
</div>
<div id="javascript-code" class="section level3 unnumbered" number="">
<h3>JavaScript Code</h3>
<p>Onto the JavaScript code, the <code>custom.js</code> to host said code is already created but remains empty. Simply using the code that was written previously will do the job for now.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb165-1"><a href="a-complete-integration.html#cb165-1"></a><span class="co">// custom.js</span></span>
<span id="cb165-2"><a href="a-complete-integration.html#cb165-2"></a><span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(type <span class="op">=</span> <span class="st">&#39;send-alert&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb165-3"><a href="a-complete-integration.html#cb165-3"></a>  <span class="va">message</span>.<span class="at">onClose</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{</span></span>
<span id="cb165-4"><a href="a-complete-integration.html#cb165-4"></a>    <span class="va">Shiny</span>.<span class="at">setInputValue</span>(<span class="st">&#39;alert_close&#39;</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb165-5"><a href="a-complete-integration.html#cb165-5"></a>  <span class="op">}</span></span>
<span id="cb165-6"><a href="a-complete-integration.html#cb165-6"></a>  <span class="kw">new</span> <span class="at">jBox</span>(<span class="st">&#39;Notice&#39;</span><span class="op">,</span> message)<span class="op">;</span></span>
<span id="cb165-7"><a href="a-complete-integration.html#cb165-7"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>At this stage one has a fully functional package: document, load the functions, and it can be used.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="a-complete-integration.html#cb166-1"></a>devtools<span class="op">::</span><span class="kw">document</span>()</span>
<span id="cb166-2"><a href="a-complete-integration.html#cb166-2"></a>devtools<span class="op">::</span><span class="kw">load_all</span>()</span>
<span id="cb166-3"><a href="a-complete-integration.html#cb166-3"></a></span>
<span id="cb166-4"><a href="a-complete-integration.html#cb166-4"></a><span class="kw">library</span>(shiny)</span>
<span id="cb166-5"><a href="a-complete-integration.html#cb166-5"></a></span>
<span id="cb166-6"><a href="a-complete-integration.html#cb166-6"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb166-7"><a href="a-complete-integration.html#cb166-7"></a>  <span class="kw">usejBox</span>(),</span>
<span id="cb166-8"><a href="a-complete-integration.html#cb166-8"></a>  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;callback&quot;</span>)</span>
<span id="cb166-9"><a href="a-complete-integration.html#cb166-9"></a>)</span>
<span id="cb166-10"><a href="a-complete-integration.html#cb166-10"></a></span>
<span id="cb166-11"><a href="a-complete-integration.html#cb166-11"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</span>
<span id="cb166-12"><a href="a-complete-integration.html#cb166-12"></a>  <span class="kw">send_alert</span>(<span class="st">&quot;Hello from the server!&quot;</span>)</span>
<span id="cb166-13"><a href="a-complete-integration.html#cb166-13"></a></span>
<span id="cb166-14"><a href="a-complete-integration.html#cb166-14"></a>  output<span class="op">$</span>callback &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</span>
<span id="cb166-15"><a href="a-complete-integration.html#cb166-15"></a>    <span class="kw">paste</span>(<span class="st">&quot;Is the alert closed: &quot;</span>, input<span class="op">$</span>alert_close)</span>
<span id="cb166-16"><a href="a-complete-integration.html#cb166-16"></a>  })</span>
<span id="cb166-17"><a href="a-complete-integration.html#cb166-17"></a>}</span>
<span id="cb166-18"><a href="a-complete-integration.html#cb166-18"></a></span>
<span id="cb166-19"><a href="a-complete-integration.html#cb166-19"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>However, while the above will work for a single alert it will run into issues when creating more than one alert as multiple alerts will set a value for a single input (<code>input$alert_close</code>). This is can be remedied to.</p>
<p>The package needs to provide the user a way to distinguish between alerts in order to be able to observe the correct inputs server-side.
A simple solution consists in asking the user to provide an identifier (<code>id</code>). This identifier must be passed to the JavaScript client so the function can dynamically set the input value for that identifier, therefore it is included in the <code>message</code>, below we do so in such a way that the original JSON of options remains unchanged.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="a-complete-integration.html#cb167-1"></a><span class="co">#&#39; Create an Alert</span></span>
<span id="cb167-2"><a href="a-complete-integration.html#cb167-2"></a><span class="co">#&#39; @export</span></span>
<span id="cb167-3"><a href="a-complete-integration.html#cb167-3"></a>send_alert &lt;-<span class="st"> </span><span class="cf">function</span>(id, <span class="dt">content =</span> <span class="st">&quot;alert&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">session =</span> shiny<span class="op">::</span><span class="kw">getDefaultReactiveDomain</span>()){</span>
<span id="cb167-4"><a href="a-complete-integration.html#cb167-4"></a>  <span class="co"># define notice options</span></span>
<span id="cb167-5"><a href="a-complete-integration.html#cb167-5"></a>  notice =<span class="st"> </span><span class="kw">list</span>(<span class="dt">content =</span> content, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb167-6"><a href="a-complete-integration.html#cb167-6"></a></span>
<span id="cb167-7"><a href="a-complete-integration.html#cb167-7"></a>  <span class="co"># add id</span></span>
<span id="cb167-8"><a href="a-complete-integration.html#cb167-8"></a>  message &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">id =</span> id, <span class="dt">notice =</span> notice)</span>
<span id="cb167-9"><a href="a-complete-integration.html#cb167-9"></a></span>
<span id="cb167-10"><a href="a-complete-integration.html#cb167-10"></a>  <span class="co"># send the notice</span></span>
<span id="cb167-11"><a href="a-complete-integration.html#cb167-11"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="dt">type =</span> <span class="st">&quot;send-alert&quot;</span>, <span class="dt">message =</span> message)</span>
<span id="cb167-12"><a href="a-complete-integration.html#cb167-12"></a>}</span></code></pre></div>
<p>Now one can adapt the JavaScript code to make use of the identifier. One needs to include said identifier in the name of the input the value of which is set, below we concatenate before the original input name. This is not forced upon the developer but is a convention, packages like DT and plotly approach the issue the same way: <code>id + name_of_input</code>. The event is thus now appended to <code>message.notice</code>, which is also used when creating the jBox alert.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb168-1"><a href="a-complete-integration.html#cb168-1"></a><span class="co">// custom.js</span></span>
<span id="cb168-2"><a href="a-complete-integration.html#cb168-2"></a><span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(type <span class="op">=</span> <span class="st">&#39;send-alert&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb168-3"><a href="a-complete-integration.html#cb168-3"></a>  <span class="va">message</span>.<span class="va">notice</span>.<span class="at">onClose</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{</span></span>
<span id="cb168-4"><a href="a-complete-integration.html#cb168-4"></a>    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;close&quot;</span>)<span class="op">;</span></span>
<span id="cb168-5"><a href="a-complete-integration.html#cb168-5"></a>    <span class="va">Shiny</span>.<span class="at">setInputValue</span>(<span class="va">message</span>.<span class="at">id</span> <span class="op">+</span> <span class="st">&#39;_alert_close&#39;</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb168-6"><a href="a-complete-integration.html#cb168-6"></a>  <span class="op">}</span></span>
<span id="cb168-7"><a href="a-complete-integration.html#cb168-7"></a>  <span class="kw">new</span> <span class="at">jBox</span>(<span class="st">&#39;Notice&#39;</span><span class="op">,</span> <span class="va">message</span>.<span class="at">notice</span>)<span class="op">;</span></span>
<span id="cb168-8"><a href="a-complete-integration.html#cb168-8"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
</div>
<div id="input-handler" class="section level3 unnumbered" number="">
<h3>Input Handler</h3>
<p>The input defined in this package simply consists of a boolean value which does not warrant the use of an input handler. However, were one required the place to put it would be in the <code>.onLoad</code> function as the handler can only be registered once.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="a-complete-integration.html#cb169-1"></a><span class="co"># R/zzz.R</span></span>
<span id="cb169-2"><a href="a-complete-integration.html#cb169-2"></a></span>
<span id="cb169-3"><a href="a-complete-integration.html#cb169-3"></a>jbox_handler &lt;-<span class="st"> </span><span class="cf">function</span>(data, session, inputname){</span>
<span id="cb169-4"><a href="a-complete-integration.html#cb169-4"></a>  <span class="kw">list</span>(</span>
<span id="cb169-5"><a href="a-complete-integration.html#cb169-5"></a>    <span class="dt">data =</span> data,</span>
<span id="cb169-6"><a href="a-complete-integration.html#cb169-6"></a>    <span class="dt">meta =</span> <span class="st">&quot;This is some metadata&quot;</span></span>
<span id="cb169-7"><a href="a-complete-integration.html#cb169-7"></a>  )</span>
<span id="cb169-8"><a href="a-complete-integration.html#cb169-8"></a>}</span>
<span id="cb169-9"><a href="a-complete-integration.html#cb169-9"></a></span>
<span id="cb169-10"><a href="a-complete-integration.html#cb169-10"></a>.onLoad &lt;-<span class="st"> </span><span class="cf">function</span>(libname, pkgname) {</span>
<span id="cb169-11"><a href="a-complete-integration.html#cb169-11"></a>  <span class="co"># serve static files</span></span>
<span id="cb169-12"><a href="a-complete-integration.html#cb169-12"></a>  shiny<span class="op">::</span><span class="kw">addResourcePath</span>(</span>
<span id="cb169-13"><a href="a-complete-integration.html#cb169-13"></a>    <span class="st">&quot;jbox-assets&quot;</span>,</span>
<span id="cb169-14"><a href="a-complete-integration.html#cb169-14"></a>    <span class="kw">system.file</span>(<span class="st">&quot;assets&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;jbox&quot;</span>)</span>
<span id="cb169-15"><a href="a-complete-integration.html#cb169-15"></a>  )</span>
<span id="cb169-16"><a href="a-complete-integration.html#cb169-16"></a></span>
<span id="cb169-17"><a href="a-complete-integration.html#cb169-17"></a>  <span class="co"># register input handler</span></span>
<span id="cb169-18"><a href="a-complete-integration.html#cb169-18"></a>  <span class="kw">registerInputHandler</span>(<span class="st">&quot;jbox.alert.handler&quot;</span>, jbox_handler)</span>
<span id="cb169-19"><a href="a-complete-integration.html#cb169-19"></a>}</span></code></pre></div>
</div>
<div id="wrapping-up" class="section level3 unnumbered" number="">
<h3>Wrapping up</h3>
<p>Building and installing the package will now provide the user an interface demonstrated below.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="a-complete-integration.html#cb170-1"></a><span class="kw">library</span>(jbox)</span>
<span id="cb170-2"><a href="a-complete-integration.html#cb170-2"></a><span class="kw">library</span>(shiny)</span>
<span id="cb170-3"><a href="a-complete-integration.html#cb170-3"></a></span>
<span id="cb170-4"><a href="a-complete-integration.html#cb170-4"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb170-5"><a href="a-complete-integration.html#cb170-5"></a>  <span class="kw">usejBox</span>(),</span>
<span id="cb170-6"><a href="a-complete-integration.html#cb170-6"></a>  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;callback&quot;</span>)</span>
<span id="cb170-7"><a href="a-complete-integration.html#cb170-7"></a>)</span>
<span id="cb170-8"><a href="a-complete-integration.html#cb170-8"></a></span>
<span id="cb170-9"><a href="a-complete-integration.html#cb170-9"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</span>
<span id="cb170-10"><a href="a-complete-integration.html#cb170-10"></a>  <span class="kw">send_alert</span>(<span class="st">&quot;myid&quot;</span>, <span class="st">&quot;Hello from the server!&quot;</span>)</span>
<span id="cb170-11"><a href="a-complete-integration.html#cb170-11"></a></span>
<span id="cb170-12"><a href="a-complete-integration.html#cb170-12"></a>  output<span class="op">$</span>callback &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</span>
<span id="cb170-13"><a href="a-complete-integration.html#cb170-13"></a>    <span class="kw">paste</span>(<span class="st">&quot;Is the alert closed: &quot;</span>, input<span class="op">$</span>myid_alert_close)</span>
<span id="cb170-14"><a href="a-complete-integration.html#cb170-14"></a>  })</span>
<span id="cb170-15"><a href="a-complete-integration.html#cb170-15"></a>}</span>
<span id="cb170-16"><a href="a-complete-integration.html#cb170-16"></a></span>
<span id="cb170-17"><a href="a-complete-integration.html#cb170-17"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>It must be noted that though the package will be fully functional it will not pass any checks as documentation is poor and the DESCRIPTION incomplete. The API provided to the user is probably subpar in places, namely with the use of the id, which, unless the user needs to observe the respective input, is not necessary: forcing the user to provide it is not great design, consider making this optional.</p>
</div>
</div>
<div id="exercises" class="section level2 unnumbered" number="">
<h2>Exercises</h2>
<p>If one wants to create such packages or make extensive use of such integrations with Shiny, it is greatly encouraged to explore it further, namely by improving the API constructed and extending the functionalities (jBox comes with much more than just alerts), even integrate a JavaScript of your choice. At the time of writing this there is not package providing integration with jBox, if that is not of interest to the reader below are some other great libraries that are yet to be packaged in R and would greatly benefit the R community:</p>
<ul>
<li><a href="https://github.com/Ghosh/micromodal">micromodal.js</a> - tiny, dependency-free javascript library for creating accessible modal dialogs</li>
<li><a href="https://github.com/jaywcjlove/hotkeys">hotkeys</a> - Capturing keyboard inputs</li>
<li><a href="https://github.com/victordibia/handtrack.js">handtrack.js</a> - realtime hand detection</li>
<li><a href="https://github.com/skt-t1-byungi/rsup-progress">Rsup-progress</a> - simple progress bars</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tips-tricks.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/JohnCoene/r-and-javascript/edit/master/12-shiny-complete.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
