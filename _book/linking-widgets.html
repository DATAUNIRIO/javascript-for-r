<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Linking Widgets | JavaScript for R</title>
  <meta name="description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Linking Widgets | JavaScript for R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="github-repo" content="JohnCoene/javascript-for-r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Linking Widgets | JavaScript for R" />
  
  <meta name="twitter:description" content="Invite JavaScript into your Data Science workflow." />
  

<meta name="author" content="John Coene" />


<meta name="date" content="2020-09-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="widgets-adv.html"/>
<link rel="next" href="widgets-final.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block/empty-anchor.js"></script>
<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>
<script src="libs/core-js/shim.min.js"></script>
<script src="libs/react/react.min.js"></script>
<script src="libs/react/react-dom.min.js"></script>
<script src="libs/reactwidget/react-tools.js"></script>
<script src="libs/reactable-binding/reactable.js"></script>
<script src="libs/r2d3-render/r2d3-render.js"></script>
<script src="libs/webcomponents/webcomponents.js"></script>
<script src="libs/r2d3-binding/r2d3.js"></script>
<script src="libs/d3v5/d3.min.js"></script>
<script src="libs/viz/viz.js"></script>
<link href="libs/DiagrammeR-styles/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">JavaScript for R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#premise"><i class="fa fa-check"></i>Premise</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-structure"><i class="fa fa-check"></i>Book Structure</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgement"><i class="fa fa-check"></i>Acknowledgement</a></li>
</ul></li>
<li class="part"><span><b>I Basics &amp; Roadmap</b></span></li>
<li class="chapter" data-level="1" data-path="intro-overview.html"><a href="intro-overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro-overview.html"><a href="intro-overview.html#intro-overview-rationale"><i class="fa fa-check"></i><b>1.1</b> Rationale</a></li>
<li class="chapter" data-level="1.2" data-path="intro-overview.html"><a href="intro-overview.html#intro-methods"><i class="fa fa-check"></i><b>1.2</b> Methods</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="intro-overview.html"><a href="intro-overview.html#intro-v8"><i class="fa fa-check"></i><b>1.2.1</b> V8</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro-overview.html"><a href="intro-overview.html#intro-htmlwidgets"><i class="fa fa-check"></i><b>1.2.2</b> htmlwidgets</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro-overview.html"><a href="intro-overview.html#intro-shiny"><i class="fa fa-check"></i><b>1.2.3</b> Shiny</a></li>
<li class="chapter" data-level="1.2.4" data-path="intro-overview.html"><a href="intro-overview.html#intro-bubble"><i class="fa fa-check"></i><b>1.2.4</b> bubble</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro-overview.html"><a href="intro-overview.html#intro-amiss"><i class="fa fa-check"></i><b>1.3</b> Methods Amiss</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro-overview.html"><a href="intro-overview.html#intro-reactr"><i class="fa fa-check"></i><b>1.3.1</b> reactR</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro-overview.html"><a href="intro-overview.html#intro-r2d3"><i class="fa fa-check"></i><b>1.3.2</b> r2d3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>2</b> Prerequisites</a>
<ul>
<li class="chapter" data-level="2.1" data-path="prerequisites.html"><a href="prerequisites.html#basics-pacakge-dev"><i class="fa fa-check"></i><b>2.1</b> R Package Development</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="prerequisites.html"><a href="prerequisites.html#basics-create-pkg"><i class="fa fa-check"></i><b>2.1.1</b> Creating a Package</a></li>
<li class="chapter" data-level="2.1.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-metadata"><i class="fa fa-check"></i><b>2.1.2</b> Metadata</a></li>
<li class="chapter" data-level="2.1.3" data-path="prerequisites.html"><a href="prerequisites.html#basics-r-code"><i class="fa fa-check"></i><b>2.1.3</b> R code</a></li>
<li class="chapter" data-level="2.1.4" data-path="prerequisites.html"><a href="prerequisites.html#basics-documentation"><i class="fa fa-check"></i><b>2.1.4</b> Documentation</a></li>
<li class="chapter" data-level="2.1.5" data-path="prerequisites.html"><a href="prerequisites.html#basics-installed-files"><i class="fa fa-check"></i><b>2.1.5</b> Installed files</a></li>
<li class="chapter" data-level="2.1.6" data-path="prerequisites.html"><a href="prerequisites.html#basics-build-load-install"><i class="fa fa-check"></i><b>2.1.6</b> Build, load, and install</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-json"><i class="fa fa-check"></i><b>2.2</b> JSON</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="prerequisites.html"><a href="prerequisites.html#serialising"><i class="fa fa-check"></i><b>2.2.1</b> Serialising</a></li>
<li class="chapter" data-level="2.2.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-tabular"><i class="fa fa-check"></i><b>2.2.2</b> Tabular Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="prerequisites.html"><a href="prerequisites.html#basics-javascript"><i class="fa fa-check"></i><b>2.3</b> JavaScript</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="prerequisites.html"><a href="prerequisites.html#basics-chrome-devtools"><i class="fa fa-check"></i><b>2.3.1</b> Developer Tools</a></li>
<li class="chapter" data-level="2.3.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-var-scope"><i class="fa fa-check"></i><b>2.3.2</b> Variable Declaration and Scope</a></li>
<li class="chapter" data-level="2.3.3" data-path="prerequisites.html"><a href="prerequisites.html#basics-object-model"><i class="fa fa-check"></i><b>2.3.3</b> Document Object Model</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="prerequisites.html"><a href="prerequisites.html#basics-shiny"><i class="fa fa-check"></i><b>2.4</b> Shiny</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="prerequisites.html"><a href="prerequisites.html#basics-htmltools"><i class="fa fa-check"></i><b>2.4.1</b> Htmltools</a></li>
<li class="chapter" data-level="2.4.2" data-path="prerequisites.html"><a href="prerequisites.html#basics-static-files"><i class="fa fa-check"></i><b>2.4.2</b> Static Files</a></li>
<li class="chapter" data-level="2.4.3" data-path="prerequisites.html"><a href="prerequisites.html#basics-deps-pro-cons"><i class="fa fa-check"></i><b>2.4.3</b> Dependencies Pros and Cons</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Data Visualisation</b></span></li>
<li class="chapter" data-level="3" data-path="widgets-intro-intro.html"><a href="widgets-intro-intro.html"><i class="fa fa-check"></i><b>3</b> Introduction to Widgets</a>
<ul>
<li class="chapter" data-level="3.1" data-path="widgets-intro-intro.html"><a href="widgets-intro-intro.html#widgets-plotly"><i class="fa fa-check"></i><b>3.1</b> Plotly package</a></li>
<li class="chapter" data-level="3.2" data-path="widgets-intro-intro.html"><a href="widgets-intro-intro.html#widgets-intro-dt"><i class="fa fa-check"></i><b>3.2</b> DT package</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="widgets-basics.html"><a href="widgets-basics.html"><i class="fa fa-check"></i><b>4</b> Basics of Building Widgets</a>
<ul>
<li class="chapter" data-level="4.1" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-candidates"><i class="fa fa-check"></i><b>4.1</b> Candidate Libraries</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-candidates-plotly"><i class="fa fa-check"></i><b>4.1.1</b> Plotly.js</a></li>
<li class="chapter" data-level="4.1.2" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-candidates-highcharts"><i class="fa fa-check"></i><b>4.1.2</b> Highchart.js</a></li>
<li class="chapter" data-level="4.1.3" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-candidates-chart.js"><i class="fa fa-check"></i><b>4.1.3</b> Chart.js</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="widgets-basics.html"><a href="widgets-basics.html#widgets-basics-inner-workings"><i class="fa fa-check"></i><b>4.2</b> How it works</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="widgets-first.html"><a href="widgets-first.html"><i class="fa fa-check"></i><b>5</b> Your First Widget</a>
<ul>
<li class="chapter" data-level="5.1" data-path="widgets-first.html"><a href="widgets-first.html#widgets-first-scaffold"><i class="fa fa-check"></i><b>5.1</b> The Scaffold</a></li>
<li class="chapter" data-level="5.2" data-path="widgets-first.html"><a href="widgets-first.html#widgets-first-htmloutput"><i class="fa fa-check"></i><b>5.2</b> The HTML Output</a></li>
<li class="chapter" data-level="5.3" data-path="widgets-first.html"><a href="widgets-first.html#widgets-first-js-files"><i class="fa fa-check"></i><b>5.3</b> JavaScript Files</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="widgets-realistic.html"><a href="widgets-realistic.html"><i class="fa fa-check"></i><b>6</b> A Realistic Widget</a>
<ul>
<li class="chapter" data-level="6.1" data-path="widgets-realistic.html"><a href="widgets-realistic.html#widgets-realistic-deps"><i class="fa fa-check"></i><b>6.1</b> Dependencies</a></li>
<li class="chapter" data-level="6.2" data-path="widgets-realistic.html"><a href="widgets-realistic.html#widgets-realistic-implementation"><i class="fa fa-check"></i><b>6.2</b> Implementation</a></li>
<li class="chapter" data-level="6.3" data-path="widgets-realistic.html"><a href="widgets-realistic.html#widgets-realistic-html-element"><i class="fa fa-check"></i><b>6.3</b> HTML Element</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="widgets-full.html"><a href="widgets-full.html"><i class="fa fa-check"></i><b>7</b> The Full Monty</a>
<ul>
<li class="chapter" data-level="7.1" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-deps"><i class="fa fa-check"></i><b>7.1</b> Dependencies</a></li>
<li class="chapter" data-level="7.2" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-js"><i class="fa fa-check"></i><b>7.2</b> JavaScript</a></li>
<li class="chapter" data-level="7.3" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-data"><i class="fa fa-check"></i><b>7.3</b> Working with Data</a></li>
<li class="chapter" data-level="7.4" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data"><i class="fa fa-check"></i><b>7.4</b> Transforming Data</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data-js"><i class="fa fa-check"></i><b>7.4.1</b> Using JavaScript</a></li>
<li class="chapter" data-level="7.4.2" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data-r"><i class="fa fa-check"></i><b>7.4.2</b> Using R</a></li>
<li class="chapter" data-level="7.4.3" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-transform-data-conclusion"><i class="fa fa-check"></i><b>7.4.3</b> Pros &amp; Cons</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="widgets-full.html"><a href="widgets-full.html#widgets-full-on-print"><i class="fa fa-check"></i><b>7.5</b> On Print Method</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="widgets-adv.html"><a href="widgets-adv.html"><i class="fa fa-check"></i><b>8</b> Advanced Topics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-shared"><i class="fa fa-check"></i><b>8.1</b> Shared Variables</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-sizing"><i class="fa fa-check"></i><b>8.1.1</b> Sizing</a></li>
<li class="chapter" data-level="8.1.2" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-sizing-policy"><i class="fa fa-check"></i><b>8.1.2</b> Sizing Policy</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-resizing"><i class="fa fa-check"></i><b>8.2</b> Resizing</a></li>
<li class="chapter" data-level="8.3" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-prerender"><i class="fa fa-check"></i><b>8.3</b> Pre Render Hooks &amp; Security</a></li>
<li class="chapter" data-level="8.4" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-js"><i class="fa fa-check"></i><b>8.4</b> JavaScript Code</a></li>
<li class="chapter" data-level="8.5" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-prepend-append"><i class="fa fa-check"></i><b>8.5</b> Prepend &amp; Append Content</a></li>
<li class="chapter" data-level="8.6" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-dependencies"><i class="fa fa-check"></i><b>8.6</b> Dependencies</a></li>
<li class="chapter" data-level="8.7" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-compatibility"><i class="fa fa-check"></i><b>8.7</b> Compatibility</a></li>
<li class="chapter" data-level="8.8" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-unit-tests"><i class="fa fa-check"></i><b>8.8</b> Unit Tests</a></li>
<li class="chapter" data-level="8.9" data-path="widgets-adv.html"><a href="widgets-adv.html#widgets-adv-performances"><i class="fa fa-check"></i><b>8.9</b> Performances</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="linking-widgets.html"><a href="linking-widgets.html"><i class="fa fa-check"></i><b>9</b> Linking Widgets</a>
<ul>
<li class="chapter" data-level="9.1" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-examples"><i class="fa fa-check"></i><b>9.1</b> Crosstalk Examples</a></li>
<li class="chapter" data-level="9.2" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-req"><i class="fa fa-check"></i><b>9.2</b> Crosstalk Requirements</a></li>
<li class="chapter" data-level="9.3" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-inner-workings"><i class="fa fa-check"></i><b>9.3</b> How it Works</a></li>
<li class="chapter" data-level="9.4" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-gio"><i class="fa fa-check"></i><b>9.4</b> Crosstalk with Gio</a></li>
<li class="chapter" data-level="9.5" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-r"><i class="fa fa-check"></i><b>9.5</b> R code</a></li>
<li class="chapter" data-level="9.6" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-js"><i class="fa fa-check"></i><b>9.6</b> JavaScript code</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-send-keys"><i class="fa fa-check"></i><b>9.6.1</b> Send Selected Keys</a></li>
<li class="chapter" data-level="9.6.2" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-set-keys"><i class="fa fa-check"></i><b>9.6.2</b> Set Selected Keys</a></li>
<li class="chapter" data-level="9.6.3" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-recap"><i class="fa fa-check"></i><b>9.6.3</b> Recap JavaScript Code</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="linking-widgets.html"><a href="linking-widgets.html#linking-widgets-using"><i class="fa fa-check"></i><b>9.7</b> Using Crosstalk with Gio</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="widgets-final.html"><a href="widgets-final.html"><i class="fa fa-check"></i><b>10</b> Final Revisions</a>
<ul>
<li class="chapter" data-level="10.1" data-path="widgets-final.html"><a href="widgets-final.html#widgets-final-data"><i class="fa fa-check"></i><b>10.1</b> Htmlwidgets &amp; Data</a></li>
<li class="chapter" data-level="10.2" data-path="widgets-final.html"><a href="widgets-final.html#widgets-final-options"><i class="fa fa-check"></i><b>10.2</b> Plethora of Options</a></li>
<li class="chapter" data-level="10.3" data-path="widgets-final.html"><a href="widgets-final.html#widgets-final-interface"><i class="fa fa-check"></i><b>10.3</b> Interface Design</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="widgets-ex-plotly.html"><a href="widgets-ex-plotly.html"><i class="fa fa-check"></i><b>11</b> Excercise - Ploty</a>
<ul>
<li class="chapter" data-level="11.1" data-path="widgets-ex-plotly.html"><a href="widgets-ex-plotly.html#widgets-ex-plotly-discover"><i class="fa fa-check"></i><b>11.1</b> Discover Plotly</a></li>
<li class="chapter" data-level="11.2" data-path="widgets-ex-plotly.html"><a href="widgets-ex-plotly.html#widgets-ex-plotly-basics"><i class="fa fa-check"></i><b>11.2</b> Basics of Plotly</a></li>
<li class="chapter" data-level="11.3" data-path="widgets-ex-plotly.html"><a href="widgets-ex-plotly.html#widgets-ex-plotly-js-to-r"><i class="fa fa-check"></i><b>11.3</b> JavaScript to R</a></li>
<li class="chapter" data-level="11.4" data-path="widgets-ex-plotly.html"><a href="widgets-ex-plotly.html#widgets-ex-plotly-r-to-js"><i class="fa fa-check"></i><b>11.4</b> R to JavaScript</a></li>
<li class="chapter" data-level="11.5" data-path="widgets-ex-plotly.html"><a href="widgets-ex-plotly.html#widgets-ex-plotly-sizing"><i class="fa fa-check"></i><b>11.5</b> Size &amp; Resize</a></li>
<li class="chapter" data-level="11.6" data-path="widgets-ex-plotly.html"><a href="widgets-ex-plotly.html#widgets-ex-plotly-perf-security"><i class="fa fa-check"></i><b>11.6</b> Performance &amp; Security</a></li>
</ul></li>
<li class="part"><span><b>III Web Development with Shiny</b></span></li>
<li class="chapter" data-level="12" data-path="shiny-intro.html"><a href="shiny-intro.html"><i class="fa fa-check"></i><b>12</b> Introduction to Shiny</a>
<ul>
<li class="chapter" data-level="12.1" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-websocket"><i class="fa fa-check"></i><b>12.1</b> Websocket &amp; Shiny</a></li>
<li class="chapter" data-level="12.2" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-example"><i class="fa fa-check"></i><b>12.2</b> Alerts, An Example</a></li>
<li class="chapter" data-level="12.3" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-r-to-js"><i class="fa fa-check"></i><b>12.3</b> From R to JavaScript</a></li>
<li class="chapter" data-level="12.4" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-js-to-r"><i class="fa fa-check"></i><b>12.4</b> From JavaScript to R</a></li>
<li class="chapter" data-level="12.5" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-intro-deserialise"><i class="fa fa-check"></i><b>12.5</b> Deserialise</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="shiny-complete.html"><a href="shiny-complete.html"><i class="fa fa-check"></i><b>13</b> A Complete Integration</a>
<ul>
<li class="chapter" data-level="13.1" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-serialise"><i class="fa fa-check"></i><b>13.1</b> Serialisation</a></li>
<li class="chapter" data-level="13.2" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-events"><i class="fa fa-check"></i><b>13.2</b> Events &amp; Callbacks</a></li>
<li class="chapter" data-level="13.3" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg"><i class="fa fa-check"></i><b>13.3</b> As a Package</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-deps"><i class="fa fa-check"></i><b>13.3.1</b> Dependencies</a></li>
<li class="chapter" data-level="13.3.2" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-r-code"><i class="fa fa-check"></i><b>13.3.2</b> R Code</a></li>
<li class="chapter" data-level="13.3.3" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-js-code"><i class="fa fa-check"></i><b>13.3.3</b> JavaScript Code</a></li>
<li class="chapter" data-level="13.3.4" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-input"><i class="fa fa-check"></i><b>13.3.4</b> Input Handler</a></li>
<li class="chapter" data-level="13.3.5" data-path="shiny-complete.html"><a href="shiny-complete.html#shiny-complete-pkg-conclude"><i class="fa fa-check"></i><b>13.3.5</b> Wrapping up</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="shiny-tips.html"><a href="shiny-tips.html"><i class="fa fa-check"></i><b>14</b> Tips &amp; Tricks</a>
<ul>
<li class="chapter" data-level="14.1" data-path="shiny-tips.html"><a href="shiny-tips.html#shiny-tips-events"><i class="fa fa-check"></i><b>14.1</b> Shiny Events</a></li>
<li class="chapter" data-level="14.2" data-path="shiny-tips.html"><a href="shiny-tips.html#shiny-tips-table-btn"><i class="fa fa-check"></i><b>14.2</b> Table Buttons</a></li>
<li class="chapter" data-level="14.3" data-path="shiny-tips.html"><a href="shiny-tips.html#shiny-tips-jQuery"><i class="fa fa-check"></i><b>14.3</b> jQuery</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="shiny-output.html"><a href="shiny-output.html"><i class="fa fa-check"></i><b>15</b> Custom Outputs</a>
<ul>
<li class="chapter" data-level="15.1" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-inner-workings"><i class="fa fa-check"></i><b>15.1</b> Inner-workings</a></li>
<li class="chapter" data-level="15.2" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-setup"><i class="fa fa-check"></i><b>15.2</b> Setup</a></li>
<li class="chapter" data-level="15.3" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-r-fun"><i class="fa fa-check"></i><b>15.3</b> Output R Function</a></li>
<li class="chapter" data-level="15.4" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-html"><i class="fa fa-check"></i><b>15.4</b> Generate Output HTML</a></li>
<li class="chapter" data-level="15.5" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-renderer"><i class="fa fa-check"></i><b>15.5</b> Output Renderer</a></li>
<li class="chapter" data-level="15.6" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-binding"><i class="fa fa-check"></i><b>15.6</b> JavaScript Output Binding</a>
<ul>
<li class="chapter" data-level="15.6.1" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-boxxy-title"><i class="fa fa-check"></i><b>15.6.1</b> Boxxy Title</a></li>
<li class="chapter" data-level="15.6.2" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-boxxy-value"><i class="fa fa-check"></i><b>15.6.2</b> Boxxy Value</a></li>
<li class="chapter" data-level="15.6.3" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-boxxy-bg-color"><i class="fa fa-check"></i><b>15.6.3</b> Boxxy Background Color</a></li>
<li class="chapter" data-level="15.6.4" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-register"><i class="fa fa-check"></i><b>15.6.4</b> Register the Output Binding</a></li>
</ul></li>
<li class="chapter" data-level="15.7" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-usage"><i class="fa fa-check"></i><b>15.7</b> Boxxy Usage</a></li>
<li class="chapter" data-level="15.8" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-inject"><i class="fa fa-check"></i><b>15.8</b> Injecting Dependencies</a></li>
<li class="chapter" data-level="15.9" data-path="shiny-output.html"><a href="shiny-output.html#shiny-output-preprocess"><i class="fa fa-check"></i><b>15.9</b> Preprocessing Custom Outputs</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="shiny-input.html"><a href="shiny-input.html"><i class="fa fa-check"></i><b>16</b> Custom Inputs</a>
<ul>
<li class="chapter" data-level="16.1" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-setup"><i class="fa fa-check"></i><b>16.1</b> Setup</a></li>
<li class="chapter" data-level="16.2" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-intro"><i class="fa fa-check"></i><b>16.2</b> Switch Input HTML &amp; Style</a></li>
<li class="chapter" data-level="16.3" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-html"><i class="fa fa-check"></i><b>16.3</b> Generate Input HTML</a></li>
<li class="chapter" data-level="16.4" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-binding"><i class="fa fa-check"></i><b>16.4</b> JavaScript Input Binding</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-find"><i class="fa fa-check"></i><b>16.4.1</b> Find Inputs</a></li>
<li class="chapter" data-level="16.4.2" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-get-id"><i class="fa fa-check"></i><b>16.4.2</b> Get Input Id</a></li>
<li class="chapter" data-level="16.4.3" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-get-value"><i class="fa fa-check"></i><b>16.4.3</b> Get Input Value</a></li>
<li class="chapter" data-level="16.4.4" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-set-value"><i class="fa fa-check"></i><b>16.4.4</b> Set Input Value</a></li>
<li class="chapter" data-level="16.4.5" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-receive-msg"><i class="fa fa-check"></i><b>16.4.5</b> Receive Input Messages</a></li>
<li class="chapter" data-level="16.4.6" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-sub-unsub"><i class="fa fa-check"></i><b>16.4.6</b> Subscribe &amp; Unsubscribe Inputs</a></li>
<li class="chapter" data-level="16.4.7" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-rate-policy"><i class="fa fa-check"></i><b>16.4.7</b> Input Rate Policy</a></li>
<li class="chapter" data-level="16.4.8" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-register"><i class="fa fa-check"></i><b>16.4.8</b> Registering the Input Binding</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-update"><i class="fa fa-check"></i><b>16.5</b> Update Input</a></li>
<li class="chapter" data-level="16.6" data-path="shiny-input.html"><a href="shiny-input.html#shiny-input-excercise"><i class="fa fa-check"></i><b>16.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="shiny-cookies.html"><a href="shiny-cookies.html"><i class="fa fa-check"></i><b>17</b> Cookies</a>
<ul>
<li class="chapter" data-level="17.1" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-discover"><i class="fa fa-check"></i><b>17.1</b> Discover js-cookie</a></li>
<li class="chapter" data-level="17.2" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-setup"><i class="fa fa-check"></i><b>17.2</b> Setup Project</a></li>
<li class="chapter" data-level="17.3" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-javascript"><i class="fa fa-check"></i><b>17.3</b> JavaScript Cookies</a></li>
<li class="chapter" data-level="17.4" data-path="shiny-cookies.html"><a href="shiny-cookies.html#shiny-cookies-r-code"><i class="fa fa-check"></i><b>17.4</b> R Code</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="shiny-widgets.html"><a href="shiny-widgets.html"><i class="fa fa-check"></i><b>18</b> Widgets with Shiny</a>
<ul>
<li class="chapter" data-level="18.1" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-to-r"><i class="fa fa-check"></i><b>18.1</b> Widgets to R</a></li>
<li class="chapter" data-level="18.2" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-handlers"><i class="fa fa-check"></i><b>18.2</b> Input Handlers for Widgets</a></li>
<li class="chapter" data-level="18.3" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-r-to-widgets"><i class="fa fa-check"></i><b>18.3</b> R to Widgets</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-send-data"><i class="fa fa-check"></i><b>18.3.1</b> Send Data from Widgets</a></li>
<li class="chapter" data-level="18.3.2" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-retrieve"><i class="fa fa-check"></i><b>18.3.2</b> Retrieve Widget Instance</a></li>
<li class="chapter" data-level="18.3.3" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-handle-data"><i class="fa fa-check"></i><b>18.3.3</b> Handle Data</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-proxy"><i class="fa fa-check"></i><b>18.4</b> Proxy Function</a></li>
<li class="chapter" data-level="18.5" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-clear-data"><i class="fa fa-check"></i><b>18.5</b> Clear Data</a></li>
<li class="chapter" data-level="18.6" data-path="shiny-widgets.html"><a href="shiny-widgets.html#shiny-widgets-update"><i class="fa fa-check"></i><b>18.6</b> Update the Widget</a></li>
</ul></li>
<li class="part"><span><b>IV Interactive Documents</b></span></li>
<li class="chapter" data-level="19" data-path="rmd-intro.html"><a href="rmd-intro.html"><i class="fa fa-check"></i><b>19</b> Introduction to Rmarkdown</a></li>
<li class="part"><span><b>V JavaScript for Computations</b></span></li>
<li class="chapter" data-level="20" data-path="v8.html"><a href="v8.html"><i class="fa fa-check"></i><b>20</b> The V8 Engine</a>
<ul>
<li class="chapter" data-level="20.1" data-path="v8.html"><a href="v8.html#v8-installation"><i class="fa fa-check"></i><b>20.1</b> Installation</a></li>
<li class="chapter" data-level="20.2" data-path="v8.html"><a href="v8.html#v8-basics"><i class="fa fa-check"></i><b>20.2</b> Basics</a></li>
<li class="chapter" data-level="20.3" data-path="v8.html"><a href="v8.html#v8-external"><i class="fa fa-check"></i><b>20.3</b> External Libraries</a></li>
<li class="chapter" data-level="20.4" data-path="v8.html"><a href="v8.html#v8-npm"><i class="fa fa-check"></i><b>20.4</b> Npm Packages</a></li>
<li class="chapter" data-level="20.5" data-path="v8.html"><a href="v8.html#v8-pkg"><i class="fa fa-check"></i><b>20.5</b> Use in Packages</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="v8-ml.html"><a href="v8-ml.html"><i class="fa fa-check"></i><b>21</b> Exercise - Machine Learning</a>
<ul>
<li class="chapter" data-level="21.1" data-path="v8-ml.html"><a href="v8-ml.html#v8-ml-dependency"><i class="fa fa-check"></i><b>21.1</b> Dependency</a></li>
<li class="chapter" data-level="21.2" data-path="v8-ml.html"><a href="v8-ml.html#v8-ml-regression"><i class="fa fa-check"></i><b>21.2</b> Simple Regression</a></li>
</ul></li>
<li class="part"><span><b>VI Examples</b></span></li>
<li class="chapter" data-level="22" data-path="v8-img.html"><a href="v8-img.html"><i class="fa fa-check"></i><b>22</b> Image Classifier</a>
<ul>
<li class="chapter" data-level="22.1" data-path="v8-img.html"><a href="v8-img.html#v8-img-discover"><i class="fa fa-check"></i><b>22.1</b> Discover</a></li>
<li class="chapter" data-level="22.2" data-path="v8-img.html"><a href="v8-img.html#v8-img-setup"><i class="fa fa-check"></i><b>22.2</b> Setup</a></li>
<li class="chapter" data-level="22.3" data-path="v8-img.html"><a href="v8-img.html#v8-img-javascript"><i class="fa fa-check"></i><b>22.3</b> JavaScript</a></li>
<li class="chapter" data-level="22.4" data-path="v8-img.html"><a href="v8-img.html#v8-img-handler"><i class="fa fa-check"></i><b>22.4</b> Input Handler</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="progress.html"><a href="progress.html"><i class="fa fa-check"></i><b>23</b> Progress Bar</a>
<ul>
<li class="chapter" data-level="23.1" data-path="progress.html"><a href="progress.html#progress-r-code"><i class="fa fa-check"></i><b>23.1</b> R Code</a></li>
<li class="chapter" data-level="23.2" data-path="progress.html"><a href="progress.html#progress-js-code"><i class="fa fa-check"></i><b>23.2</b> JavaScript Code</a></li>
<li class="chapter" data-level="23.3" data-path="progress.html"><a href="progress.html#progress-events"><i class="fa fa-check"></i><b>23.3</b> Events</a></li>
</ul></li>
<li class="part"><span><b>VII Closing Remarks</b></span></li>
<li class="chapter" data-level="24" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>24</b> Conclusion</a>
<ul>
<li class="chapter" data-level="24.1" data-path="conclusion.html"><a href="conclusion.html#conclusion-performances"><i class="fa fa-check"></i><b>24.1</b> Performances</a></li>
<li class="chapter" data-level="24.2" data-path="conclusion.html"><a href="conclusion.html#conclusion-ahead"><i class="fa fa-check"></i><b>24.2</b> Road Ahead</a>
<ul>
<li class="chapter" data-level="24.2.1" data-path="conclusion.html"><a href="conclusion.html#compute"><i class="fa fa-check"></i><b>24.2.1</b> Computation</a></li>
<li class="chapter" data-level="24.2.2" data-path="conclusion.html"><a href="conclusion.html#shiny"><i class="fa fa-check"></i><b>24.2.2</b> Shiny</a></li>
<li class="chapter" data-level="24.2.3" data-path="conclusion.html"><a href="conclusion.html#widgets"><i class="fa fa-check"></i><b>24.2.3</b> htmlwidgets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">JavaScript for R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linking-widgets" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Linking Widgets</h1>
<p>Widgets can be linked with one another using the crosstalk <span class="citation">(Cheng <a href="#ref-R-crosstalk" role="doc-biblioref">2020</a>)</span> package, a fantastic add-on for htmlwidgets that implements inter-widget interactions, namely selection and filtering. This in effect allows the selection or filtering of data points in one widget to be mirrored in another. This is enabled with the creation of “shared datasets” that can be used across widgets; outputs that share datasets share interactions.</p>
<p>Crosstalk provides a straightforward interface to the users and instead requires effort from developers for their widgets to support shared datasets.</p>
<div id="linking-widgets-examples" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Crosstalk Examples</h2>
<p>Both the plotly and DT packages support crosstalk, therefore using a shared dataset we can produce a scatter plot with the former and a table with the latter so that selection of data in one is reflected in the other.</p>
<p>As alluded to earlier on this can be achieved by using a shared dataset which can be created with the <code>SharedData</code> R6 class from the crosstalk package, this dataset is then used as one would use a standard dataframe in plotly and DT. The <code>bscols</code> function is just a helper to create columns from html elements (using bootstrap). It’s ideal for examples but one should not have to use it in Shiny—crosstalk will work without <code>bscols</code>.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="linking-widgets.html#cb191-1"></a><span class="kw">library</span>(DT)</span>
<span id="cb191-2"><a href="linking-widgets.html#cb191-2"></a><span class="kw">library</span>(plotly)</span>
<span id="cb191-3"><a href="linking-widgets.html#cb191-3"></a><span class="kw">library</span>(crosstalk)</span>
<span id="cb191-4"><a href="linking-widgets.html#cb191-4"></a></span>
<span id="cb191-5"><a href="linking-widgets.html#cb191-5"></a>shared &lt;-<span class="st"> </span>SharedData<span class="op">$</span><span class="kw">new</span>(cars)</span>
<span id="cb191-6"><a href="linking-widgets.html#cb191-6"></a></span>
<span id="cb191-7"><a href="linking-widgets.html#cb191-7"></a><span class="kw">bscols</span>(</span>
<span id="cb191-8"><a href="linking-widgets.html#cb191-8"></a>  <span class="kw">plot_ly</span>(shared, <span class="dt">x =</span> <span class="op">~</span>speed, <span class="dt">y=</span><span class="op">~</span>dist),</span>
<span id="cb191-9"><a href="linking-widgets.html#cb191-9"></a>  <span class="kw">datatable</span>(shared, <span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>)</span>
<span id="cb191-10"><a href="linking-widgets.html#cb191-10"></a>)</span></code></pre></div>
<div class="figure">
<img src="images/crosstalk.png" alt="" />
<p class="caption">Crosstalk Example</p>
</div>
<p>Basic usage of crosstalk datasets in shiny is also straightforward since it accepts reactive expressions to create shared datasets. Note that it takes the expression itself (<code>reactive</code>) not the output of the expression (<code>expression()</code>), the crosstalk documentation explains it best:</p>
<blockquote>
<p>If this feels foreign to you, think of how you pass a function name, not a function call, to <code>lapply</code>; that’s exactly analogous to what we’re doing here.</p>
<p>— Official Crosstalk documentation</p>
</blockquote>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="linking-widgets.html#cb192-1"></a><span class="kw">library</span>(DT)</span>
<span id="cb192-2"><a href="linking-widgets.html#cb192-2"></a><span class="kw">library</span>(shiny)</span>
<span id="cb192-3"><a href="linking-widgets.html#cb192-3"></a><span class="kw">library</span>(plotly)</span>
<span id="cb192-4"><a href="linking-widgets.html#cb192-4"></a><span class="kw">library</span>(crosstalk)</span>
<span id="cb192-5"><a href="linking-widgets.html#cb192-5"></a></span>
<span id="cb192-6"><a href="linking-widgets.html#cb192-6"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb192-7"><a href="linking-widgets.html#cb192-7"></a>  <span class="kw">selectInput</span>(</span>
<span id="cb192-8"><a href="linking-widgets.html#cb192-8"></a>    <span class="st">&quot;specie&quot;</span>, <span class="st">&quot;Specie&quot;</span>, </span>
<span id="cb192-9"><a href="linking-widgets.html#cb192-9"></a>    <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;setosa&quot;</span>, <span class="st">&quot;versicolor&quot;</span>, <span class="st">&quot;virginica&quot;</span>)</span>
<span id="cb192-10"><a href="linking-widgets.html#cb192-10"></a>  ),</span>
<span id="cb192-11"><a href="linking-widgets.html#cb192-11"></a>  <span class="kw">fluidRow</span>(</span>
<span id="cb192-12"><a href="linking-widgets.html#cb192-12"></a>    <span class="kw">column</span>(<span class="dv">6</span>, <span class="kw">DTOutput</span>(<span class="st">&quot;table&quot;</span>)),</span>
<span id="cb192-13"><a href="linking-widgets.html#cb192-13"></a>    <span class="kw">column</span>(<span class="dv">6</span>, <span class="kw">plotlyOutput</span>(<span class="st">&quot;plot&quot;</span>))</span>
<span id="cb192-14"><a href="linking-widgets.html#cb192-14"></a>  )</span>
<span id="cb192-15"><a href="linking-widgets.html#cb192-15"></a>)</span>
<span id="cb192-16"><a href="linking-widgets.html#cb192-16"></a></span>
<span id="cb192-17"><a href="linking-widgets.html#cb192-17"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb192-18"><a href="linking-widgets.html#cb192-18"></a>  reactive_data &lt;-<span class="st"> </span><span class="kw">reactive</span>({</span>
<span id="cb192-19"><a href="linking-widgets.html#cb192-19"></a>    iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>specie, ]</span>
<span id="cb192-20"><a href="linking-widgets.html#cb192-20"></a>  })</span>
<span id="cb192-21"><a href="linking-widgets.html#cb192-21"></a></span>
<span id="cb192-22"><a href="linking-widgets.html#cb192-22"></a>  sd &lt;-<span class="st"> </span>SharedData<span class="op">$</span><span class="kw">new</span>(reactive_data)</span>
<span id="cb192-23"><a href="linking-widgets.html#cb192-23"></a></span>
<span id="cb192-24"><a href="linking-widgets.html#cb192-24"></a>  output<span class="op">$</span>table &lt;-<span class="st"> </span><span class="kw">renderDT</span>({</span>
<span id="cb192-25"><a href="linking-widgets.html#cb192-25"></a>    <span class="kw">datatable</span>(sd)</span>
<span id="cb192-26"><a href="linking-widgets.html#cb192-26"></a>  }, <span class="dt">server =</span> <span class="ot">FALSE</span>)</span>
<span id="cb192-27"><a href="linking-widgets.html#cb192-27"></a></span>
<span id="cb192-28"><a href="linking-widgets.html#cb192-28"></a>  output<span class="op">$</span>plot &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({</span>
<span id="cb192-29"><a href="linking-widgets.html#cb192-29"></a>    <span class="kw">plot_ly</span>(sd, <span class="dt">x =</span> <span class="op">~</span>Sepal.Length, <span class="dt">y =</span> <span class="op">~</span>Sepal.Width)</span>
<span id="cb192-30"><a href="linking-widgets.html#cb192-30"></a>  })</span>
<span id="cb192-31"><a href="linking-widgets.html#cb192-31"></a>}</span>
<span id="cb192-32"><a href="linking-widgets.html#cb192-32"></a></span>
<span id="cb192-33"><a href="linking-widgets.html#cb192-33"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="rmdnote">
<p>
Create the shared dataset in the server function or some things that follow might not work as expected.
</p>
</div>
<p>One can also use the <code>data</code> method on the crosstalk object in reactive expressions, which allows accessing the Javascript selection where crosstalk is not directly supported, like below in a custom UI block. Note that the argument <code>withSelection</code> is set to <code>TRUE</code> in order to retrieve the selection state of the rows.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="linking-widgets.html#cb193-1"></a><span class="kw">library</span>(DT)</span>
<span id="cb193-2"><a href="linking-widgets.html#cb193-2"></a><span class="kw">library</span>(shiny)</span>
<span id="cb193-3"><a href="linking-widgets.html#cb193-3"></a><span class="kw">library</span>(crosstalk)</span>
<span id="cb193-4"><a href="linking-widgets.html#cb193-4"></a></span>
<span id="cb193-5"><a href="linking-widgets.html#cb193-5"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb193-6"><a href="linking-widgets.html#cb193-6"></a>  <span class="kw">fluidRow</span>(</span>
<span id="cb193-7"><a href="linking-widgets.html#cb193-7"></a>    <span class="kw">column</span>(<span class="dv">4</span>, <span class="kw">uiOutput</span>(<span class="st">&quot;text&quot;</span>)),</span>
<span id="cb193-8"><a href="linking-widgets.html#cb193-8"></a>    <span class="kw">column</span>(<span class="dv">8</span>, <span class="kw">DTOutput</span>(<span class="st">&quot;table&quot;</span>))</span>
<span id="cb193-9"><a href="linking-widgets.html#cb193-9"></a>  )</span>
<span id="cb193-10"><a href="linking-widgets.html#cb193-10"></a>)</span>
<span id="cb193-11"><a href="linking-widgets.html#cb193-11"></a></span>
<span id="cb193-12"><a href="linking-widgets.html#cb193-12"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb193-13"><a href="linking-widgets.html#cb193-13"></a>  sd &lt;-<span class="st"> </span>SharedData<span class="op">$</span><span class="kw">new</span>(cars)</span>
<span id="cb193-14"><a href="linking-widgets.html#cb193-14"></a></span>
<span id="cb193-15"><a href="linking-widgets.html#cb193-15"></a>  output<span class="op">$</span>text &lt;-<span class="st"> </span><span class="kw">renderUI</span>({</span>
<span id="cb193-16"><a href="linking-widgets.html#cb193-16"></a>    <span class="co"># get selected rows</span></span>
<span id="cb193-17"><a href="linking-widgets.html#cb193-17"></a>    n_selected &lt;-<span class="st"> </span>sd<span class="op">$</span><span class="kw">data</span>(<span class="dt">withSelection =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb193-18"><a href="linking-widgets.html#cb193-18"></a><span class="st">      </span>dplyr<span class="op">::</span><span class="kw">filter</span>(selected_ <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb193-19"><a href="linking-widgets.html#cb193-19"></a><span class="st">      </span><span class="kw">nrow</span>()</span>
<span id="cb193-20"><a href="linking-widgets.html#cb193-20"></a></span>
<span id="cb193-21"><a href="linking-widgets.html#cb193-21"></a>    <span class="kw">h3</span>(n_selected, <span class="st">&quot;selected items&quot;</span>)</span>
<span id="cb193-22"><a href="linking-widgets.html#cb193-22"></a>    </span>
<span id="cb193-23"><a href="linking-widgets.html#cb193-23"></a>  })</span>
<span id="cb193-24"><a href="linking-widgets.html#cb193-24"></a></span>
<span id="cb193-25"><a href="linking-widgets.html#cb193-25"></a>  output<span class="op">$</span>table &lt;-<span class="st"> </span><span class="kw">renderDT</span>({</span>
<span id="cb193-26"><a href="linking-widgets.html#cb193-26"></a>    <span class="kw">datatable</span>(sd)</span>
<span id="cb193-27"><a href="linking-widgets.html#cb193-27"></a>  }, <span class="dt">server =</span> <span class="ot">FALSE</span>)</span>
<span id="cb193-28"><a href="linking-widgets.html#cb193-28"></a>}</span>
<span id="cb193-29"><a href="linking-widgets.html#cb193-29"></a></span>
<span id="cb193-30"><a href="linking-widgets.html#cb193-30"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="figure">
<img src="images/crosstalk-shiny.png" alt="" />
<p class="caption">Shiny with crosstalk</p>
</div>
<p>Using crosstalk with shiny one can also change the selection server-side with the <code>selection</code> method, passing it the keys to select.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="linking-widgets.html#cb194-1"></a><span class="kw">library</span>(DT)</span>
<span id="cb194-2"><a href="linking-widgets.html#cb194-2"></a><span class="kw">library</span>(shiny)</span>
<span id="cb194-3"><a href="linking-widgets.html#cb194-3"></a><span class="kw">library</span>(crosstalk)</span>
<span id="cb194-4"><a href="linking-widgets.html#cb194-4"></a></span>
<span id="cb194-5"><a href="linking-widgets.html#cb194-5"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb194-6"><a href="linking-widgets.html#cb194-6"></a>  <span class="kw">fluidRow</span>(</span>
<span id="cb194-7"><a href="linking-widgets.html#cb194-7"></a>    <span class="kw">column</span>(<span class="dv">4</span>, <span class="kw">actionButton</span>(<span class="st">&quot;random&quot;</span>, <span class="st">&quot;Select a random row&quot;</span>)),</span>
<span id="cb194-8"><a href="linking-widgets.html#cb194-8"></a>    <span class="kw">column</span>(<span class="dv">8</span>, <span class="kw">DTOutput</span>(<span class="st">&quot;table&quot;</span>))</span>
<span id="cb194-9"><a href="linking-widgets.html#cb194-9"></a>  )</span>
<span id="cb194-10"><a href="linking-widgets.html#cb194-10"></a>)</span>
<span id="cb194-11"><a href="linking-widgets.html#cb194-11"></a></span>
<span id="cb194-12"><a href="linking-widgets.html#cb194-12"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb194-13"><a href="linking-widgets.html#cb194-13"></a>  sd &lt;-<span class="st"> </span>SharedData<span class="op">$</span><span class="kw">new</span>(cars)</span>
<span id="cb194-14"><a href="linking-widgets.html#cb194-14"></a></span>
<span id="cb194-15"><a href="linking-widgets.html#cb194-15"></a>  output<span class="op">$</span>table &lt;-<span class="st"> </span><span class="kw">renderDT</span>({</span>
<span id="cb194-16"><a href="linking-widgets.html#cb194-16"></a>    <span class="kw">datatable</span>(sd)</span>
<span id="cb194-17"><a href="linking-widgets.html#cb194-17"></a>  }, <span class="dt">server =</span> <span class="ot">FALSE</span>)</span>
<span id="cb194-18"><a href="linking-widgets.html#cb194-18"></a></span>
<span id="cb194-19"><a href="linking-widgets.html#cb194-19"></a>  selected &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb194-20"><a href="linking-widgets.html#cb194-20"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>random, {</span>
<span id="cb194-21"><a href="linking-widgets.html#cb194-21"></a>    smp &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>)[<span class="op">!</span><span class="dv">1</span><span class="op">:</span><span class="dv">50</span> <span class="op">%in%</span><span class="st"> </span>selected]</span>
<span id="cb194-22"><a href="linking-widgets.html#cb194-22"></a>    selected &lt;&lt;-<span class="st"> </span><span class="kw">append</span>(selected, <span class="kw">sample</span>(smp, <span class="dv">1</span>))</span>
<span id="cb194-23"><a href="linking-widgets.html#cb194-23"></a>    sd<span class="op">$</span><span class="kw">selection</span>(selected)</span>
<span id="cb194-24"><a href="linking-widgets.html#cb194-24"></a>  })</span>
<span id="cb194-25"><a href="linking-widgets.html#cb194-25"></a>}</span>
<span id="cb194-26"><a href="linking-widgets.html#cb194-26"></a></span>
<span id="cb194-27"><a href="linking-widgets.html#cb194-27"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
</div>
<div id="linking-widgets-req" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Crosstalk Requirements</h2>
<p>Crosstalk is will not work well with every widget and every dataset, in some cases it might not even be a good idea to support it at all.</p>
<p>Crosstalk works best on rectangular data: dataframes or objects that resemble dataframes like <code>tibble</code> or <code>SpatialPolygonsDataFrame</code>. This is important as crosstalk will treat the data rowwise, where each row is an observation that is ultimately selected, or filtered. If the underlying data is not tabular (e.g.: trees) then one might eventually encounter mismatches between widgets as they go out of sync.</p>
<p>Other than tabular data, crosstalk will require the widget to have the necessary functions or methods to dispatch the selection and filtering that crosstalk enables, that is, the widget must be able to filter as well as highlight and fade selected data points as crosstalk itself does not provide this, neither the JavaScript nor the interface tools.</p>
</div>
<div id="linking-widgets-inner-workings" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> How it Works</h2>
<p>As will be discovered later when support for crosstalk is brought to gio, very little changes on the R side. As might be expected, crosstalk enables communication between widgets via JavaScript, hence much of what must be adapted by widgets developers happens in JavaScript too.</p>
<div id="htmlwidget-f42b82943d0f0a0d77e5" style="width:100%;height:250px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-f42b82943d0f0a0d77e5">{"x":{"diagram":"\ndigraph G {\n\n  graph [compound=true rankdir = LR]\n  node [shape=record fontsize=10];\n\n  # r stuff\n  subgraph cluster_1 { \n    \"Widget 1\" \"Widget 2\";\n    label = \"JavaScript\";\n    color=gold;\n  }\n\n  # js\n  subgraph cluster_0 {\n    node [width = 0.9]\n    Dataframe \"Shared Dataset\"; \n    label=\"R\";\n    color=royalBlue;\n  }\n\n  \"Dataframe\" -> \"Shared Dataset\";\n  \"Widget 1\" -> \"Widget 2\" [dir=both color=dimGray];\n\n  # connect subgraphs\n  \"Shared Dataset\" -> \"Widget 1\" [lhead=cluster_1 ltail=cluster_0];\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Indeed the bi-directional communication between widgets works in the RStudio viewer, R markdown, Shiny and elsewhere, clearly indicating that all of it is taking place in the browser. This internally works with <code>key</code>s that are assigned to every row of the dataframe which enable crosstalk to track which are selected or filtered. These keys can be explicitly set by the user and otherwise default to the row names of the data.frame, and if these are not available the <code>SharedData</code> function will create row numbers.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="linking-widgets.html#cb195-1"></a><span class="co"># assign keys</span></span>
<span id="cb195-2"><a href="linking-widgets.html#cb195-2"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">26</span>))</span>
<span id="cb195-3"><a href="linking-widgets.html#cb195-3"></a>sd &lt;-<span class="st"> </span>SharedData<span class="op">$</span><span class="kw">new</span>(df, <span class="dt">key =</span> letters)</span></code></pre></div>
<p>In a sense, while crosstalk establishes lines of communication to transport <code>key</code>s between widgets, developers of the respective widgets must handle what <code>key</code>s are sent and what to do with incoming <code>key</code>s. There are two such lines of communication, one for <code>key</code>s of rows to be filtered meant to narrow down the selection of data points displayed on a widget, and another for selection (what crosstalk refers to as “linked brushing”) to highlight certain data points.</p>
<div id="htmlwidget-b16aa908ae2c8b0b6975" style="width:100%;height:250px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-b16aa908ae2c8b0b6975">{"x":{"diagram":"\ndigraph G {\n\n  subgraph cluster_g1 {\n    node [shape=record fontsize=7]\n    d1 [label=\"Dataset\"]\n    d3 [label=\"Dataset\"]\n    k1 [label=\"Keys\"]\n    label=\"Group 1\"\n    fontsize=9\n    color=royalBlue\n  }\n\n  subgraph cluster_g2 {\n    node [shape=record fontsize=7]\n    d2 [label=\"Dataset\"] \n    k2 [label=\"Keys\"]\n    label=\"Group 2\"\n    fontsize=9\n    color=royalBlue\n  }\n\n  node [shape=record fontsize=7 color=gold]\n  w1 [label=\"widget 1\"]\n  w2 [label=\"widget 2\"]\n  w3 [label=\"widget 3\"]\n  w4 [label=\"widget 4\"]\n  w5 [label=\"widget 5\"]\n\n  w1 -> k1 [dir=both arrowsize=.5]\n  w2 -> k1 [dir=both arrowsize=.5]\n  w3 -> k2 [dir=both arrowsize=.5]\n  w4 -> k2 [dir=both arrowsize=.5]\n  w5 -> k2 [dir=both arrowsize=.5]\n\n  d2 -> k2 [arrowsize=.5]\n  d1 -> k1 [arrowsize=.5]\n  d3 -> k1 [arrowsize=.5]\n\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>In JavaScript, a widget “receives” the keys of selected and filtered data points and must, when filtering or selection is observed, “send” said selected or filtered keys to other widgets. Internally crosstalk knows what to share across widgets with <code>group</code>s groups share <code>key</code>s and are isolated from each other so one can use multiple different shared datasets without them interfering with each other.</p>
<div class="rmdnote">
<p>
Crosstalk groups share keys.
</p>
</div>
<p>Therefore, the code below creates two shared datasets that are linked and share keys as they fall in the same <code>group</code> despite the fact that they are separate R objects.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="linking-widgets.html#cb196-1"></a>shared_cars &lt;-<span class="st"> </span>SharedData<span class="op">$</span><span class="kw">new</span>(mtcars, <span class="dt">group =</span> <span class="st">&quot;cars&quot;</span>)</span>
<span id="cb196-2"><a href="linking-widgets.html#cb196-2"></a>shared_cars_head &lt;-<span class="st"> </span>SharedData<span class="op">$</span><span class="kw">new</span>(<span class="kw">head</span>(mtcars), <span class="dt">group =</span> <span class="st">&quot;cars&quot;</span>)</span></code></pre></div>
</div>
<div id="linking-widgets-gio" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Crosstalk with Gio</h2>
<p>The application of crosstalk to the gio library is somewhat amiss but it makes it rather more instructive. As mentioned before, in order for crosstalk to be properly implemented a widget must be a able to select, deselect as well as filter and unfilter data points and this is not entirely the case of gio.</p>
<p>First, gio’s underlying data is somewhat uncommon: it is a network defined only by its edges (the arcs leaving and coming into countries). Second, those edges themselves cannot be selected, as we’ve observed previously what edges are drawn on the globe cannot directly be defined, the selected country can be changed which only by proxy changes the edges shown on the globe. Third, while gio supports changing which country is selected (by clicking on the globe) it does not allow unselecting a country; with gio.js a country is always selected.</p>
<p>The way crosstalk can work with gio is by setting the keys of the shared dataset to the country ISO codes that gio uses. Since data gio accepts consists of edges this ISO code could correspond to either the source or the target country.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="linking-widgets.html#cb197-1"></a><span class="co"># keys = target</span></span>
<span id="cb197-2"><a href="linking-widgets.html#cb197-2"></a>shared_arcs &lt;-<span class="st"> </span>SharedData<span class="op">$</span><span class="kw">new</span>(arcs, <span class="dt">key =</span> arcs<span class="op">$</span>e)</span>
<span id="cb197-3"><a href="linking-widgets.html#cb197-3"></a><span class="co"># keys = source</span></span>
<span id="cb197-4"><a href="linking-widgets.html#cb197-4"></a>shared_arcs &lt;-<span class="st"> </span>SharedData<span class="op">$</span><span class="kw">new</span>(arcs, <span class="dt">key =</span> arcs<span class="op">$</span>i)</span></code></pre></div>
<p>This constraint would have to be documented and communicated to the users of the package as otherwise gio’s implementation of crosstalk will not work.</p>
<p>Were the constraint of having to specify the keys removed the gio package would have to interpret the keys. For instance, the widget would receive a selection, say <code>3</code> indicating that the third edge was selected in another widget, gio, not being able to highlight the edge, would have decide whether to highlight either the country where the edge comes from or the country where the edge goes to. Though this could be implemented it would be vastly more laborious and in fact be more limited as the choice of country to highlight would no longer up to the user.</p>
</div>
<div id="linking-widgets-r" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> R code</h2>
<p>In any event, let us start by making the required changes to the R code first. The only changes that need to be made are in the <code>gio</code> function as it is the only that currently accepts a dataframe and thus may receive a shared dataset.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="linking-widgets.html#cb198-1"></a><span class="kw">class</span>(shared_arcs)</span></code></pre></div>
<pre><code>## [1] &quot;SharedData&quot; &quot;R6&quot;</code></pre>
<p>Shared datasets are R6 classes and therefore cannot simply be treated as dataframes. The <code>gio</code> function needs to check whether the <code>data</code> object it received is a shared dataset with <code>is.SharedData</code> and if so use its methods to extract data from it, namely:</p>
<ul>
<li>The original dataset with <code>origData</code></li>
<li>The group to which the dataset belongs with <code>groupName</code></li>
<li>The keys that were assigned to every row of the dataset with <code>key</code></li>
</ul>
<p>The <code>origData</code> method is needed to extract original dataframe from the shared dataset. This is of course necessary as the <code>gio</code> function still needs to obtain and serialise the arcs to display on the globe.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="linking-widgets.html#cb200-1"></a><span class="co"># original data</span></span>
<span id="cb200-2"><a href="linking-widgets.html#cb200-2"></a>shared_arcs<span class="op">$</span><span class="kw">origData</span>()</span></code></pre></div>
<pre><code>##    e  i       v
## 1 CN US 3300000
## 2 CN RU   10000</code></pre>
<p>The <code>gio</code> function also has to extract the group to which the dataset belongs, this will be necessary JavaScript-side to tell crosstalk which group one is working with. Note that it was randomly generated since none were specified when the shared dataset was created.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="linking-widgets.html#cb202-1"></a><span class="co"># groupName</span></span>
<span id="cb202-2"><a href="linking-widgets.html#cb202-2"></a>shared_arcs<span class="op">$</span><span class="kw">groupName</span>()</span></code></pre></div>
<pre><code>## [1] &quot;SharedData3b6fe8eb&quot;</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="linking-widgets.html#cb204-1"></a><span class="co"># keys</span></span>
<span id="cb204-2"><a href="linking-widgets.html#cb204-2"></a>shared_arcs<span class="op">$</span><span class="kw">key</span>()</span></code></pre></div>
<pre><code>## [1] &quot;US&quot; &quot;RU&quot;</code></pre>
<p>The methods <code>origData</code> and <code>groupName</code> must be used in every widget, the <code>key</code> method may not be of use to every widget, it can be immensely useful if the visualisation library also comes with a key/id system so one can use it internally, gio.js does not and we thus will not be using it. The name of the group is passed to the <code>x</code> object so it is accessible JavaScript-side where it is needed, we also add the JavaScript dependency required to run crosstalk with <code>crosstalkLibs</code>.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="linking-widgets.html#cb206-1"></a>gio &lt;-<span class="st"> </span><span class="cf">function</span>(data, <span class="dt">width =</span> <span class="ot">NULL</span>, <span class="dt">height =</span> <span class="ot">NULL</span>, </span>
<span id="cb206-2"><a href="linking-widgets.html#cb206-2"></a>  <span class="dt">elementId =</span> <span class="ot">NULL</span>) {</span>
<span id="cb206-3"><a href="linking-widgets.html#cb206-3"></a></span>
<span id="cb206-4"><a href="linking-widgets.html#cb206-4"></a>  <span class="co"># defaults to NULL</span></span>
<span id="cb206-5"><a href="linking-widgets.html#cb206-5"></a>  group &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb206-6"><a href="linking-widgets.html#cb206-6"></a>  deps &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb206-7"><a href="linking-widgets.html#cb206-7"></a></span>
<span id="cb206-8"><a href="linking-widgets.html#cb206-8"></a>  <span class="co"># uses crosstalk</span></span>
<span id="cb206-9"><a href="linking-widgets.html#cb206-9"></a>  <span class="cf">if</span> (crosstalk<span class="op">::</span><span class="kw">is.SharedData</span>(data)) {</span>
<span id="cb206-10"><a href="linking-widgets.html#cb206-10"></a>    group &lt;-<span class="st"> </span>data<span class="op">$</span><span class="kw">groupName</span>()</span>
<span id="cb206-11"><a href="linking-widgets.html#cb206-11"></a>    data &lt;-<span class="st"> </span>data<span class="op">$</span><span class="kw">origData</span>()</span>
<span id="cb206-12"><a href="linking-widgets.html#cb206-12"></a>    deps &lt;-<span class="st"> </span>crosstalk<span class="op">::</span><span class="kw">crosstalkLibs</span>()</span>
<span id="cb206-13"><a href="linking-widgets.html#cb206-13"></a>  }</span>
<span id="cb206-14"><a href="linking-widgets.html#cb206-14"></a></span>
<span id="cb206-15"><a href="linking-widgets.html#cb206-15"></a>  <span class="co"># forward options using x</span></span>
<span id="cb206-16"><a href="linking-widgets.html#cb206-16"></a>  x =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb206-17"><a href="linking-widgets.html#cb206-17"></a>    <span class="dt">data =</span> data,</span>
<span id="cb206-18"><a href="linking-widgets.html#cb206-18"></a>    <span class="dt">style =</span> <span class="st">&quot;default&quot;</span>,</span>
<span id="cb206-19"><a href="linking-widgets.html#cb206-19"></a>    <span class="dt">crosstalk =</span> <span class="kw">list</span>(<span class="dt">group =</span> group) <span class="co"># pass group</span></span>
<span id="cb206-20"><a href="linking-widgets.html#cb206-20"></a>  )</span>
<span id="cb206-21"><a href="linking-widgets.html#cb206-21"></a></span>
<span id="cb206-22"><a href="linking-widgets.html#cb206-22"></a>  <span class="kw">attr</span>(x, <span class="st">&#39;TOJSON_ARGS&#39;</span>) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">dataframe =</span> <span class="st">&quot;rows&quot;</span>)</span>
<span id="cb206-23"><a href="linking-widgets.html#cb206-23"></a></span>
<span id="cb206-24"><a href="linking-widgets.html#cb206-24"></a>  <span class="co"># create widget</span></span>
<span id="cb206-25"><a href="linking-widgets.html#cb206-25"></a>  htmlwidgets<span class="op">::</span><span class="kw">createWidget</span>(</span>
<span id="cb206-26"><a href="linking-widgets.html#cb206-26"></a>    <span class="dt">name =</span> <span class="st">&#39;gio&#39;</span>,</span>
<span id="cb206-27"><a href="linking-widgets.html#cb206-27"></a>    x,</span>
<span id="cb206-28"><a href="linking-widgets.html#cb206-28"></a>    <span class="dt">width =</span> width,</span>
<span id="cb206-29"><a href="linking-widgets.html#cb206-29"></a>    <span class="dt">height =</span> height,</span>
<span id="cb206-30"><a href="linking-widgets.html#cb206-30"></a>    <span class="dt">package =</span> <span class="st">&#39;gio&#39;</span>,</span>
<span id="cb206-31"><a href="linking-widgets.html#cb206-31"></a>    <span class="dt">elementId =</span> elementId,</span>
<span id="cb206-32"><a href="linking-widgets.html#cb206-32"></a>    <span class="dt">sizingPolicy =</span> htmlwidgets<span class="op">::</span><span class="kw">sizingPolicy</span>(</span>
<span id="cb206-33"><a href="linking-widgets.html#cb206-33"></a>      <span class="dt">padding =</span> <span class="dv">0</span>,</span>
<span id="cb206-34"><a href="linking-widgets.html#cb206-34"></a>      <span class="dt">browser.fill =</span> <span class="ot">TRUE</span>,</span>
<span id="cb206-35"><a href="linking-widgets.html#cb206-35"></a>      <span class="dt">defaultWidth =</span> <span class="st">&quot;100%&quot;</span></span>
<span id="cb206-36"><a href="linking-widgets.html#cb206-36"></a>    ),</span>
<span id="cb206-37"><a href="linking-widgets.html#cb206-37"></a>    <span class="dt">preRenderHook =</span> render_gio,</span>
<span id="cb206-38"><a href="linking-widgets.html#cb206-38"></a>    <span class="co"># add crosstalk dependency</span></span>
<span id="cb206-39"><a href="linking-widgets.html#cb206-39"></a>    <span class="dt">dependencies =</span> deps</span>
<span id="cb206-40"><a href="linking-widgets.html#cb206-40"></a>  )</span>
<span id="cb206-41"><a href="linking-widgets.html#cb206-41"></a>}</span></code></pre></div>
</div>
<div id="linking-widgets-js" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> JavaScript code</h2>
<p>What is left to do is to adapt the JavaScript code, as a reminder it must accept the keys selected in other widgets and share the selected key with other widgets.</p>
<p>First we create the selection handler in the <code>factory</code> function, this is done by instantiating a new class from <code>crosstalk.SelectionHandle</code>.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb207-1"><a href="linking-widgets.html#cb207-1"></a><span class="kw">var</span> sel_handle <span class="op">=</span> <span class="kw">new</span> crosstalk<span class="op">.</span><span class="fu">SelectionHandle</span>()<span class="op">;</span></span></code></pre></div>
<p>Once the selection handle created it can be used in the <code>renderValue</code> function to set the group that was collected from R.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb208-1"><a href="linking-widgets.html#cb208-1"></a>sel_handle<span class="op">.</span><span class="fu">setGroup</span>(x<span class="op">.</span><span class="at">crosstalk</span><span class="op">.</span><span class="at">group</span>)<span class="op">;</span></span></code></pre></div>
<div id="linking-widgets-send-keys" class="section level3" number="9.6.1">
<h3><span class="header-section-number">9.6.1</span> Send Selected Keys</h3>
<p>In order for gio to share the selected country with other widgets it would first have to know which country is selected. This can be achieved with a callback function that gio supports.</p>
<p>Most JavaScript visualisation libraries will support callbacks or events that are triggered when the user interacts with the visualisation so one can have arbitrary code run when, for example, a user clicks a point on a scatter plot, or when the user clicks the legend of a chart. What these callback functions will be and how they work will entirely depend on the library at hand.</p>
<p>In gio.js this callback function is fired when a country is selected on the globe, it accepts two objects; one containing data on the country selected and another containing data on the related countries (the arcs coming and leaving the selected country).</p>
<p>The <a href="https://giojs.org/html/docs/callbackPicked.html">documentation of gio.js</a> gives the following example callback function.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb209-1"><a href="linking-widgets.html#cb209-1"></a><span class="co">// define callback function</span></span>
<span id="cb209-2"><a href="linking-widgets.html#cb209-2"></a><span class="kw">function</span> <span class="fu">callback</span> (selectedCountry<span class="op">,</span> relatedCountries) {</span>
<span id="cb209-3"><a href="linking-widgets.html#cb209-3"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(selectedCountry)<span class="op">;</span></span>
<span id="cb209-4"><a href="linking-widgets.html#cb209-4"></a>  <span class="co">// console.log(relatedCountries);</span></span>
<span id="cb209-5"><a href="linking-widgets.html#cb209-5"></a>}</span>
<span id="cb209-6"><a href="linking-widgets.html#cb209-6"></a></span>
<span id="cb209-7"><a href="linking-widgets.html#cb209-7"></a><span class="co">// use callback function</span></span>
<span id="cb209-8"><a href="linking-widgets.html#cb209-8"></a>controller<span class="op">.</span><span class="fu">onCountryPicked</span>(callback)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb210"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb210-1"><a href="linking-widgets.html#cb210-1"></a><span class="fu">{</span><span class="er">name</span><span class="fu">:</span> <span class="st">&quot;LIBYA&quot;</span><span class="fu">,</span> <span class="er">lat</span><span class="fu">:</span> <span class="dv">25</span><span class="fu">,</span> <span class="er">lon</span><span class="fu">:</span> <span class="dv">17</span><span class="fu">,</span> <span class="er">center</span><span class="fu">:</span> <span class="er">n</span><span class="fu">,</span> <span class="er">ISOCode</span><span class="fu">:</span> <span class="st">&quot;LY&quot;</span><span class="fu">}</span></span></code></pre></div>
<p>This defines a function named <code>callback</code> which takes the two aforementioned objects and logs them in the JavaScript console. Then the function is passed to the <code>controller</code> via the <code>onCountryPicked</code> method which will run it every time a country is selected by the user.</p>
<p>This callback function will be useful to send the <code>key</code>s to other widgets: when a user selects China send the <code>CN</code> key selection via crosstalk.</p>
<p>As mentioned at the beginning of this section, the keys used with the datasets for gio.js should be country ISO codes, therefore one can consider the variable <code>selectedCountry.ISOCode</code> as selected <code>key</code>. The <code>set</code> method from the selection handle can be used to share the selected key with other widgets. Note that this method expects either a <code>null</code> value or an array, a scalar value will throw an error, hence <code>selectedCountry.ISOCode</code> is wrapped in square brackets.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb211-1"><a href="linking-widgets.html#cb211-1"></a><span class="kw">function</span> <span class="fu">callback</span> (selectedCountry) {</span>
<span id="cb211-2"><a href="linking-widgets.html#cb211-2"></a>  sel_handle<span class="op">.</span><span class="fu">set</span>([selectedCountry<span class="op">.</span><span class="at">ISOCode</span>])<span class="op">;</span></span>
<span id="cb211-3"><a href="linking-widgets.html#cb211-3"></a>}</span>
<span id="cb211-4"><a href="linking-widgets.html#cb211-4"></a></span>
<span id="cb211-5"><a href="linking-widgets.html#cb211-5"></a>controller<span class="op">.</span><span class="fu">onCountryPicked</span>(callback)<span class="op">;</span></span></code></pre></div>
</div>
<div id="linking-widgets-set-keys" class="section level3" number="9.6.2">
<h3><span class="header-section-number">9.6.2</span> Set Selected Keys</h3>
<p>We have implemented the necessary to share the selected country with other widgets but are yet to implemented the opposite; when users select a country in another widget the selected country in gio should change too. Gio does provide a method called <code>switchCountry</code> to programmatically change the selected country.</p>
<p>This can be achieved by listening to the <code>change</code> event on the selection handle previously created, below it is used to log the object <code>e</code> in order to inspect its properties.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb212-1"><a href="linking-widgets.html#cb212-1"></a><span class="co">// placed in factory function</span></span>
<span id="cb212-2"><a href="linking-widgets.html#cb212-2"></a>sel_handle<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;change&quot;</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb212-3"><a href="linking-widgets.html#cb212-3"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(e)<span class="op">;</span></span>
<span id="cb212-4"><a href="linking-widgets.html#cb212-4"></a>})<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb213"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb213-1"><a href="linking-widgets.html#cb213-1"></a><span class="fu">{</span></span>
<span id="cb213-2"><a href="linking-widgets.html#cb213-2"></a>  <span class="er">oldValue</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb213-3"><a href="linking-widgets.html#cb213-3"></a>  <span class="er">sender</span><span class="fu">:</span> <span class="er">n</span> <span class="fu">{</span></span>
<span id="cb213-4"><a href="linking-widgets.html#cb213-4"></a>    <span class="er">_eventRelay</span><span class="fu">:</span> <span class="er">e</span><span class="fu">,</span> </span>
<span id="cb213-5"><a href="linking-widgets.html#cb213-5"></a>    <span class="er">_emitter</span><span class="fu">:</span> <span class="er">t</span><span class="fu">,</span> </span>
<span id="cb213-6"><a href="linking-widgets.html#cb213-6"></a>    <span class="er">_group</span><span class="fu">:</span> <span class="st">&quot;SharedDatac7682f87&quot;</span><span class="fu">,</span> </span>
<span id="cb213-7"><a href="linking-widgets.html#cb213-7"></a>    <span class="er">_var</span><span class="fu">:</span> <span class="er">r</span><span class="fu">,</span> </span>
<span id="cb213-8"><a href="linking-widgets.html#cb213-8"></a>    <span class="er">_varOnChangeSub</span><span class="fu">:</span> <span class="st">&quot;sub1&quot;</span><span class="fu">,</span> </span>
<span id="cb213-9"><a href="linking-widgets.html#cb213-9"></a>    <span class="er">…</span></span>
<span id="cb213-10"><a href="linking-widgets.html#cb213-10"></a>  <span class="fu">},</span></span>
<span id="cb213-11"><a href="linking-widgets.html#cb213-11"></a>  <span class="er">value</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;AE&quot;</span><span class="ot">]</span></span>
<span id="cb213-12"><a href="linking-widgets.html#cb213-12"></a><span class="fu">}</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li><code>oldValue</code> - the value that was previously selected (if any), this may be useful if the widget wants to calculate differences between the currently and previously selected value.</li>
<li><code>sender</code> - the selection handle instance that made the change. This is useful to compare against the selection handle of the widget and know whether the change in selection was initiated by this widget or another. It is often used to clear the selection or filtering before applying a new one when the change comes from another widget.</li>
<li><code>value</code> - the array of selected keys.</li>
</ol>
<p>Therefore event listener could make use of gio.js’ <code>switchCountry</code>. Note that 1) the selection cannot be cleared with gio.js, a country is always selected, and 2) one can only select one country a time, hence only accepting the first element of the selected keys with <code>e.value[0]</code>.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb214-1"><a href="linking-widgets.html#cb214-1"></a><span class="co">// placed in factory function</span></span>
<span id="cb214-2"><a href="linking-widgets.html#cb214-2"></a>sel_handle<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;change&quot;</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb214-3"><a href="linking-widgets.html#cb214-3"></a></span>
<span id="cb214-4"><a href="linking-widgets.html#cb214-4"></a>  <span class="co">// selection comes from another widget</span></span>
<span id="cb214-5"><a href="linking-widgets.html#cb214-5"></a>  <span class="cf">if</span> (e<span class="op">.</span><span class="at">sender</span> <span class="op">!==</span> sel_handle) {</span>
<span id="cb214-6"><a href="linking-widgets.html#cb214-6"></a>    <span class="co">// clear the selection</span></span>
<span id="cb214-7"><a href="linking-widgets.html#cb214-7"></a>    <span class="co">// not possible with gio.js</span></span>
<span id="cb214-8"><a href="linking-widgets.html#cb214-8"></a>  }</span>
<span id="cb214-9"><a href="linking-widgets.html#cb214-9"></a>  controller<span class="op">.</span><span class="fu">switchCountry</span>(e<span class="op">.</span><span class="at">value</span>[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb214-10"><a href="linking-widgets.html#cb214-10"></a>})<span class="op">;</span></span></code></pre></div>
</div>
<div id="linking-widgets-recap" class="section level3" number="9.6.3">
<h3><span class="header-section-number">9.6.3</span> Recap JavaScript Code</h3>
<p>To recapitulate, this is what the JavaScript code should not look like.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb215-1"><a href="linking-widgets.html#cb215-1"></a>HTMLWidgets<span class="op">.</span><span class="fu">widget</span>({</span>
<span id="cb215-2"><a href="linking-widgets.html#cb215-2"></a></span>
<span id="cb215-3"><a href="linking-widgets.html#cb215-3"></a>  <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;gio&#39;</span><span class="op">,</span></span>
<span id="cb215-4"><a href="linking-widgets.html#cb215-4"></a></span>
<span id="cb215-5"><a href="linking-widgets.html#cb215-5"></a>  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;output&#39;</span><span class="op">,</span></span>
<span id="cb215-6"><a href="linking-widgets.html#cb215-6"></a></span>
<span id="cb215-7"><a href="linking-widgets.html#cb215-7"></a>  <span class="dt">factory</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> width<span class="op">,</span> height) {</span>
<span id="cb215-8"><a href="linking-widgets.html#cb215-8"></a></span>
<span id="cb215-9"><a href="linking-widgets.html#cb215-9"></a>    <span class="co">// </span><span class="al">TODO</span><span class="co">: define shared variables for this instance</span></span>
<span id="cb215-10"><a href="linking-widgets.html#cb215-10"></a>    <span class="kw">var</span> controller<span class="op">;</span></span>
<span id="cb215-11"><a href="linking-widgets.html#cb215-11"></a></span>
<span id="cb215-12"><a href="linking-widgets.html#cb215-12"></a>    <span class="co">// create selection handle</span></span>
<span id="cb215-13"><a href="linking-widgets.html#cb215-13"></a>    <span class="kw">var</span> sel_handle <span class="op">=</span> <span class="kw">new</span> crosstalk<span class="op">.</span><span class="fu">SelectionHandle</span>()<span class="op">;</span></span>
<span id="cb215-14"><a href="linking-widgets.html#cb215-14"></a></span>
<span id="cb215-15"><a href="linking-widgets.html#cb215-15"></a>    <span class="co">// listen to change</span></span>
<span id="cb215-16"><a href="linking-widgets.html#cb215-16"></a>    sel_handle<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;change&quot;</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb215-17"><a href="linking-widgets.html#cb215-17"></a>      <span class="cf">if</span> (e<span class="op">.</span><span class="at">sender</span> <span class="op">!==</span> sel_handle) {</span>
<span id="cb215-18"><a href="linking-widgets.html#cb215-18"></a>        <span class="co">// clear selection</span></span>
<span id="cb215-19"><a href="linking-widgets.html#cb215-19"></a>      }</span>
<span id="cb215-20"><a href="linking-widgets.html#cb215-20"></a>      controller<span class="op">.</span><span class="fu">switchCountry</span>(e<span class="op">.</span><span class="at">value</span>[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb215-21"><a href="linking-widgets.html#cb215-21"></a>    })<span class="op">;</span></span>
<span id="cb215-22"><a href="linking-widgets.html#cb215-22"></a></span>
<span id="cb215-23"><a href="linking-widgets.html#cb215-23"></a></span>
<span id="cb215-24"><a href="linking-widgets.html#cb215-24"></a>    <span class="cf">return</span> {</span>
<span id="cb215-25"><a href="linking-widgets.html#cb215-25"></a></span>
<span id="cb215-26"><a href="linking-widgets.html#cb215-26"></a>      <span class="dt">renderValue</span><span class="op">:</span> <span class="kw">function</span>(x) {</span>
<span id="cb215-27"><a href="linking-widgets.html#cb215-27"></a></span>
<span id="cb215-28"><a href="linking-widgets.html#cb215-28"></a>        controller <span class="op">=</span> <span class="kw">new</span> GIO<span class="op">.</span><span class="fu">Controller</span>(el)<span class="op">;</span></span>
<span id="cb215-29"><a href="linking-widgets.html#cb215-29"></a></span>
<span id="cb215-30"><a href="linking-widgets.html#cb215-30"></a>        <span class="co">// group</span></span>
<span id="cb215-31"><a href="linking-widgets.html#cb215-31"></a>        sel_handle<span class="op">.</span><span class="fu">setGroup</span>(x<span class="op">.</span><span class="at">crosstalk</span><span class="op">.</span><span class="at">group</span>)<span class="op">;</span></span>
<span id="cb215-32"><a href="linking-widgets.html#cb215-32"></a>        </span>
<span id="cb215-33"><a href="linking-widgets.html#cb215-33"></a>        <span class="co">// add data</span></span>
<span id="cb215-34"><a href="linking-widgets.html#cb215-34"></a>        controller<span class="op">.</span><span class="fu">addData</span>(x<span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb215-35"><a href="linking-widgets.html#cb215-35"></a></span>
<span id="cb215-36"><a href="linking-widgets.html#cb215-36"></a>        controller<span class="op">.</span><span class="fu">setStyle</span>(x<span class="op">.</span><span class="at">style</span>)<span class="op">;</span></span>
<span id="cb215-37"><a href="linking-widgets.html#cb215-37"></a></span>
<span id="cb215-38"><a href="linking-widgets.html#cb215-38"></a>        <span class="co">// callback</span></span>
<span id="cb215-39"><a href="linking-widgets.html#cb215-39"></a>        <span class="kw">function</span> callback (selectedCountry<span class="op">,</span> relatedCountries) {</span>
<span id="cb215-40"><a href="linking-widgets.html#cb215-40"></a>          sel_handle<span class="op">.</span><span class="fu">set</span>([selectedCountry<span class="op">.</span><span class="at">ISOCode</span>])<span class="op">;</span> <span class="co">// send keys</span></span>
<span id="cb215-41"><a href="linking-widgets.html#cb215-41"></a>        }</span>
<span id="cb215-42"><a href="linking-widgets.html#cb215-42"></a></span>
<span id="cb215-43"><a href="linking-widgets.html#cb215-43"></a>        controller<span class="op">.</span><span class="fu">onCountryPicked</span>(callback)<span class="op">;</span></span>
<span id="cb215-44"><a href="linking-widgets.html#cb215-44"></a></span>
<span id="cb215-45"><a href="linking-widgets.html#cb215-45"></a>        <span class="co">// use stats</span></span>
<span id="cb215-46"><a href="linking-widgets.html#cb215-46"></a>        <span class="cf">if</span>(x<span class="op">.</span><span class="at">stats</span>)</span>
<span id="cb215-47"><a href="linking-widgets.html#cb215-47"></a>          controller<span class="op">.</span><span class="fu">enableStats</span>()<span class="op">;</span></span>
<span id="cb215-48"><a href="linking-widgets.html#cb215-48"></a></span>
<span id="cb215-49"><a href="linking-widgets.html#cb215-49"></a>        <span class="co">// render</span></span>
<span id="cb215-50"><a href="linking-widgets.html#cb215-50"></a>        controller<span class="op">.</span><span class="fu">init</span>()<span class="op">;</span></span>
<span id="cb215-51"><a href="linking-widgets.html#cb215-51"></a></span>
<span id="cb215-52"><a href="linking-widgets.html#cb215-52"></a>      }<span class="op">,</span></span>
<span id="cb215-53"><a href="linking-widgets.html#cb215-53"></a></span>
<span id="cb215-54"><a href="linking-widgets.html#cb215-54"></a>      <span class="dt">resize</span><span class="op">:</span> <span class="kw">function</span>(width<span class="op">,</span> height) {</span>
<span id="cb215-55"><a href="linking-widgets.html#cb215-55"></a>        controller<span class="op">.</span><span class="fu">resizeUpdate</span>()<span class="op">;</span></span>
<span id="cb215-56"><a href="linking-widgets.html#cb215-56"></a>      }<span class="op">,</span></span>
<span id="cb215-57"><a href="linking-widgets.html#cb215-57"></a></span>
<span id="cb215-58"><a href="linking-widgets.html#cb215-58"></a>    }<span class="op">;</span></span>
<span id="cb215-59"><a href="linking-widgets.html#cb215-59"></a>  }</span>
<span id="cb215-60"><a href="linking-widgets.html#cb215-60"></a>})<span class="op">;</span></span></code></pre></div>
</div>
</div>
<div id="linking-widgets-using" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> Using Crosstalk with Gio</h2>
<p>Finally, now that gio supports shared dataset we can create a few examples to demonstrate how it can be used.</p>
<p>The simplest way is probably to convert the edges to a shared dataset specifying either the source (<code>i</code>) or target (<code>e</code>) country codes as keys. However this is unlikely to be used this way out in the real world. In the example below selecting an edge highlights a node which is somewhat confusing.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="linking-widgets.html#cb216-1"></a><span class="kw">library</span>(DT)</span>
<span id="cb216-2"><a href="linking-widgets.html#cb216-2"></a><span class="kw">library</span>(gio)</span>
<span id="cb216-3"><a href="linking-widgets.html#cb216-3"></a><span class="kw">library</span>(crosstalk)</span>
<span id="cb216-4"><a href="linking-widgets.html#cb216-4"></a></span>
<span id="cb216-5"><a href="linking-widgets.html#cb216-5"></a>url &lt;-<span class="st"> </span><span class="kw">paste0</span>(</span>
<span id="cb216-6"><a href="linking-widgets.html#cb216-6"></a>  <span class="st">&quot;https://raw.githubusercontent.com/JohnCoene/&quot;</span>,</span>
<span id="cb216-7"><a href="linking-widgets.html#cb216-7"></a>  <span class="st">&quot;javascript-for-r/master/data/countries.json&quot;</span></span>
<span id="cb216-8"><a href="linking-widgets.html#cb216-8"></a>)</span>
<span id="cb216-9"><a href="linking-widgets.html#cb216-9"></a>arcs &lt;-<span class="st"> </span>jsonlite<span class="op">::</span><span class="kw">fromJSON</span>(url)</span>
<span id="cb216-10"><a href="linking-widgets.html#cb216-10"></a></span>
<span id="cb216-11"><a href="linking-widgets.html#cb216-11"></a><span class="co"># Wrap data frame in SharedData</span></span>
<span id="cb216-12"><a href="linking-widgets.html#cb216-12"></a><span class="co"># key is importing country</span></span>
<span id="cb216-13"><a href="linking-widgets.html#cb216-13"></a>sd &lt;-<span class="st"> </span>SharedData<span class="op">$</span><span class="kw">new</span>(arcs, <span class="dt">key =</span> arcs<span class="op">$</span>i)</span>
<span id="cb216-14"><a href="linking-widgets.html#cb216-14"></a></span>
<span id="cb216-15"><a href="linking-widgets.html#cb216-15"></a><span class="kw">bscols</span>(</span>
<span id="cb216-16"><a href="linking-widgets.html#cb216-16"></a>  <span class="kw">gio</span>(sd),</span>
<span id="cb216-17"><a href="linking-widgets.html#cb216-17"></a>  <span class="kw">datatable</span>(sd, <span class="dt">width=</span><span class="st">&quot;100%&quot;</span>, <span class="dt">selection =</span> <span class="st">&quot;single&quot;</span>)</span>
<span id="cb216-18"><a href="linking-widgets.html#cb216-18"></a>)</span></code></pre></div>
<div class="figure">
<img src="images/crosstalk-gio-1.png" alt="" />
<p class="caption">Gio with DT using crosstalk</p>
</div>
<p>Thankfully we can use the <code>group</code> argument in order to create edges and nodes that share keys and produce a more sensible link between widgets.</p>
<div id="htmlwidget-f29e65f300c1d0805c48" style="width:100%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-f29e65f300c1d0805c48">{"x":{"diagram":"\ndigraph {\n\n  graph[rankdir = TB]\n\n  subgraph cluster_0 {\n    label=\"sharedGroup\"\n    node [shape=record fontsize=10];\n    edges_sd nodes_sd\n    keys [color=royalBlue]\n    color=dimGray\n  }\n\n  node [shape=record fontsize=10 color=gold];\n  gio plotly\n\n  edges_sd -> keys [arrowsize=.5];\n  nodes_sd -> keys [arrowsize=.5];\n\n  gio -> keys [dir=both arrowsize=.5];\n  plotly -> keys [dir=both arrowsize=.5 constraint=false];\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Below we create two shared datasets with the same group name, one for the edges and another for the nodes and use one for the gio visualisation and the other for the plotly graph.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="linking-widgets.html#cb217-1"></a><span class="kw">library</span>(gio)</span>
<span id="cb217-2"><a href="linking-widgets.html#cb217-2"></a><span class="kw">library</span>(plotly)</span>
<span id="cb217-3"><a href="linking-widgets.html#cb217-3"></a><span class="kw">library</span>(crosstalk)</span>
<span id="cb217-4"><a href="linking-widgets.html#cb217-4"></a></span>
<span id="cb217-5"><a href="linking-widgets.html#cb217-5"></a>url &lt;-<span class="st"> </span><span class="kw">paste0</span>(</span>
<span id="cb217-6"><a href="linking-widgets.html#cb217-6"></a>  <span class="st">&quot;https://raw.githubusercontent.com/JohnCoene/&quot;</span>,</span>
<span id="cb217-7"><a href="linking-widgets.html#cb217-7"></a>  <span class="st">&quot;javascript-for-r/master/data/countries.json&quot;</span></span>
<span id="cb217-8"><a href="linking-widgets.html#cb217-8"></a>)</span>
<span id="cb217-9"><a href="linking-widgets.html#cb217-9"></a>arcs &lt;-<span class="st"> </span>jsonlite<span class="op">::</span><span class="kw">fromJSON</span>(url)</span>
<span id="cb217-10"><a href="linking-widgets.html#cb217-10"></a></span>
<span id="cb217-11"><a href="linking-widgets.html#cb217-11"></a><span class="co"># Wrap data frame in SharedData</span></span>
<span id="cb217-12"><a href="linking-widgets.html#cb217-12"></a>edges_sd &lt;-<span class="st"> </span>SharedData<span class="op">$</span><span class="kw">new</span>(arcs, <span class="dt">key =</span> arcs<span class="op">$</span>i, <span class="dt">group =</span> <span class="st">&quot;sharedGroup&quot;</span>)</span>
<span id="cb217-13"><a href="linking-widgets.html#cb217-13"></a></span>
<span id="cb217-14"><a href="linking-widgets.html#cb217-14"></a><span class="co"># create nodes</span></span>
<span id="cb217-15"><a href="linking-widgets.html#cb217-15"></a>iso2c &lt;-<span class="st"> </span><span class="kw">unique</span>(arcs<span class="op">$</span>i)</span>
<span id="cb217-16"><a href="linking-widgets.html#cb217-16"></a>nodes &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb217-17"><a href="linking-widgets.html#cb217-17"></a>  <span class="dt">country =</span> iso2c,</span>
<span id="cb217-18"><a href="linking-widgets.html#cb217-18"></a>  <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="kw">length</span>(iso2c))</span>
<span id="cb217-19"><a href="linking-widgets.html#cb217-19"></a>)</span>
<span id="cb217-20"><a href="linking-widgets.html#cb217-20"></a>nodes_sd &lt;-<span class="st"> </span>SharedData<span class="op">$</span><span class="kw">new</span>(</span>
<span id="cb217-21"><a href="linking-widgets.html#cb217-21"></a>  nodes, <span class="dt">key =</span> nodes<span class="op">$</span>country, </span>
<span id="cb217-22"><a href="linking-widgets.html#cb217-22"></a>  <span class="dt">group =</span> <span class="st">&quot;sharedGroup&quot;</span></span>
<span id="cb217-23"><a href="linking-widgets.html#cb217-23"></a>)</span>
<span id="cb217-24"><a href="linking-widgets.html#cb217-24"></a></span>
<span id="cb217-25"><a href="linking-widgets.html#cb217-25"></a><span class="kw">bscols</span>(</span>
<span id="cb217-26"><a href="linking-widgets.html#cb217-26"></a>  <span class="kw">plot_ly</span>(<span class="dt">data =</span> nodes_sd, <span class="dt">type =</span> <span class="st">&quot;bar&quot;</span>, <span class="dt">x =</span> <span class="op">~</span>country, <span class="dt">y =</span> <span class="op">~</span>y) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb217-27"><a href="linking-widgets.html#cb217-27"></a><span class="st">    </span><span class="kw">config</span>(<span class="dt">displayModeBar =</span> <span class="ot">FALSE</span>),</span>
<span id="cb217-28"><a href="linking-widgets.html#cb217-28"></a>  <span class="kw">gio</span>(edges_sd)</span>
<span id="cb217-29"><a href="linking-widgets.html#cb217-29"></a>)</span></code></pre></div>
<div class="figure">
<img src="images/crosstalk-gio-2.png" alt="" />
<p class="caption">Gio plotly using crosstalk and groups</p>
</div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-crosstalk">
<p>Cheng, Joe. 2020. <em>Crosstalk: Inter-Widget Interactivity for Html Widgets</em>. <a href="https://CRAN.R-project.org/package=crosstalk">https://CRAN.R-project.org/package=crosstalk</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="widgets-adv.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="widgets-final.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/JohnCoene/javascript-for-r/edit/master/3-26-htmlwidgets-crosstalk.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
