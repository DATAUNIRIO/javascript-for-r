<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 Working with Shiny | JavaScript for R</title>
  <meta name="description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 Working with Shiny | JavaScript for R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Invite JavaScript into your Data Science workflow." />
  <meta name="github-repo" content="yihui/bookdown-crc" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 Working with Shiny | JavaScript for R" />
  
  <meta name="twitter:description" content="Invite JavaScript into your Data Science workflow." />
  

<meta name="author" content="John Coene" />


<meta name="date" content="2020-07-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="advanced-topics.html"/>
<link rel="next" href="ploty.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block/empty-anchor.js"></script>
<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>
<script src="libs/core-js/shim.min.js"></script>
<script src="libs/react/react.min.js"></script>
<script src="libs/react/react-dom.min.js"></script>
<script src="libs/reactwidget/react-tools.js"></script>
<script src="libs/reactable-binding/reactable.js"></script>
<script src="libs/r2d3-render/r2d3-render.js"></script>
<script src="libs/webcomponents/webcomponents.js"></script>
<script src="libs/r2d3-binding/r2d3.js"></script>
<script src="libs/d3v5/d3.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">JavaScript for R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#premise"><i class="fa fa-check"></i>Premise</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-structure"><i class="fa fa-check"></i>Book Structure</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i>Disclaimer</a></li>
</ul></li>
<li class="part"><span><b>I Basics &amp; Roadmap</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#rationale"><i class="fa fa-check"></i>Rationale</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#basics"><i class="fa fa-check"></i>Basics</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#package-development"><i class="fa fa-check"></i>Package Development</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#json"><i class="fa fa-check"></i>JSON</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#javascript"><i class="fa fa-check"></i>JavaScript</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#methods"><i class="fa fa-check"></i>Methods</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#v8"><i class="fa fa-check"></i>V8</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#htmlwidgets"><i class="fa fa-check"></i>htmlwidgets</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#shiny"><i class="fa fa-check"></i>Shiny</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#bubble"><i class="fa fa-check"></i>bubble</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#methods-amiss"><i class="fa fa-check"></i>Methods Amiss</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#reactr"><i class="fa fa-check"></i>reactR</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#r2d3"><i class="fa fa-check"></i>r2d3</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II JavaScript for Computations</b></span></li>
<li class="chapter" data-level="2" data-path="the-v8-engine.html"><a href="the-v8-engine.html"><i class="fa fa-check"></i><b>2</b> The V8 Engine</a>
<ul>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#installation"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#basics-1"><i class="fa fa-check"></i>Basics</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#external-libraries"><i class="fa fa-check"></i>External Libraries</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#with-npm"><i class="fa fa-check"></i>With Npm</a></li>
<li class="chapter" data-level="" data-path="the-v8-engine.html"><a href="the-v8-engine.html#use-in-packages"><i class="fa fa-check"></i>Use in Packages</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="node.html"><a href="node.html"><i class="fa fa-check"></i><b>3</b> Node.js with Bubble</a>
<ul>
<li class="chapter" data-level="" data-path="node.html"><a href="node.html#basics-2"><i class="fa fa-check"></i>Basics</a></li>
<li class="chapter" data-level="" data-path="node.html"><a href="node.html#r-markdown-engine"><i class="fa fa-check"></i>R Markdown Engine</a></li>
<li class="chapter" data-level="" data-path="node.html"><a href="node.html#npm"><i class="fa fa-check"></i>Npm</a></li>
</ul></li>
<li class="part"><span><b>III Web Development with Shiny</b></span></li>
<li class="chapter" data-level="4" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>4</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction-1.html"><a href="introduction-1.html#static-files"><i class="fa fa-check"></i>Static Files</a></li>
<li class="chapter" data-level="" data-path="introduction-1.html"><a href="introduction-1.html#example---alerts"><i class="fa fa-check"></i>Example - Alerts</a></li>
<li class="chapter" data-level="" data-path="introduction-1.html"><a href="introduction-1.html#from-r-to-javascript"><i class="fa fa-check"></i>From R to JavaScript</a></li>
<li class="chapter" data-level="" data-path="introduction-1.html"><a href="introduction-1.html#from-javascript-to-r"><i class="fa fa-check"></i>From JavaScript to R</a></li>
<li class="chapter" data-level="" data-path="introduction-1.html"><a href="introduction-1.html#deserialise"><i class="fa fa-check"></i>Deserialise</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-complete-integration.html"><a href="a-complete-integration.html"><i class="fa fa-check"></i><b>5</b> A Complete Integration</a>
<ul>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#serialisation"><i class="fa fa-check"></i>Serialisation</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#events-callbacks"><i class="fa fa-check"></i>Events &amp; Callbacks</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#as-a-package"><i class="fa fa-check"></i>As a Package</a>
<ul>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#dependencies"><i class="fa fa-check"></i>Dependencies</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#r-code"><i class="fa fa-check"></i>R Code</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#javascript-code"><i class="fa fa-check"></i>JavaScript Code</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#input-handler"><i class="fa fa-check"></i>Input Handler</a></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#wrapping-up"><i class="fa fa-check"></i>Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="a-complete-integration.html"><a href="a-complete-integration.html#exercises"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tips-tricks.html"><a href="tips-tricks.html"><i class="fa fa-check"></i><b>6</b> Tips &amp; Tricks</a>
<ul>
<li class="chapter" data-level="" data-path="tips-tricks.html"><a href="tips-tricks.html#events"><i class="fa fa-check"></i>Events</a></li>
<li class="chapter" data-level="" data-path="tips-tricks.html"><a href="tips-tricks.html#table-buttons"><i class="fa fa-check"></i>Table Buttons</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="custom-outputs.html"><a href="custom-outputs.html"><i class="fa fa-check"></i><b>7</b> Custom Outputs</a>
<ul>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#inner-workings"><i class="fa fa-check"></i>Inner-workings</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#discover-lena.js"><i class="fa fa-check"></i>Discover Lena.js</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#setup"><i class="fa fa-check"></i>Setup</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#output"><i class="fa fa-check"></i>Output</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#render"><i class="fa fa-check"></i>Render</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#javascript-binding"><i class="fa fa-check"></i>JavaScript Binding</a></li>
<li class="chapter" data-level="" data-path="custom-outputs.html"><a href="custom-outputs.html#test"><i class="fa fa-check"></i>Test</a></li>
</ul></li>
<li class="part"><span><b>IV Data Visualisation</b></span></li>
<li class="chapter" data-level="8" data-path="introduction-2.html"><a href="introduction-2.html"><i class="fa fa-check"></i><b>8</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction-2.html"><a href="introduction-2.html#candidate-libraries"><i class="fa fa-check"></i>Candidate Libraries</a>
<ul>
<li class="chapter" data-level="" data-path="introduction-2.html"><a href="introduction-2.html#plotly"><i class="fa fa-check"></i>Plotly</a></li>
<li class="chapter" data-level="" data-path="introduction-2.html"><a href="introduction-2.html#highchart.js"><i class="fa fa-check"></i>Highchart.js</a></li>
<li class="chapter" data-level="" data-path="introduction-2.html"><a href="introduction-2.html#chart.js"><i class="fa fa-check"></i>Chart.js</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction-2.html"><a href="introduction-2.html#how-it-works"><i class="fa fa-check"></i>How it works</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="your-first-widget.html"><a href="your-first-widget.html"><i class="fa fa-check"></i><b>9</b> Your First Widget</a>
<ul>
<li class="chapter" data-level="" data-path="your-first-widget.html"><a href="your-first-widget.html#the-scaffold"><i class="fa fa-check"></i>The Scaffold</a></li>
<li class="chapter" data-level="" data-path="your-first-widget.html"><a href="your-first-widget.html#the-output"><i class="fa fa-check"></i>The Output</a></li>
<li class="chapter" data-level="" data-path="your-first-widget.html"><a href="your-first-widget.html#javascript-side"><i class="fa fa-check"></i>JavaScript-side</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="a-realistic-widget.html"><a href="a-realistic-widget.html"><i class="fa fa-check"></i><b>10</b> A Realistic Widget</a>
<ul>
<li class="chapter" data-level="" data-path="a-realistic-widget.html"><a href="a-realistic-widget.html#dependency"><i class="fa fa-check"></i>Dependency</a></li>
<li class="chapter" data-level="" data-path="a-realistic-widget.html"><a href="a-realistic-widget.html#javascript-1"><i class="fa fa-check"></i>JavaScript</a></li>
<li class="chapter" data-level="" data-path="a-realistic-widget.html"><a href="a-realistic-widget.html#html-element"><i class="fa fa-check"></i>HTML Element</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="the-full-monty.html"><a href="the-full-monty.html"><i class="fa fa-check"></i><b>11</b> The Full Monty</a>
<ul>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#dependencies-1"><i class="fa fa-check"></i>Dependencies</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#javascript-2"><i class="fa fa-check"></i>JavaScript</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#working-with-data"><i class="fa fa-check"></i>Working with Data</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#transforming-data"><i class="fa fa-check"></i>Transforming Data</a>
<ul>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#in-javascript"><i class="fa fa-check"></i>In JavaScript</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#in-r"><i class="fa fa-check"></i>In R</a></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#pros-cons"><i class="fa fa-check"></i>Pros &amp; Cons</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-full-monty.html"><a href="the-full-monty.html#on-print"><i class="fa fa-check"></i>On Print</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="advanced-topics.html"><a href="advanced-topics.html"><i class="fa fa-check"></i><b>12</b> Advanced Topics</a>
<ul>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#shared-variables"><i class="fa fa-check"></i>Shared Variables</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#sizing"><i class="fa fa-check"></i>Sizing</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#sizing-policy"><i class="fa fa-check"></i>Sizing Policy</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#resizing"><i class="fa fa-check"></i>Resizing</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#pre-render-hooks-security"><i class="fa fa-check"></i>Pre Render Hooks &amp; Security</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#javascript-code-1"><i class="fa fa-check"></i>JavaScript Code</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#prepend-append-content"><i class="fa fa-check"></i>Prepend &amp; Append Content</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#dependencies-2"><i class="fa fa-check"></i>Dependencies</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#compatibility"><i class="fa fa-check"></i>Compatibility</a></li>
<li class="chapter" data-level="" data-path="advanced-topics.html"><a href="advanced-topics.html#unit-tests"><i class="fa fa-check"></i>Unit Tests</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="working-with-shiny.html"><a href="working-with-shiny.html"><i class="fa fa-check"></i><b>13</b> Working with Shiny</a>
<ul>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#javascript-to-r"><i class="fa fa-check"></i>JavaScript to R</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#input-handler-1"><i class="fa fa-check"></i>Input Handler</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#r-to-javascript"><i class="fa fa-check"></i>R to JavaScript</a>
<ul>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#send-data"><i class="fa fa-check"></i>Send Data</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#retrieve-widget-instance"><i class="fa fa-check"></i>Retrieve Widget Instance</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#handle-data"><i class="fa fa-check"></i>Handle Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#proxy-function"><i class="fa fa-check"></i>Proxy Function</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#clear-data"><i class="fa fa-check"></i>Clear Data</a></li>
<li class="chapter" data-level="" data-path="working-with-shiny.html"><a href="working-with-shiny.html#update"><i class="fa fa-check"></i>Update</a></li>
</ul></li>
<li class="part"><span><b>V Examples</b></span></li>
<li class="chapter" data-level="14" data-path="ploty.html"><a href="ploty.html"><i class="fa fa-check"></i><b>14</b> Ploty</a>
<ul>
<li class="chapter" data-level="" data-path="ploty.html"><a href="ploty.html#discover"><i class="fa fa-check"></i>Discover</a></li>
<li class="chapter" data-level="" data-path="ploty.html"><a href="ploty.html#basics-3"><i class="fa fa-check"></i>Basics</a></li>
<li class="chapter" data-level="" data-path="ploty.html"><a href="ploty.html#javascript-to-r-1"><i class="fa fa-check"></i>JavaScript to R</a></li>
<li class="chapter" data-level="" data-path="ploty.html"><a href="ploty.html#r-to-javascript-1"><i class="fa fa-check"></i>R to JavaScript</a></li>
<li class="chapter" data-level="" data-path="ploty.html"><a href="ploty.html#size-resize"><i class="fa fa-check"></i>Size &amp; Resize</a></li>
<li class="chapter" data-level="" data-path="ploty.html"><a href="ploty.html#performance-security"><i class="fa fa-check"></i>Performance &amp; Security</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="image-classifier.html"><a href="image-classifier.html"><i class="fa fa-check"></i><b>15</b> Image Classifier</a>
<ul>
<li class="chapter" data-level="" data-path="image-classifier.html"><a href="image-classifier.html#discover-1"><i class="fa fa-check"></i>Discover</a></li>
<li class="chapter" data-level="" data-path="image-classifier.html"><a href="image-classifier.html#setup-1"><i class="fa fa-check"></i>Setup</a></li>
<li class="chapter" data-level="" data-path="image-classifier.html"><a href="image-classifier.html#javascript-3"><i class="fa fa-check"></i>JavaScript</a></li>
<li class="chapter" data-level="" data-path="image-classifier.html"><a href="image-classifier.html#input-handler-2"><i class="fa fa-check"></i>Input Handler</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="progress-bar.html"><a href="progress-bar.html"><i class="fa fa-check"></i><b>16</b> Progress Bar</a>
<ul>
<li class="chapter" data-level="" data-path="progress-bar.html"><a href="progress-bar.html#r-code-1"><i class="fa fa-check"></i>R code</a></li>
<li class="chapter" data-level="" data-path="progress-bar.html"><a href="progress-bar.html#javascript-code-2"><i class="fa fa-check"></i>JavaScript code</a></li>
<li class="chapter" data-level="" data-path="progress-bar.html"><a href="progress-bar.html#events-1"><i class="fa fa-check"></i>Events</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="math-evaluator.html"><a href="math-evaluator.html"><i class="fa fa-check"></i><b>17</b> Math Evaluator</a></li>
<li class="chapter" data-level="18" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>18</b> Machine Learning</a>
<ul>
<li class="chapter" data-level="" data-path="machine-learning.html"><a href="machine-learning.html#dependency-1"><i class="fa fa-check"></i>Dependency</a></li>
<li class="chapter" data-level="" data-path="machine-learning.html"><a href="machine-learning.html#simple-regression"><i class="fa fa-check"></i>Simple Regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">JavaScript for R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="working-with-shiny" class="section level1" number="13">
<h1><span class="header-section-number">Chapter 13</span> Working with Shiny</h1>
<p>A previous set of chapters explored how to make JavaScript and R communicate in shiny applications by passing data from the server to the client and back. This chapter explores how to apply that to htmlwidgets so they can provide additional functionalities when used in Shiny applications.</p>
<p>To demonstrate how to integrate these functionalities in widgets we shall implement them in the previously built gio package.</p>
<div id="javascript-to-r" class="section level2 unnumbered" number="">
<h2>JavaScript to R</h2>
<p>JavaScript visualisation libraries will often include callbacks or events that are triggered when the user interacts with the visualisation so one can have arbitrary code run when, for example, a user clicks a point on a scatter plot, or when the user clicks the legend of a chart. Gio.js provides a callback that is fired when a country is selected on the globe, this callback function accepts two objects, one containing data on the country selected and another containing data on the related countries (the arcs coming and leaving the selected country). This could be used to send that data back to the R server where it could be used from many things like fetching more data on the selected country from a database, or use that information to generate a shiny UI element.</p>
<p>The <a href="https://giojs.org/html/docs/callbackPicked.html">documentation of gio.js</a> gives the following example callback function.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb310-1"><a href="working-with-shiny.html#cb310-1"></a><span class="co">// define callback function</span></span>
<span id="cb310-2"><a href="working-with-shiny.html#cb310-2"></a><span class="kw">function</span> <span class="fu">callback</span> (selectedCountry<span class="op">,</span> relatedCountries) {</span>
<span id="cb310-3"><a href="working-with-shiny.html#cb310-3"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(selectedCountry)<span class="op">;</span></span>
<span id="cb310-4"><a href="working-with-shiny.html#cb310-4"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(relatedCountries)<span class="op">;</span></span>
<span id="cb310-5"><a href="working-with-shiny.html#cb310-5"></a>}</span>
<span id="cb310-6"><a href="working-with-shiny.html#cb310-6"></a></span>
<span id="cb310-7"><a href="working-with-shiny.html#cb310-7"></a><span class="co">// use callback function</span></span>
<span id="cb310-8"><a href="working-with-shiny.html#cb310-8"></a>controller<span class="op">.</span><span class="fu">onCountryPicked</span>(callback)<span class="op">;</span></span></code></pre></div>
<p>This defines a function named <code>callback</code> which takes the two aforementioned objects and logs them in the JavaScript console. Then the function is passed to the <code>controller</code> which will run it every time a country is picked. This can be incorporated into the widget. Instead of logging the data in the console it is used to define two different shiny inputs. Note the use of the widget identifier to define the input name.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb311-1"><a href="working-with-shiny.html#cb311-1"></a><span class="op">...</span></span>
<span id="cb311-2"><a href="working-with-shiny.html#cb311-2"></a>renderValue<span class="op">:</span> <span class="kw">function</span>(x) {</span>
<span id="cb311-3"><a href="working-with-shiny.html#cb311-3"></a></span>
<span id="cb311-4"><a href="working-with-shiny.html#cb311-4"></a>  <span class="kw">var</span> container <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(el<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb311-5"><a href="working-with-shiny.html#cb311-5"></a>  <span class="kw">var</span> controller <span class="op">=</span> <span class="kw">new</span> GIO<span class="op">.</span><span class="fu">Controller</span>(container)<span class="op">;</span></span>
<span id="cb311-6"><a href="working-with-shiny.html#cb311-6"></a>  controller<span class="op">.</span><span class="fu">addData</span>(x<span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb311-7"><a href="working-with-shiny.html#cb311-7"></a>  controller<span class="op">.</span><span class="fu">setStyle</span>(x<span class="op">.</span><span class="at">style</span>)<span class="op">;</span></span>
<span id="cb311-8"><a href="working-with-shiny.html#cb311-8"></a></span>
<span id="cb311-9"><a href="working-with-shiny.html#cb311-9"></a>  <span class="co">// callback</span></span>
<span id="cb311-10"><a href="working-with-shiny.html#cb311-10"></a>  <span class="kw">function</span> callback (selectedCountry<span class="op">,</span> relatedCountries) {</span>
<span id="cb311-11"><a href="working-with-shiny.html#cb311-11"></a>    Shiny<span class="op">.</span><span class="fu">setInputValue</span>(el<span class="op">.</span><span class="at">id</span> <span class="op">+</span> <span class="st">&#39;_selected&#39;</span><span class="op">,</span> selectedCountry)<span class="op">;</span></span>
<span id="cb311-12"><a href="working-with-shiny.html#cb311-12"></a>    Shiny<span class="op">.</span><span class="fu">setInputValue</span>(el<span class="op">.</span><span class="at">id</span> <span class="op">+</span> <span class="st">&#39;_related&#39;</span><span class="op">,</span> relatedCountries)<span class="op">;</span></span>
<span id="cb311-13"><a href="working-with-shiny.html#cb311-13"></a>  }</span>
<span id="cb311-14"><a href="working-with-shiny.html#cb311-14"></a></span>
<span id="cb311-15"><a href="working-with-shiny.html#cb311-15"></a>  controller<span class="op">.</span><span class="fu">onCountryPicked</span>(callback)<span class="op">;</span></span>
<span id="cb311-16"><a href="working-with-shiny.html#cb311-16"></a></span>
<span id="cb311-17"><a href="working-with-shiny.html#cb311-17"></a>  <span class="co">// render</span></span>
<span id="cb311-18"><a href="working-with-shiny.html#cb311-18"></a>  controller<span class="op">.</span><span class="fu">init</span>()<span class="op">;</span></span>
<span id="cb311-19"><a href="working-with-shiny.html#cb311-19"></a></span>
<span id="cb311-20"><a href="working-with-shiny.html#cb311-20"></a>}</span>
<span id="cb311-21"><a href="working-with-shiny.html#cb311-21"></a><span class="op">...</span></span></code></pre></div>
<p>The package can then be installed with <code>devtools::install</code> so we can test these inputs in a shiny application.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="working-with-shiny.html#cb312-1"></a><span class="kw">library</span>(gio)</span>
<span id="cb312-2"><a href="working-with-shiny.html#cb312-2"></a><span class="kw">library</span>(shiny)</span>
<span id="cb312-3"><a href="working-with-shiny.html#cb312-3"></a></span>
<span id="cb312-4"><a href="working-with-shiny.html#cb312-4"></a><span class="co"># large sample data</span></span>
<span id="cb312-5"><a href="working-with-shiny.html#cb312-5"></a>url &lt;-<span class="st"> </span><span class="kw">paste0</span>(</span>
<span id="cb312-6"><a href="working-with-shiny.html#cb312-6"></a>  <span class="st">&quot;https://raw.githubusercontent.com/JohnCoene/&quot;</span>,</span>
<span id="cb312-7"><a href="working-with-shiny.html#cb312-7"></a>  <span class="st">&quot;javascript-for-r/master/data/countries.json&quot;</span></span>
<span id="cb312-8"><a href="working-with-shiny.html#cb312-8"></a>)</span>
<span id="cb312-9"><a href="working-with-shiny.html#cb312-9"></a>arcs &lt;-<span class="st"> </span>jsonlite<span class="op">::</span><span class="kw">fromJSON</span>(url)</span>
<span id="cb312-10"><a href="working-with-shiny.html#cb312-10"></a></span>
<span id="cb312-11"><a href="working-with-shiny.html#cb312-11"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb312-12"><a href="working-with-shiny.html#cb312-12"></a>  <span class="kw">gioOutput</span>(<span class="st">&quot;globe&quot;</span>),</span>
<span id="cb312-13"><a href="working-with-shiny.html#cb312-13"></a>  <span class="kw">fluidRow</span>(</span>
<span id="cb312-14"><a href="working-with-shiny.html#cb312-14"></a>    <span class="kw">column</span>(<span class="dv">6</span>, <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;selectedCountry&quot;</span>)),</span>
<span id="cb312-15"><a href="working-with-shiny.html#cb312-15"></a>    <span class="kw">column</span>(<span class="dv">6</span>, <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;relatedCountries&quot;</span>))</span>
<span id="cb312-16"><a href="working-with-shiny.html#cb312-16"></a>  )</span>
<span id="cb312-17"><a href="working-with-shiny.html#cb312-17"></a>)</span>
<span id="cb312-18"><a href="working-with-shiny.html#cb312-18"></a></span>
<span id="cb312-19"><a href="working-with-shiny.html#cb312-19"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</span>
<span id="cb312-20"><a href="working-with-shiny.html#cb312-20"></a></span>
<span id="cb312-21"><a href="working-with-shiny.html#cb312-21"></a>  output<span class="op">$</span>globe &lt;-<span class="st"> </span><span class="kw">renderGio</span>({</span>
<span id="cb312-22"><a href="working-with-shiny.html#cb312-22"></a>    <span class="kw">gio</span>(arcs)</span>
<span id="cb312-23"><a href="working-with-shiny.html#cb312-23"></a>  })</span>
<span id="cb312-24"><a href="working-with-shiny.html#cb312-24"></a></span>
<span id="cb312-25"><a href="working-with-shiny.html#cb312-25"></a>  output<span class="op">$</span>selectedCountry &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</span>
<span id="cb312-26"><a href="working-with-shiny.html#cb312-26"></a>    <span class="kw">print</span>(input<span class="op">$</span>globe_selected)</span>
<span id="cb312-27"><a href="working-with-shiny.html#cb312-27"></a>  })</span>
<span id="cb312-28"><a href="working-with-shiny.html#cb312-28"></a></span>
<span id="cb312-29"><a href="working-with-shiny.html#cb312-29"></a>  output<span class="op">$</span>relatedCountries &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</span>
<span id="cb312-30"><a href="working-with-shiny.html#cb312-30"></a>    <span class="kw">print</span>(input<span class="op">$</span>globe_related)</span>
<span id="cb312-31"><a href="working-with-shiny.html#cb312-31"></a>  })</span>
<span id="cb312-32"><a href="working-with-shiny.html#cb312-32"></a></span>
<span id="cb312-33"><a href="working-with-shiny.html#cb312-33"></a>}</span>
<span id="cb312-34"><a href="working-with-shiny.html#cb312-34"></a></span>
<span id="cb312-35"><a href="working-with-shiny.html#cb312-35"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>The data is sent from the client to the server whether the inputs is used or not, though this likely will not negatively impact gio it can reduce performances if the callback function is triggered too frequently. For instance an input value set when the user hovers a scatter plot might lead to the event being fired very frequently and too much data being sent to the server, slowing things down and providing a poor experience.</p>
<p>Therefore one might consider making the capture of such event optional so the web browser is not strained unless explicitly asked by the developer of the application. You can also consider not sending back all the data. For instance, gio returns the coordinates of the selected country where from arcs connect; this is might be considered unnecessary. The code below only sets the input to the ISO code of the country selected.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb313-1"><a href="working-with-shiny.html#cb313-1"></a><span class="kw">function</span> <span class="fu">callback</span> (selectedCountry<span class="op">,</span> relatedCountries) {</span>
<span id="cb313-2"><a href="working-with-shiny.html#cb313-2"></a>  Shiny<span class="op">.</span><span class="fu">setInputValue</span>(el<span class="op">.</span><span class="at">id</span> <span class="op">+</span> <span class="st">&#39;_selected&#39;</span><span class="op">,</span> selectedCountry<span class="op">.</span><span class="at">ISOCode</span>)<span class="op">;</span></span>
<span id="cb313-3"><a href="working-with-shiny.html#cb313-3"></a>}</span></code></pre></div>
</div>
<div id="input-handler-1" class="section level2 unnumbered" number="">
<h2>Input Handler</h2>
<p>While input handlers were explored previously we found limited use for them as the inputs were set to simple boolean values. It can be useful in this case as the inputs return more data where preprocessing is relevant. Namely the input returning data on the related countries, it is deserialised to a list but could be reshaped to a data frame of arcs.</p>
<p>Below we create a handler that is going to loop over the list (over each arc) and return a data frame.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="working-with-shiny.html#cb314-1"></a><span class="co"># R/zzz.R</span></span>
<span id="cb314-2"><a href="working-with-shiny.html#cb314-2"></a>related_countries_handler &lt;-<span class="st"> </span><span class="cf">function</span>(x, session, inputname){</span>
<span id="cb314-3"><a href="working-with-shiny.html#cb314-3"></a>  purrr<span class="op">::</span><span class="kw">map_dfr</span>(x, as.data.frame)</span>
<span id="cb314-4"><a href="working-with-shiny.html#cb314-4"></a>}</span></code></pre></div>
<p>Then the handler must be registered with shiny, since handler can only be registered once a good place to put it is in the <code>.onLoad</code> function of the package.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="working-with-shiny.html#cb315-1"></a><span class="co"># R/zzz.R</span></span>
<span id="cb315-2"><a href="working-with-shiny.html#cb315-2"></a>related_countries_handler &lt;-<span class="st"> </span><span class="cf">function</span>(x, session, inputname){</span>
<span id="cb315-3"><a href="working-with-shiny.html#cb315-3"></a>  purrr<span class="op">::</span><span class="kw">map_dfr</span>(x, as.data.frame)</span>
<span id="cb315-4"><a href="working-with-shiny.html#cb315-4"></a>}</span>
<span id="cb315-5"><a href="working-with-shiny.html#cb315-5"></a></span>
<span id="cb315-6"><a href="working-with-shiny.html#cb315-6"></a>.onLoad &lt;-<span class="st"> </span><span class="cf">function</span>(libname, pkgname) {</span>
<span id="cb315-7"><a href="working-with-shiny.html#cb315-7"></a>  shiny<span class="op">::</span><span class="kw">registerInputHandler</span>(<span class="st">&quot;gio.related.countries&quot;</span>, related_countries_handler)</span>
<span id="cb315-8"><a href="working-with-shiny.html#cb315-8"></a>}</span></code></pre></div>
<p>Finally, we can reinstall the package with <code>devtools::install</code> and create shiny application to observe the change. Below we use a large example dataset and, since the input now returns a data frame, we can display the input value in a table.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="working-with-shiny.html#cb316-1"></a><span class="kw">library</span>(DT)</span>
<span id="cb316-2"><a href="working-with-shiny.html#cb316-2"></a><span class="kw">library</span>(gio)</span>
<span id="cb316-3"><a href="working-with-shiny.html#cb316-3"></a><span class="kw">library</span>(shiny)</span>
<span id="cb316-4"><a href="working-with-shiny.html#cb316-4"></a></span>
<span id="cb316-5"><a href="working-with-shiny.html#cb316-5"></a><span class="co"># large sample data</span></span>
<span id="cb316-6"><a href="working-with-shiny.html#cb316-6"></a>url &lt;-<span class="st"> </span><span class="kw">paste0</span>(</span>
<span id="cb316-7"><a href="working-with-shiny.html#cb316-7"></a>  <span class="st">&quot;https://raw.githubusercontent.com/JohnCoene/&quot;</span>,</span>
<span id="cb316-8"><a href="working-with-shiny.html#cb316-8"></a>  <span class="st">&quot;javascript-for-r/master/data/countries.json&quot;</span></span>
<span id="cb316-9"><a href="working-with-shiny.html#cb316-9"></a>)</span>
<span id="cb316-10"><a href="working-with-shiny.html#cb316-10"></a>arcs &lt;-<span class="st"> </span>jsonlite<span class="op">::</span><span class="kw">fromJSON</span>(url)</span>
<span id="cb316-11"><a href="working-with-shiny.html#cb316-11"></a></span>
<span id="cb316-12"><a href="working-with-shiny.html#cb316-12"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb316-13"><a href="working-with-shiny.html#cb316-13"></a>  <span class="kw">gioOutput</span>(<span class="st">&quot;globe&quot;</span>),</span>
<span id="cb316-14"><a href="working-with-shiny.html#cb316-14"></a>  <span class="kw">DTOutput</span>(<span class="st">&quot;relatedCountries&quot;</span>)</span>
<span id="cb316-15"><a href="working-with-shiny.html#cb316-15"></a>)</span>
<span id="cb316-16"><a href="working-with-shiny.html#cb316-16"></a></span>
<span id="cb316-17"><a href="working-with-shiny.html#cb316-17"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</span>
<span id="cb316-18"><a href="working-with-shiny.html#cb316-18"></a></span>
<span id="cb316-19"><a href="working-with-shiny.html#cb316-19"></a>  output<span class="op">$</span>globe &lt;-<span class="st"> </span><span class="kw">renderGio</span>({</span>
<span id="cb316-20"><a href="working-with-shiny.html#cb316-20"></a>    <span class="kw">gio</span>(arcs)</span>
<span id="cb316-21"><a href="working-with-shiny.html#cb316-21"></a>  })</span>
<span id="cb316-22"><a href="working-with-shiny.html#cb316-22"></a></span>
<span id="cb316-23"><a href="working-with-shiny.html#cb316-23"></a>  output<span class="op">$</span>relatedCountries &lt;-<span class="st"> </span><span class="kw">renderDT</span>({</span>
<span id="cb316-24"><a href="working-with-shiny.html#cb316-24"></a>    <span class="kw">datatable</span>(input<span class="op">$</span>globe_related)</span>
<span id="cb316-25"><a href="working-with-shiny.html#cb316-25"></a>  })</span>
<span id="cb316-26"><a href="working-with-shiny.html#cb316-26"></a></span>
<span id="cb316-27"><a href="working-with-shiny.html#cb316-27"></a>}</span>
<span id="cb316-28"><a href="working-with-shiny.html#cb316-28"></a></span>
<span id="cb316-29"><a href="working-with-shiny.html#cb316-29"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="figure">
<img src="images/gio-input-handler.png" alt="" />
<p class="caption">Input transformed to data frame</p>
</div>
</div>
<div id="r-to-javascript" class="section level2 unnumbered" number="">
<h2>R to JavaScript</h2>
<p>This book previously explored how to send data to the from the shiny server to the front-end, this section applies this to htmlwidgets. Currently, using gio in shiny consists of generating the globe with the <code>renderGio</code> and complimentary <code>gioOutput</code> functions. This generates the entire visualisation, it creates the HTML element where it places the globe, draws the arcs based on the data, sets the style, etc.</p>
<p>Now imagine that only one of the elements of the globe needs changing say the data, or the style, given the functions currently at hand one would have to redraw the entire visualisation, only changing the data or the style. However, most JavaScript visualisation libraries, including gio.js, will enable changing only certain aspects of the output.</p>
<p>Before we look into the implementation, let us create a shiny application which would benefit from such a feature. The shiny application below provides a drop-down menu to select between two datasets to draw on the globe, running it reveals an issue with gio though. Upon selecting a dataset with the drop down a second globe appears underneath the original one. This is because internally gio.js creates a new element (<code>&lt;canvas&gt;</code>) within the <code>&lt;div&gt;</code> created by <code>htmlwidgets</code> when running <code>init</code>, regardless of whether one was already created. Note that most visualisation libraries will not have that issue, they will detect the existing output and override it instead.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="working-with-shiny.html#cb317-1"></a><span class="kw">library</span>(gio)</span>
<span id="cb317-2"><a href="working-with-shiny.html#cb317-2"></a><span class="kw">library</span>(shiny)</span>
<span id="cb317-3"><a href="working-with-shiny.html#cb317-3"></a></span>
<span id="cb317-4"><a href="working-with-shiny.html#cb317-4"></a>arcs1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb317-5"><a href="working-with-shiny.html#cb317-5"></a>  <span class="dt">e =</span> <span class="kw">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>),</span>
<span id="cb317-6"><a href="working-with-shiny.html#cb317-6"></a>  <span class="dt">i =</span> <span class="kw">c</span>(<span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>, <span class="st">&quot;US&quot;</span>),</span>
<span id="cb317-7"><a href="working-with-shiny.html#cb317-7"></a>  <span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">130</span>)</span>
<span id="cb317-8"><a href="working-with-shiny.html#cb317-8"></a>)</span>
<span id="cb317-9"><a href="working-with-shiny.html#cb317-9"></a></span>
<span id="cb317-10"><a href="working-with-shiny.html#cb317-10"></a>arcs2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb317-11"><a href="working-with-shiny.html#cb317-11"></a>  <span class="dt">e =</span> <span class="kw">c</span>(<span class="st">&quot;CN&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;JP&quot;</span>),</span>
<span id="cb317-12"><a href="working-with-shiny.html#cb317-12"></a>  <span class="dt">i =</span> <span class="kw">c</span>(<span class="st">&quot;IN&quot;</span>, <span class="st">&quot;JP&quot;</span>, <span class="st">&quot;US&quot;</span>),</span>
<span id="cb317-13"><a href="working-with-shiny.html#cb317-13"></a>  <span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">130</span>)</span>
<span id="cb317-14"><a href="working-with-shiny.html#cb317-14"></a>)</span>
<span id="cb317-15"><a href="working-with-shiny.html#cb317-15"></a></span>
<span id="cb317-16"><a href="working-with-shiny.html#cb317-16"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb317-17"><a href="working-with-shiny.html#cb317-17"></a>  <span class="kw">selectInput</span>(</span>
<span id="cb317-18"><a href="working-with-shiny.html#cb317-18"></a>    <span class="st">&quot;dataset&quot;</span>, </span>
<span id="cb317-19"><a href="working-with-shiny.html#cb317-19"></a>    <span class="st">&quot;Select a dataset&quot;</span>, </span>
<span id="cb317-20"><a href="working-with-shiny.html#cb317-20"></a>    <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;First&quot;</span>, <span class="st">&quot;Second&quot;</span>)</span>
<span id="cb317-21"><a href="working-with-shiny.html#cb317-21"></a>  ),</span>
<span id="cb317-22"><a href="working-with-shiny.html#cb317-22"></a>  <span class="kw">gioOutput</span>(<span class="st">&quot;globe&quot;</span>)</span>
<span id="cb317-23"><a href="working-with-shiny.html#cb317-23"></a>)</span>
<span id="cb317-24"><a href="working-with-shiny.html#cb317-24"></a></span>
<span id="cb317-25"><a href="working-with-shiny.html#cb317-25"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</span>
<span id="cb317-26"><a href="working-with-shiny.html#cb317-26"></a></span>
<span id="cb317-27"><a href="working-with-shiny.html#cb317-27"></a>  reactive_arcs &lt;-<span class="st"> </span><span class="kw">reactive</span>({</span>
<span id="cb317-28"><a href="working-with-shiny.html#cb317-28"></a>    <span class="cf">if</span>(input<span class="op">$</span>dataset <span class="op">==</span><span class="st"> &quot;First&quot;</span>) </span>
<span id="cb317-29"><a href="working-with-shiny.html#cb317-29"></a>      <span class="kw">return</span>(arcs1)</span>
<span id="cb317-30"><a href="working-with-shiny.html#cb317-30"></a>    <span class="kw">return</span>(arcs2)</span>
<span id="cb317-31"><a href="working-with-shiny.html#cb317-31"></a>  })</span>
<span id="cb317-32"><a href="working-with-shiny.html#cb317-32"></a></span>
<span id="cb317-33"><a href="working-with-shiny.html#cb317-33"></a>  output<span class="op">$</span>globe &lt;-<span class="st"> </span><span class="kw">renderGio</span>({</span>
<span id="cb317-34"><a href="working-with-shiny.html#cb317-34"></a>    <span class="kw">gio</span>(<span class="kw">reactive_arcs</span>())</span>
<span id="cb317-35"><a href="working-with-shiny.html#cb317-35"></a>  })</span>
<span id="cb317-36"><a href="working-with-shiny.html#cb317-36"></a></span>
<span id="cb317-37"><a href="working-with-shiny.html#cb317-37"></a>}</span>
<span id="cb317-38"><a href="working-with-shiny.html#cb317-38"></a></span>
<span id="cb317-39"><a href="working-with-shiny.html#cb317-39"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>A solution to this is to ensure the div created by htmlwidgets is empty before create the visualisation. Incidentally this can be executed with a JavaScript method previously used in this book: <code>innerHTML</code>. This can be used on the <code>container</code> before it is used to create an instance of gio.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb318-1"><a href="working-with-shiny.html#cb318-1"></a><span class="co">// gio.js</span></span>
<span id="cb318-2"><a href="working-with-shiny.html#cb318-2"></a><span class="kw">var</span> container <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(el<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb318-3"><a href="working-with-shiny.html#cb318-3"></a>container<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span> <span class="co">// empty the container</span></span>
<span id="cb318-4"><a href="working-with-shiny.html#cb318-4"></a>controller <span class="op">=</span> <span class="kw">new</span> GIO<span class="op">.</span><span class="fu">Controller</span>(container)<span class="op">;</span></span>
<span id="cb318-5"><a href="working-with-shiny.html#cb318-5"></a><span class="op">...</span></span></code></pre></div>
<p>We got sidetracked but this had to be fixed. Ideally, when the user selects an dataset from the dropdown the entire visualisation is not redrawn, only the underlying data (the arcs) changes. To do so, a new set of functions divorced from the ones currently at hand needs to be created. This separation will allow leaving the already created functions as-is, using <code>gio</code> to initialise a visualisation and its JavaScript complement <code>renderValue</code>, and have a separate family of functions dedicated to working with different JavaScript functions which circumvent <code>renderValue</code> to directly change aspects of the visualisation (such as the underlying dataset).</p>
<p>This involves a few moving parts, thankfully some of them were already explored, just not in the context of htmlwidgets. The scheme is to send data from R to JavaScript using the formerly exploited <code>session$sendCustomMessage</code>, then in JavaScript fetch the visualisation object (<code>controller</code> in this case) to enable interacting with the widget, bypassing <code>renderValue</code>.</p>
<div id="send-data" class="section level3 unnumbered" number="">
<h3>Send Data</h3>
<p>Let’s start by creating the R function used to send data to JavaScript. This is hopefully reminiscent of a previous chapter, this function sends a message to JavaScript where it is paired with “message handler” that does something with said message.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="working-with-shiny.html#cb319-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb319-2"><a href="working-with-shiny.html#cb319-2"></a>gio_send_data &lt;-<span class="st"> </span><span class="cf">function</span>(id, data, <span class="dt">session =</span> shiny<span class="op">::</span><span class="kw">getDefaultReactiveDomain</span>()){</span>
<span id="cb319-3"><a href="working-with-shiny.html#cb319-3"></a>  message &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">id =</span> id, <span class="dt">data =</span> data)</span>
<span id="cb319-4"><a href="working-with-shiny.html#cb319-4"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;send-data&quot;</span>, message)</span>
<span id="cb319-5"><a href="working-with-shiny.html#cb319-5"></a>}</span></code></pre></div>
<p>The function takes the id of the visualisation the data is destined for, the data itself, and a shiny session used to send the data. The id of the visualisation is sent as part of the message and will be used to retrieve the instance of the visualisation and subsequently apply the data. Note that we give this message the <code>send-data</code> identifier, this will be needed when we write its handler.</p>
<p>There is one caveat that will make it such that the above will not work. To have gio.js work with data changes had to be made to the serialiser (using the <code>TOJSON_ARGS</code> attribute), this cannot be used here. The data being sent with Shiny via the session object the problem reoccurs: shiny, like htmlwidgets, serialises data frames column-wise and not row-wise. One can preview the way shiny serialises with <code>shiny:::toJSON</code> (three-colon).</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="working-with-shiny.html#cb320-1"></a><span class="co"># preview shiny serialisation</span></span>
<span id="cb320-2"><a href="working-with-shiny.html#cb320-2"></a>shiny<span class="op">:::</span><span class="kw">toJSON</span>(arcs)</span></code></pre></div>
<pre><code>## {&quot;e&quot;:[&quot;CN&quot;,&quot;CN&quot;],&quot;i&quot;:[&quot;US&quot;,&quot;RU&quot;],&quot;v&quot;:[3300000,10000]}</code></pre>
<p>Unfortunately this serialiser cannot be changed, therefore we have to reformat the data to a list which resembles the JSON output desired, using <code>apply</code> to turn every row into a list will do the job in most cases.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="working-with-shiny.html#cb322-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb322-2"><a href="working-with-shiny.html#cb322-2"></a>gio_send_data &lt;-<span class="st"> </span><span class="cf">function</span>(id, data, <span class="dt">session =</span> shiny<span class="op">::</span><span class="kw">getDefaultReactiveDomain</span>()){</span>
<span id="cb322-3"><a href="working-with-shiny.html#cb322-3"></a>  message &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">id =</span> id, <span class="dt">data =</span> <span class="kw">apply</span>(data, <span class="dv">1</span>, as.list))</span>
<span id="cb322-4"><a href="working-with-shiny.html#cb322-4"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;send-data&quot;</span>, message)</span>
<span id="cb322-5"><a href="working-with-shiny.html#cb322-5"></a>}</span></code></pre></div>
</div>
<div id="retrieve-widget-instance" class="section level3 unnumbered" number="">
<h3>Retrieve Widget Instance</h3>
<p>We will need to be able to access the instance of the visualisation (<code>controller</code>) outside of the function <code>factory</code>. This can be made accessible by adding a function (technically a method) that returns the <code>controller</code>. Below we create a function called <code>getGlobe</code> which returns the <code>controller</code>.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb323-1"><a href="working-with-shiny.html#cb323-1"></a>HTMLWidgets<span class="op">.</span><span class="fu">widget</span>({</span>
<span id="cb323-2"><a href="working-with-shiny.html#cb323-2"></a></span>
<span id="cb323-3"><a href="working-with-shiny.html#cb323-3"></a>  <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;gio&#39;</span><span class="op">,</span></span>
<span id="cb323-4"><a href="working-with-shiny.html#cb323-4"></a></span>
<span id="cb323-5"><a href="working-with-shiny.html#cb323-5"></a>  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;output&#39;</span><span class="op">,</span></span>
<span id="cb323-6"><a href="working-with-shiny.html#cb323-6"></a></span>
<span id="cb323-7"><a href="working-with-shiny.html#cb323-7"></a>  <span class="dt">factory</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> width<span class="op">,</span> height) {</span>
<span id="cb323-8"><a href="working-with-shiny.html#cb323-8"></a></span>
<span id="cb323-9"><a href="working-with-shiny.html#cb323-9"></a>    <span class="kw">var</span> controller<span class="op">;</span></span>
<span id="cb323-10"><a href="working-with-shiny.html#cb323-10"></a></span>
<span id="cb323-11"><a href="working-with-shiny.html#cb323-11"></a>    <span class="cf">return</span> {</span>
<span id="cb323-12"><a href="working-with-shiny.html#cb323-12"></a></span>
<span id="cb323-13"><a href="working-with-shiny.html#cb323-13"></a>      <span class="dt">renderValue</span><span class="op">:</span> <span class="kw">function</span>(x) {</span>
<span id="cb323-14"><a href="working-with-shiny.html#cb323-14"></a></span>
<span id="cb323-15"><a href="working-with-shiny.html#cb323-15"></a>        <span class="kw">var</span> container <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(el<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb323-16"><a href="working-with-shiny.html#cb323-16"></a>        container<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb323-17"><a href="working-with-shiny.html#cb323-17"></a>        controller <span class="op">=</span> <span class="kw">new</span> GIO<span class="op">.</span><span class="fu">Controller</span>(container)<span class="op">;</span></span>
<span id="cb323-18"><a href="working-with-shiny.html#cb323-18"></a>        </span>
<span id="cb323-19"><a href="working-with-shiny.html#cb323-19"></a>        <span class="co">// add data</span></span>
<span id="cb323-20"><a href="working-with-shiny.html#cb323-20"></a>        controller<span class="op">.</span><span class="fu">addData</span>(x<span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb323-21"><a href="working-with-shiny.html#cb323-21"></a></span>
<span id="cb323-22"><a href="working-with-shiny.html#cb323-22"></a>        controller<span class="op">.</span><span class="fu">setStyle</span>(x<span class="op">.</span><span class="at">style</span>)<span class="op">;</span></span>
<span id="cb323-23"><a href="working-with-shiny.html#cb323-23"></a></span>
<span id="cb323-24"><a href="working-with-shiny.html#cb323-24"></a>        <span class="co">// callback</span></span>
<span id="cb323-25"><a href="working-with-shiny.html#cb323-25"></a>        controller<span class="op">.</span><span class="fu">onCountryPicked</span>(callback)<span class="op">;</span></span>
<span id="cb323-26"><a href="working-with-shiny.html#cb323-26"></a></span>
<span id="cb323-27"><a href="working-with-shiny.html#cb323-27"></a>        <span class="kw">function</span> callback (selectedCountry<span class="op">,</span> relatedCountries) {</span>
<span id="cb323-28"><a href="working-with-shiny.html#cb323-28"></a>          Shiny<span class="op">.</span><span class="fu">setInputValue</span>(el<span class="op">.</span><span class="at">id</span> <span class="op">+</span> <span class="st">&#39;_selected&#39;</span><span class="op">,</span> selectedCountry)<span class="op">;</span></span>
<span id="cb323-29"><a href="working-with-shiny.html#cb323-29"></a>          Shiny<span class="op">.</span><span class="fu">setInputValue</span>(el<span class="op">.</span><span class="at">id</span> <span class="op">+</span> <span class="st">&#39;_related:gio.related.countries&#39;</span><span class="op">,</span> relatedCountries)<span class="op">;</span></span>
<span id="cb323-30"><a href="working-with-shiny.html#cb323-30"></a>        }</span>
<span id="cb323-31"><a href="working-with-shiny.html#cb323-31"></a></span>
<span id="cb323-32"><a href="working-with-shiny.html#cb323-32"></a>        <span class="co">// render</span></span>
<span id="cb323-33"><a href="working-with-shiny.html#cb323-33"></a>        controller<span class="op">.</span><span class="fu">init</span>()<span class="op">;</span></span>
<span id="cb323-34"><a href="working-with-shiny.html#cb323-34"></a></span>
<span id="cb323-35"><a href="working-with-shiny.html#cb323-35"></a>      }<span class="op">,</span></span>
<span id="cb323-36"><a href="working-with-shiny.html#cb323-36"></a></span>
<span id="cb323-37"><a href="working-with-shiny.html#cb323-37"></a>      <span class="dt">resize</span><span class="op">:</span> <span class="kw">function</span>(width<span class="op">,</span> height) {</span>
<span id="cb323-38"><a href="working-with-shiny.html#cb323-38"></a></span>
<span id="cb323-39"><a href="working-with-shiny.html#cb323-39"></a>        controller<span class="op">.</span><span class="fu">resizeUpdate</span>()</span>
<span id="cb323-40"><a href="working-with-shiny.html#cb323-40"></a></span>
<span id="cb323-41"><a href="working-with-shiny.html#cb323-41"></a>      }<span class="op">,</span></span>
<span id="cb323-42"><a href="working-with-shiny.html#cb323-42"></a></span>
<span id="cb323-43"><a href="working-with-shiny.html#cb323-43"></a>      <span class="dt">getGlobe</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb323-44"><a href="working-with-shiny.html#cb323-44"></a>        <span class="cf">return</span> controller<span class="op">;</span></span>
<span id="cb323-45"><a href="working-with-shiny.html#cb323-45"></a>      }</span>
<span id="cb323-46"><a href="working-with-shiny.html#cb323-46"></a></span>
<span id="cb323-47"><a href="working-with-shiny.html#cb323-47"></a>    }<span class="op">;</span></span>
<span id="cb323-48"><a href="working-with-shiny.html#cb323-48"></a>  }</span>
<span id="cb323-49"><a href="working-with-shiny.html#cb323-49"></a>})<span class="op">;</span></span></code></pre></div>
<p>Then we create a function which uses <code>HTMLWidgets.find</code> to retrieve the htmlwidgets instance that contains the object returned by <code>factory</code>. This object includes the function <code>getGlobe</code> which we then use to obtain the <code>controller</code>.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb324-1"><a href="working-with-shiny.html#cb324-1"></a>HTMLWidgets<span class="op">.</span><span class="fu">widget</span>({</span>
<span id="cb324-2"><a href="working-with-shiny.html#cb324-2"></a></span>
<span id="cb324-3"><a href="working-with-shiny.html#cb324-3"></a>  <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;gio&#39;</span><span class="op">,</span></span>
<span id="cb324-4"><a href="working-with-shiny.html#cb324-4"></a></span>
<span id="cb324-5"><a href="working-with-shiny.html#cb324-5"></a>  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;output&#39;</span><span class="op">,</span></span>
<span id="cb324-6"><a href="working-with-shiny.html#cb324-6"></a></span>
<span id="cb324-7"><a href="working-with-shiny.html#cb324-7"></a>  <span class="dt">factory</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> width<span class="op">,</span> height) {</span>
<span id="cb324-8"><a href="working-with-shiny.html#cb324-8"></a></span>
<span id="cb324-9"><a href="working-with-shiny.html#cb324-9"></a>    <span class="kw">var</span> controller<span class="op">;</span></span>
<span id="cb324-10"><a href="working-with-shiny.html#cb324-10"></a></span>
<span id="cb324-11"><a href="working-with-shiny.html#cb324-11"></a>    <span class="cf">return</span> {</span>
<span id="cb324-12"><a href="working-with-shiny.html#cb324-12"></a></span>
<span id="cb324-13"><a href="working-with-shiny.html#cb324-13"></a>      <span class="dt">renderValue</span><span class="op">:</span> <span class="kw">function</span>(x) {</span>
<span id="cb324-14"><a href="working-with-shiny.html#cb324-14"></a></span>
<span id="cb324-15"><a href="working-with-shiny.html#cb324-15"></a>        <span class="kw">var</span> container <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(el<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb324-16"><a href="working-with-shiny.html#cb324-16"></a>        container<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb324-17"><a href="working-with-shiny.html#cb324-17"></a>        controller <span class="op">=</span> <span class="kw">new</span> GIO<span class="op">.</span><span class="fu">Controller</span>(container)<span class="op">;</span></span>
<span id="cb324-18"><a href="working-with-shiny.html#cb324-18"></a>        </span>
<span id="cb324-19"><a href="working-with-shiny.html#cb324-19"></a>        <span class="co">// add data</span></span>
<span id="cb324-20"><a href="working-with-shiny.html#cb324-20"></a>        controller<span class="op">.</span><span class="fu">addData</span>(x<span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb324-21"><a href="working-with-shiny.html#cb324-21"></a></span>
<span id="cb324-22"><a href="working-with-shiny.html#cb324-22"></a>        controller<span class="op">.</span><span class="fu">setStyle</span>(x<span class="op">.</span><span class="at">style</span>)<span class="op">;</span></span>
<span id="cb324-23"><a href="working-with-shiny.html#cb324-23"></a></span>
<span id="cb324-24"><a href="working-with-shiny.html#cb324-24"></a>        <span class="co">// callback</span></span>
<span id="cb324-25"><a href="working-with-shiny.html#cb324-25"></a>        controller<span class="op">.</span><span class="fu">onCountryPicked</span>(callback)<span class="op">;</span></span>
<span id="cb324-26"><a href="working-with-shiny.html#cb324-26"></a></span>
<span id="cb324-27"><a href="working-with-shiny.html#cb324-27"></a>        <span class="kw">function</span> callback (selectedCountry<span class="op">,</span> relatedCountries) {</span>
<span id="cb324-28"><a href="working-with-shiny.html#cb324-28"></a>          Shiny<span class="op">.</span><span class="fu">setInputValue</span>(el<span class="op">.</span><span class="at">id</span> <span class="op">+</span> <span class="st">&#39;_selected&#39;</span><span class="op">,</span> selectedCountry)<span class="op">;</span></span>
<span id="cb324-29"><a href="working-with-shiny.html#cb324-29"></a>          Shiny<span class="op">.</span><span class="fu">setInputValue</span>(el<span class="op">.</span><span class="at">id</span> <span class="op">+</span> <span class="st">&#39;_related:gio.related.countries&#39;</span><span class="op">,</span> relatedCountries)<span class="op">;</span></span>
<span id="cb324-30"><a href="working-with-shiny.html#cb324-30"></a>        }</span>
<span id="cb324-31"><a href="working-with-shiny.html#cb324-31"></a></span>
<span id="cb324-32"><a href="working-with-shiny.html#cb324-32"></a>        <span class="co">// render</span></span>
<span id="cb324-33"><a href="working-with-shiny.html#cb324-33"></a>        controller<span class="op">.</span><span class="fu">init</span>()<span class="op">;</span></span>
<span id="cb324-34"><a href="working-with-shiny.html#cb324-34"></a></span>
<span id="cb324-35"><a href="working-with-shiny.html#cb324-35"></a>      }<span class="op">,</span></span>
<span id="cb324-36"><a href="working-with-shiny.html#cb324-36"></a></span>
<span id="cb324-37"><a href="working-with-shiny.html#cb324-37"></a>      <span class="dt">resize</span><span class="op">:</span> <span class="kw">function</span>(width<span class="op">,</span> height) {</span>
<span id="cb324-38"><a href="working-with-shiny.html#cb324-38"></a></span>
<span id="cb324-39"><a href="working-with-shiny.html#cb324-39"></a>        controller<span class="op">.</span><span class="fu">resizeUpdate</span>()</span>
<span id="cb324-40"><a href="working-with-shiny.html#cb324-40"></a></span>
<span id="cb324-41"><a href="working-with-shiny.html#cb324-41"></a>      }<span class="op">,</span></span>
<span id="cb324-42"><a href="working-with-shiny.html#cb324-42"></a></span>
<span id="cb324-43"><a href="working-with-shiny.html#cb324-43"></a>      <span class="dt">getGlobe</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb324-44"><a href="working-with-shiny.html#cb324-44"></a>        <span class="cf">return</span> controller<span class="op">;</span></span>
<span id="cb324-45"><a href="working-with-shiny.html#cb324-45"></a>      }</span>
<span id="cb324-46"><a href="working-with-shiny.html#cb324-46"></a></span>
<span id="cb324-47"><a href="working-with-shiny.html#cb324-47"></a>    }<span class="op">;</span></span>
<span id="cb324-48"><a href="working-with-shiny.html#cb324-48"></a>  }</span>
<span id="cb324-49"><a href="working-with-shiny.html#cb324-49"></a>})<span class="op">;</span></span>
<span id="cb324-50"><a href="working-with-shiny.html#cb324-50"></a></span>
<span id="cb324-51"><a href="working-with-shiny.html#cb324-51"></a><span class="co">// return the widget</span></span>
<span id="cb324-52"><a href="working-with-shiny.html#cb324-52"></a><span class="kw">function</span> <span class="fu">get_gio</span>(id){</span>
<span id="cb324-53"><a href="working-with-shiny.html#cb324-53"></a>  <span class="kw">var</span> widget <span class="op">=</span> HTMLWidgets<span class="op">.</span><span class="fu">find</span>(<span class="st">&quot;#&quot;</span> <span class="op">+</span> id)<span class="op">;</span></span>
<span id="cb324-54"><a href="working-with-shiny.html#cb324-54"></a>  <span class="kw">var</span> globe <span class="op">=</span> widget<span class="op">.</span><span class="fu">getGlobe</span>()<span class="op">;</span></span>
<span id="cb324-55"><a href="working-with-shiny.html#cb324-55"></a>  <span class="cf">return</span> globe<span class="op">;</span></span>
<span id="cb324-56"><a href="working-with-shiny.html#cb324-56"></a>}</span></code></pre></div>
</div>
<div id="handle-data" class="section level3 unnumbered" number="">
<h3>Handle Data</h3>
<p>Now that there is a function which sends data and a chart identifier to the client from R and that there is a JavaScript function to retrieve the visualisation object using the aforementioned identifier, all this is missing is the handling of that data so it is applied to the visualisation: the “message handler.” Registering the message handler being only relevant if shiny is running HTMLWidgets comes with a JavaScript method to check whether that is the case. This is useful to avoid needless errors as the registration of the shiny message handler will only work if the widget is used in shiny. We can thus use it in an if statement where all message handlers should be registered.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb325-1"><a href="working-with-shiny.html#cb325-1"></a><span class="co">// gio.js</span></span>
<span id="cb325-2"><a href="working-with-shiny.html#cb325-2"></a></span>
<span id="cb325-3"><a href="working-with-shiny.html#cb325-3"></a><span class="co">// check if shiny running</span></span>
<span id="cb325-4"><a href="working-with-shiny.html#cb325-4"></a><span class="cf">if</span> (HTMLWidgets<span class="op">.</span><span class="at">shinyMode</span>){</span>
<span id="cb325-5"><a href="working-with-shiny.html#cb325-5"></a></span>
<span id="cb325-6"><a href="working-with-shiny.html#cb325-6"></a>  <span class="co">// send-data message handler</span></span>
<span id="cb325-7"><a href="working-with-shiny.html#cb325-7"></a>  Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(type <span class="op">=</span> <span class="st">&#39;send-data&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) {</span>
<span id="cb325-8"><a href="working-with-shiny.html#cb325-8"></a></span>
<span id="cb325-9"><a href="working-with-shiny.html#cb325-9"></a>  })<span class="op">;</span></span>
<span id="cb325-10"><a href="working-with-shiny.html#cb325-10"></a></span>
<span id="cb325-11"><a href="working-with-shiny.html#cb325-11"></a>}</span></code></pre></div>
<p>What the currently empty <code>send-alert</code> message handler should do is fetch the widget using the <code>id</code> sent from R with the <code>get_gio</code> function and then use the <code>addData</code> method to override the previously define arcs.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb326-1"><a href="working-with-shiny.html#cb326-1"></a><span class="co">// gio.js</span></span>
<span id="cb326-2"><a href="working-with-shiny.html#cb326-2"></a></span>
<span id="cb326-3"><a href="working-with-shiny.html#cb326-3"></a><span class="co">// check if shiny running</span></span>
<span id="cb326-4"><a href="working-with-shiny.html#cb326-4"></a><span class="cf">if</span> (HTMLWidgets<span class="op">.</span><span class="at">shinyMode</span>){</span>
<span id="cb326-5"><a href="working-with-shiny.html#cb326-5"></a></span>
<span id="cb326-6"><a href="working-with-shiny.html#cb326-6"></a>  <span class="co">// send-data message handler</span></span>
<span id="cb326-7"><a href="working-with-shiny.html#cb326-7"></a>  Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(type <span class="op">=</span> <span class="st">&#39;send-data&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) {</span>
<span id="cb326-8"><a href="working-with-shiny.html#cb326-8"></a></span>
<span id="cb326-9"><a href="working-with-shiny.html#cb326-9"></a>    <span class="co">// retrieve controller</span></span>
<span id="cb326-10"><a href="working-with-shiny.html#cb326-10"></a>    <span class="kw">var</span> controller <span class="op">=</span> get_gio(message<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb326-11"><a href="working-with-shiny.html#cb326-11"></a></span>
<span id="cb326-12"><a href="working-with-shiny.html#cb326-12"></a>    <span class="co">// add data</span></span>
<span id="cb326-13"><a href="working-with-shiny.html#cb326-13"></a>    controller<span class="op">.</span><span class="fu">addData</span>(message<span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb326-14"><a href="working-with-shiny.html#cb326-14"></a></span>
<span id="cb326-15"><a href="working-with-shiny.html#cb326-15"></a>  })<span class="op">;</span></span>
<span id="cb326-16"><a href="working-with-shiny.html#cb326-16"></a></span>
<span id="cb326-17"><a href="working-with-shiny.html#cb326-17"></a>}</span></code></pre></div>
<p>We can then build a shiny application to test the new functionality.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="working-with-shiny.html#cb327-1"></a><span class="kw">library</span>(gio)</span>
<span id="cb327-2"><a href="working-with-shiny.html#cb327-2"></a><span class="kw">library</span>(shiny)</span>
<span id="cb327-3"><a href="working-with-shiny.html#cb327-3"></a></span>
<span id="cb327-4"><a href="working-with-shiny.html#cb327-4"></a><span class="co"># two phoney datasets</span></span>
<span id="cb327-5"><a href="working-with-shiny.html#cb327-5"></a>arcs1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb327-6"><a href="working-with-shiny.html#cb327-6"></a>  <span class="dt">e =</span> <span class="kw">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>),</span>
<span id="cb327-7"><a href="working-with-shiny.html#cb327-7"></a>  <span class="dt">i =</span> <span class="kw">c</span>(<span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>, <span class="st">&quot;US&quot;</span>),</span>
<span id="cb327-8"><a href="working-with-shiny.html#cb327-8"></a>  <span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">130</span>)</span>
<span id="cb327-9"><a href="working-with-shiny.html#cb327-9"></a>)</span>
<span id="cb327-10"><a href="working-with-shiny.html#cb327-10"></a></span>
<span id="cb327-11"><a href="working-with-shiny.html#cb327-11"></a>arcs2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb327-12"><a href="working-with-shiny.html#cb327-12"></a>  <span class="dt">e =</span> <span class="kw">c</span>(<span class="st">&quot;CN&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;JP&quot;</span>),</span>
<span id="cb327-13"><a href="working-with-shiny.html#cb327-13"></a>  <span class="dt">i =</span> <span class="kw">c</span>(<span class="st">&quot;IN&quot;</span>, <span class="st">&quot;JP&quot;</span>, <span class="st">&quot;US&quot;</span>),</span>
<span id="cb327-14"><a href="working-with-shiny.html#cb327-14"></a>  <span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">130</span>)</span>
<span id="cb327-15"><a href="working-with-shiny.html#cb327-15"></a>)</span>
<span id="cb327-16"><a href="working-with-shiny.html#cb327-16"></a></span>
<span id="cb327-17"><a href="working-with-shiny.html#cb327-17"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb327-18"><a href="working-with-shiny.html#cb327-18"></a>  <span class="kw">selectInput</span>(</span>
<span id="cb327-19"><a href="working-with-shiny.html#cb327-19"></a>    <span class="st">&quot;dataset&quot;</span>, </span>
<span id="cb327-20"><a href="working-with-shiny.html#cb327-20"></a>    <span class="st">&quot;Select a dataset&quot;</span>, </span>
<span id="cb327-21"><a href="working-with-shiny.html#cb327-21"></a>    <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;First&quot;</span>, <span class="st">&quot;Second&quot;</span>)</span>
<span id="cb327-22"><a href="working-with-shiny.html#cb327-22"></a>  ),</span>
<span id="cb327-23"><a href="working-with-shiny.html#cb327-23"></a>  <span class="kw">gioOutput</span>(<span class="st">&quot;globe&quot;</span>)</span>
<span id="cb327-24"><a href="working-with-shiny.html#cb327-24"></a>)</span>
<span id="cb327-25"><a href="working-with-shiny.html#cb327-25"></a></span>
<span id="cb327-26"><a href="working-with-shiny.html#cb327-26"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</span>
<span id="cb327-27"><a href="working-with-shiny.html#cb327-27"></a></span>
<span id="cb327-28"><a href="working-with-shiny.html#cb327-28"></a>  reactive_arcs &lt;-<span class="st"> </span><span class="kw">reactive</span>({</span>
<span id="cb327-29"><a href="working-with-shiny.html#cb327-29"></a>    <span class="cf">if</span>(input<span class="op">$</span>dataset <span class="op">==</span><span class="st"> &quot;First&quot;</span>) </span>
<span id="cb327-30"><a href="working-with-shiny.html#cb327-30"></a>      <span class="kw">return</span>(arcs1)</span>
<span id="cb327-31"><a href="working-with-shiny.html#cb327-31"></a>    <span class="kw">return</span>(arcs2)</span>
<span id="cb327-32"><a href="working-with-shiny.html#cb327-32"></a>  })</span>
<span id="cb327-33"><a href="working-with-shiny.html#cb327-33"></a></span>
<span id="cb327-34"><a href="working-with-shiny.html#cb327-34"></a>  output<span class="op">$</span>globe &lt;-<span class="st"> </span><span class="kw">renderGio</span>({</span>
<span id="cb327-35"><a href="working-with-shiny.html#cb327-35"></a>    <span class="kw">gio</span>(arcs1)</span>
<span id="cb327-36"><a href="working-with-shiny.html#cb327-36"></a>  })</span>
<span id="cb327-37"><a href="working-with-shiny.html#cb327-37"></a></span>
<span id="cb327-38"><a href="working-with-shiny.html#cb327-38"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>dataset, {</span>
<span id="cb327-39"><a href="working-with-shiny.html#cb327-39"></a>    <span class="cf">if</span>(input<span class="op">$</span>dataset <span class="op">==</span><span class="st"> &quot;First&quot;</span>)</span>
<span id="cb327-40"><a href="working-with-shiny.html#cb327-40"></a>      data &lt;-<span class="st"> </span>arcs1</span>
<span id="cb327-41"><a href="working-with-shiny.html#cb327-41"></a>    <span class="cf">else</span></span>
<span id="cb327-42"><a href="working-with-shiny.html#cb327-42"></a>      data &lt;-<span class="st"> </span>arcs2</span>
<span id="cb327-43"><a href="working-with-shiny.html#cb327-43"></a>    </span>
<span id="cb327-44"><a href="working-with-shiny.html#cb327-44"></a>    <span class="kw">gio_send_data</span>(<span class="st">&quot;globe&quot;</span>, data)</span>
<span id="cb327-45"><a href="working-with-shiny.html#cb327-45"></a>  })</span>
<span id="cb327-46"><a href="working-with-shiny.html#cb327-46"></a></span>
<span id="cb327-47"><a href="working-with-shiny.html#cb327-47"></a>}</span>
<span id="cb327-48"><a href="working-with-shiny.html#cb327-48"></a></span>
<span id="cb327-49"><a href="working-with-shiny.html#cb327-49"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
</div>
</div>
<div id="proxy-function" class="section level2 unnumbered" number="">
<h2>Proxy Function</h2>
<p>While the function <code>gio_send_data</code> created in the previous function works it can be improved upon as currently users will undergo a repetitive pattern: having to pass the id of the visualisation to send the data to every time, for every such function (we only implemented <code>addData</code> but many more can be added, e.g.: <code>setStyle</code> to change style on the fly).</p>
<p>This can be remedied to by creating what is often referred to as a “proxy.” A proxy is a representation of the graph, or pragmatically, an object that contains the id of the visualisation. This object can subsequently be piped to other functions thereby providing not only a cleaner but also a more consistent API. The point being, every such function will require the <code>id</code> of the chart and the shiny <code>session</code>, these can be further abstracted (don’t repeat yourself - DRY principle).</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="working-with-shiny.html#cb328-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb328-2"><a href="working-with-shiny.html#cb328-2"></a>gio_proxy &lt;-<span class="st"> </span><span class="cf">function</span>(id, <span class="dt">session =</span> shiny<span class="op">::</span><span class="kw">getDefaultReactiveDomain</span>()){</span>
<span id="cb328-3"><a href="working-with-shiny.html#cb328-3"></a>  <span class="kw">list</span>(<span class="dt">id =</span> id, <span class="dt">session =</span> session)</span>
<span id="cb328-4"><a href="working-with-shiny.html#cb328-4"></a>}</span></code></pre></div>
<p>Above we create a function called <code>gio_proxy</code> which takes the <code>id</code> of the chart one wants to build a proxy off, as well as the shiny <code>session</code>, there are returned in the form of a list. Next, we should adapt the <code>gio_send_data</code> so that it accepts the output of <code>gioProxy</code>.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="working-with-shiny.html#cb329-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb329-2"><a href="working-with-shiny.html#cb329-2"></a>gio_send_data &lt;-<span class="st"> </span><span class="cf">function</span>(proxy, data){</span>
<span id="cb329-3"><a href="working-with-shiny.html#cb329-3"></a>  message &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">id =</span> proxy<span class="op">$</span>id, <span class="dt">data =</span> <span class="kw">apply</span>(data, <span class="dv">1</span>, as.list))</span>
<span id="cb329-4"><a href="working-with-shiny.html#cb329-4"></a>  proxy<span class="op">$</span>session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;send-data&quot;</span>, message)</span>
<span id="cb329-5"><a href="working-with-shiny.html#cb329-5"></a>  <span class="kw">return</span>(proxy)</span>
<span id="cb329-6"><a href="working-with-shiny.html#cb329-6"></a>}</span></code></pre></div>
</div>
<div id="clear-data" class="section level2 unnumbered" number="">
<h2>Clear Data</h2>
<p>In order to actively demonstrate the advantage of the “proxy” function as well as to hammer home how such functions work, we shall build another which removes all data from the globe. In JavaScript it’s as simple as <code>controller.clearData();</code>.</p>
<p>The journey starts in R where we create a new function that sends a message to clear the data, the message only needs to contain the id of the visualisation from which data needs to be cleared, it will be used to retrieve the <code>controller</code> from which the <code>clearData</code> method is available.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="working-with-shiny.html#cb330-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb330-2"><a href="working-with-shiny.html#cb330-2"></a>gio_clear_data &lt;-<span class="st"> </span><span class="cf">function</span>(proxy){</span>
<span id="cb330-3"><a href="working-with-shiny.html#cb330-3"></a>  message &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">id =</span> proxy<span class="op">$</span>id)</span>
<span id="cb330-4"><a href="working-with-shiny.html#cb330-4"></a>  proxy<span class="op">$</span>session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;clear-data&quot;</span>, message)</span>
<span id="cb330-5"><a href="working-with-shiny.html#cb330-5"></a>  <span class="kw">return</span>(proxy)</span>
<span id="cb330-6"><a href="working-with-shiny.html#cb330-6"></a>}</span></code></pre></div>
<p>The message being sent from R, all that is missing the JavaScript code to catch that message and actually clear the data from the globe. That function is very similar to what was previously shown, the only difference is the name of the message handler and the method used (<code>clearData</code>).</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb331-1"><a href="working-with-shiny.html#cb331-1"></a><span class="co">// gio.js</span></span>
<span id="cb331-2"><a href="working-with-shiny.html#cb331-2"></a>Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(type <span class="op">=</span> <span class="st">&#39;clear-data&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) {</span>
<span id="cb331-3"><a href="working-with-shiny.html#cb331-3"></a>  <span class="kw">var</span> controller <span class="op">=</span> get_gio(message<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb331-4"><a href="working-with-shiny.html#cb331-4"></a>  controller<span class="op">.</span><span class="fu">clearData</span>()<span class="op">;</span></span>
<span id="cb331-5"><a href="working-with-shiny.html#cb331-5"></a>})<span class="op">;</span></span></code></pre></div>
<p>Then one can build an application to test that new function. We build a shiny application with a button to add the data to the visualisation and another to clear data from it.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="working-with-shiny.html#cb332-1"></a><span class="kw">library</span>(gio)</span>
<span id="cb332-2"><a href="working-with-shiny.html#cb332-2"></a><span class="kw">library</span>(shiny)</span>
<span id="cb332-3"><a href="working-with-shiny.html#cb332-3"></a></span>
<span id="cb332-4"><a href="working-with-shiny.html#cb332-4"></a><span class="co"># phoney dataset</span></span>
<span id="cb332-5"><a href="working-with-shiny.html#cb332-5"></a>arcs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb332-6"><a href="working-with-shiny.html#cb332-6"></a>  <span class="dt">e =</span> <span class="kw">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>),</span>
<span id="cb332-7"><a href="working-with-shiny.html#cb332-7"></a>  <span class="dt">i =</span> <span class="kw">c</span>(<span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>, <span class="st">&quot;US&quot;</span>),</span>
<span id="cb332-8"><a href="working-with-shiny.html#cb332-8"></a>  <span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">130</span>)</span>
<span id="cb332-9"><a href="working-with-shiny.html#cb332-9"></a>)</span>
<span id="cb332-10"><a href="working-with-shiny.html#cb332-10"></a></span>
<span id="cb332-11"><a href="working-with-shiny.html#cb332-11"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb332-12"><a href="working-with-shiny.html#cb332-12"></a>  <span class="kw">actionButton</span>(<span class="st">&quot;load&quot;</span>, <span class="st">&quot;Load data&quot;</span>),</span>
<span id="cb332-13"><a href="working-with-shiny.html#cb332-13"></a>  <span class="kw">actionButton</span>(<span class="st">&quot;clear&quot;</span>, <span class="st">&quot;Clear data&quot;</span>),</span>
<span id="cb332-14"><a href="working-with-shiny.html#cb332-14"></a>  <span class="kw">gioOutput</span>(<span class="st">&quot;globe&quot;</span>)</span>
<span id="cb332-15"><a href="working-with-shiny.html#cb332-15"></a>)</span>
<span id="cb332-16"><a href="working-with-shiny.html#cb332-16"></a></span>
<span id="cb332-17"><a href="working-with-shiny.html#cb332-17"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</span>
<span id="cb332-18"><a href="working-with-shiny.html#cb332-18"></a></span>
<span id="cb332-19"><a href="working-with-shiny.html#cb332-19"></a>  output<span class="op">$</span>globe &lt;-<span class="st"> </span><span class="kw">renderGio</span>({</span>
<span id="cb332-20"><a href="working-with-shiny.html#cb332-20"></a>    <span class="kw">gio</span>(arcs)</span>
<span id="cb332-21"><a href="working-with-shiny.html#cb332-21"></a>  })</span>
<span id="cb332-22"><a href="working-with-shiny.html#cb332-22"></a></span>
<span id="cb332-23"><a href="working-with-shiny.html#cb332-23"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>load, {</span>
<span id="cb332-24"><a href="working-with-shiny.html#cb332-24"></a>    <span class="kw">gio_proxy</span>(<span class="st">&quot;globe&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb332-25"><a href="working-with-shiny.html#cb332-25"></a><span class="st">      </span><span class="kw">gio_send_data</span>(arcs)</span>
<span id="cb332-26"><a href="working-with-shiny.html#cb332-26"></a>  })</span>
<span id="cb332-27"><a href="working-with-shiny.html#cb332-27"></a></span>
<span id="cb332-28"><a href="working-with-shiny.html#cb332-28"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>clear, {</span>
<span id="cb332-29"><a href="working-with-shiny.html#cb332-29"></a>    <span class="kw">gio_proxy</span>(<span class="st">&quot;globe&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb332-30"><a href="working-with-shiny.html#cb332-30"></a><span class="st">      </span><span class="kw">gio_clear_data</span>()</span>
<span id="cb332-31"><a href="working-with-shiny.html#cb332-31"></a>  })</span>
<span id="cb332-32"><a href="working-with-shiny.html#cb332-32"></a></span>
<span id="cb332-33"><a href="working-with-shiny.html#cb332-33"></a>}</span>
<span id="cb332-34"><a href="working-with-shiny.html#cb332-34"></a></span>
<span id="cb332-35"><a href="working-with-shiny.html#cb332-35"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="figure">
<img src="images/gio-shiny-clear.png" alt="" />
<p class="caption">Gio with clear data proxy</p>
</div>
</div>
<div id="update" class="section level2 unnumbered" number="">
<h2>Update</h2>
<p>The previous proxies defined worked for reason unbeknownst to the author of this book. It will not work with all methods. The reason it will not work is one that is likely to occur with many other visualisation libraries. For instance, one can attempt to develop a function to dynamically change style (theme) without having to redraw the entire getGlobe, starting again with the R function.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="working-with-shiny.html#cb333-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb333-2"><a href="working-with-shiny.html#cb333-2"></a>gio_set_style &lt;-<span class="st"> </span><span class="cf">function</span>(proxy, style){</span>
<span id="cb333-3"><a href="working-with-shiny.html#cb333-3"></a>  message &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">id =</span> proxy<span class="op">$</span>id, <span class="dt">style =</span> style)</span>
<span id="cb333-4"><a href="working-with-shiny.html#cb333-4"></a>  proxy<span class="op">$</span>session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">&quot;set-style&quot;</span>, message)</span>
<span id="cb333-5"><a href="working-with-shiny.html#cb333-5"></a>  <span class="kw">return</span>(proxy)</span>
<span id="cb333-6"><a href="working-with-shiny.html#cb333-6"></a>}</span></code></pre></div>
<p>Then add the JavaScript handler.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb334-1"><a href="working-with-shiny.html#cb334-1"></a>Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(type <span class="op">=</span> <span class="st">&#39;set-style&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) {</span>
<span id="cb334-2"><a href="working-with-shiny.html#cb334-2"></a>  <span class="kw">var</span> controller <span class="op">=</span> get_gio(message<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb334-3"><a href="working-with-shiny.html#cb334-3"></a>  controller<span class="op">.</span><span class="fu">setStyle</span>(message<span class="op">.</span><span class="at">style</span>)<span class="op">;</span></span>
<span id="cb334-4"><a href="working-with-shiny.html#cb334-4"></a>})<span class="op">;</span></span></code></pre></div>
<p>At this stage one can try the function in a shiny application but it will not work reason being that most such methods that change underlying aspects of a visualisation will not be reflected in real time. Gio.js, and many other libraries, will require one to explicitly call a method to update the chart. This has multiple advantages, one can stack multiple visual changes to execute them at the same time, and one can manage the load on the front-end. Therefore JavaScript visualisation libraries will often provide an “update” method.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb335-1"><a href="working-with-shiny.html#cb335-1"></a>Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(type <span class="op">=</span> <span class="st">&#39;set-style&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) {</span>
<span id="cb335-2"><a href="working-with-shiny.html#cb335-2"></a>  <span class="kw">var</span> controller <span class="op">=</span> get_gio(message<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb335-3"><a href="working-with-shiny.html#cb335-3"></a>  controller<span class="op">.</span><span class="fu">setStyle</span>(message<span class="op">.</span><span class="at">style</span>)<span class="op">;</span></span>
<span id="cb335-4"><a href="working-with-shiny.html#cb335-4"></a>  controller<span class="op">.</span><span class="fu">update</span>()<span class="op">;</span> <span class="co">// force update the visualisation</span></span>
<span id="cb335-5"><a href="working-with-shiny.html#cb335-5"></a>})<span class="op">;</span></span></code></pre></div>
<p>This forces the chart to update, applying the new style.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="working-with-shiny.html#cb336-1"></a><span class="kw">library</span>(gio)</span>
<span id="cb336-2"><a href="working-with-shiny.html#cb336-2"></a><span class="kw">library</span>(shiny)</span>
<span id="cb336-3"><a href="working-with-shiny.html#cb336-3"></a></span>
<span id="cb336-4"><a href="working-with-shiny.html#cb336-4"></a><span class="co"># two phoney datasets</span></span>
<span id="cb336-5"><a href="working-with-shiny.html#cb336-5"></a>arcs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb336-6"><a href="working-with-shiny.html#cb336-6"></a>  <span class="dt">e =</span> <span class="kw">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>),</span>
<span id="cb336-7"><a href="working-with-shiny.html#cb336-7"></a>  <span class="dt">i =</span> <span class="kw">c</span>(<span class="st">&quot;CN&quot;</span>, <span class="st">&quot;RU&quot;</span>, <span class="st">&quot;US&quot;</span>),</span>
<span id="cb336-8"><a href="working-with-shiny.html#cb336-8"></a>  <span class="dt">v =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">130</span>)</span>
<span id="cb336-9"><a href="working-with-shiny.html#cb336-9"></a>)</span>
<span id="cb336-10"><a href="working-with-shiny.html#cb336-10"></a></span>
<span id="cb336-11"><a href="working-with-shiny.html#cb336-11"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb336-12"><a href="working-with-shiny.html#cb336-12"></a>  <span class="kw">selectInput</span>(</span>
<span id="cb336-13"><a href="working-with-shiny.html#cb336-13"></a>    <span class="st">&quot;style&quot;</span>, </span>
<span id="cb336-14"><a href="working-with-shiny.html#cb336-14"></a>    <span class="st">&quot;Select a style&quot;</span>, </span>
<span id="cb336-15"><a href="working-with-shiny.html#cb336-15"></a>    <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;blueInk&quot;</span>, <span class="st">&quot;earlySpring&quot;</span>)</span>
<span id="cb336-16"><a href="working-with-shiny.html#cb336-16"></a>  ),</span>
<span id="cb336-17"><a href="working-with-shiny.html#cb336-17"></a>  <span class="kw">gioOutput</span>(<span class="st">&quot;globe&quot;</span>)</span>
<span id="cb336-18"><a href="working-with-shiny.html#cb336-18"></a>)</span>
<span id="cb336-19"><a href="working-with-shiny.html#cb336-19"></a></span>
<span id="cb336-20"><a href="working-with-shiny.html#cb336-20"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){</span>
<span id="cb336-21"><a href="working-with-shiny.html#cb336-21"></a>  output<span class="op">$</span>globe &lt;-<span class="st"> </span><span class="kw">renderGio</span>({</span>
<span id="cb336-22"><a href="working-with-shiny.html#cb336-22"></a>    <span class="kw">gio</span>(arcs1)</span>
<span id="cb336-23"><a href="working-with-shiny.html#cb336-23"></a>  })</span>
<span id="cb336-24"><a href="working-with-shiny.html#cb336-24"></a></span>
<span id="cb336-25"><a href="working-with-shiny.html#cb336-25"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>style, {</span>
<span id="cb336-26"><a href="working-with-shiny.html#cb336-26"></a>    <span class="kw">gio_proxy</span>(<span class="st">&quot;globe&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb336-27"><a href="working-with-shiny.html#cb336-27"></a><span class="st">      </span><span class="kw">gio_set_style</span>(input<span class="op">$</span>style)</span>
<span id="cb336-28"><a href="working-with-shiny.html#cb336-28"></a>  })</span>
<span id="cb336-29"><a href="working-with-shiny.html#cb336-29"></a></span>
<span id="cb336-30"><a href="working-with-shiny.html#cb336-30"></a>}</span>
<span id="cb336-31"><a href="working-with-shiny.html#cb336-31"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="figure">
<img src="images/gio-shiny-style.png" alt="" />
<p class="caption">Gio with dynamic style</p>
</div>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="advanced-topics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ploty.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/JohnCoene/javascript-for-r/edit/master/25-htmlwidgets-shiny.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
