# (PART) Data Visualisation {-}

# Introduction to Widgets {#widgets-intro-intro}

This part of the book explores the integration of JavaScript with R using the htmlwidgets package which focuses on libraries that produce a visual output, it is often used for data visualisation but is not limited to it.

As in future parts of this book we mainly learn through examples, building multiple widgets of increasing complexity as we progress through the chapters. Before writing the first widget, we explore existing R packages that allow creating interactive data visualisations as this gives a first glimpse at we build in this part of the book. Then we explore JavaScript libraries that make great candidates for htmlwidgets and attempt to understand how they work to grasp what is expected from the developer in order to integrate them with R. Finally, we build up on the previous chapter to improve how htmlwidgets work with shiny.

The htmlwidgets package originates from the rCharts [@R-rCharts] package created in 2012 by Ramnath Vaidyanathan. It brough together a plethora of data visualisation JavaScript libraries, datamaps, highcharts, morris.js, and many more. Though no longer maintained rCharts ultimately paved the way towards a framework for interactive visualisations in R: two years later, in 2014 Ramnath and other prominent R users start working on htmlwidgets.

The objective of this chapter is to explore existing widgets available on CRAN, discover how they work, whilst focusing on their prominent features as we will learn how to implement those in our very own widget in the coming chapters.

## Plotly package {#widgets-plotly}

The plotly [@R-plotly] R package is probably one of the first and the most popular widget built thus far, it has been downloaded from CRAN 4.9 million times at the time of writing this. 

Plotly.js is a substantial library that provides over 40 chart types, including 3D charts, statistical graphs, and maps, all of which are available from the R interface, there is in fact so much depth to plotly that there is an entire [book](https://plotly-r.com/) on the topic.

```{r}
library(plotly)

plot_ly(cars, x = ~speed, y = ~dist) %>% 
  add_markers()
```

Plotly also has the ability to translate static ggplot2 [@R-ggplot2] charts to interactive plotly charts with the `ggplotly` function.

```{r}
p <- ggplot(diamonds, aes(x = log(carat), y = log(price))) + 
  geom_hex(bins = 100)
ggplotly(p)
```

All plotly charts are initialised with the `plot_ly` function and work nicely with the magrittr [@R-magrittr] pipe `%>%`. This implies that (almost) every function expects a plotly object (the output of `plot_ly`) and returns a modified version of that object. The pipe makes code easier to read and more concise.

```{r}
p <- plot_ly(cars, x = ~speed, y = ~dist) 
p <- add_markers(p)
```

Plotly implements geoms in a similar fashion as ggplot2, functions that start in `add_` add a layer to the plot (e.g.: `add_lines`, `add_bars`).

```{r}
plot_ly(mtcars, x = ~disp) %>% 
  add_markers(y = ~mpg, text = rownames(mtcars)) %>% 
  add_lines(y = ~fitted(loess(mpg ~ disp)))
```

## DT package {#widgets-intro-dt}

The DT package [@R-DT] is a wrapper for the [DataTables](https://datatables.net/) jQuery plug-in which allows creating interactive tables from R `data.frame` objects.

```{r}
DT::datatable(cars)
```
