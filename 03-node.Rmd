# Node.js with Bubble {#node}

_This chapter is incomplete because a core dependency of {bubble} was removed from CRAN, this chapter will likely be removed entirely_

A more recent R package called bubble allows running node.js code from R, the package comes with an REPL and an R markdown engine. As it is still under heavy development it is not yet available on CRAN, it can be installed from Github using either the devtools or [remotes package](https://remotes.r-lib.org/) [@R-remotes].

```r
# install.packages("remotes")
remotes::install_github("ColinFay/bubble")
```

## Basics {-}

bubble is very similar to V8, it's also a reference class and the name of the methods are identical.

```{r node-basics-load}
library(bubble)

n <- NodeSession$new()
n$eval("2 + 2;")
```

You can also assign and get variables, just like with v8.

```{r}
n$assign(vehicles, cars[1:2, ])
n$get(vehicles)
```

Bubble also comes with an REPL terminal (read-eval-print loop), which can be launched with `bubble::node_repl()`.

## R Markdown Engine {-}

Bubble comes with an R markdown engine so JavaScript code can be evaluated in node from an R markdown document such as this one. To do so we simply need to place `bubble::set_node_engine()` at the top of the document, subsequent `node` chunks will be evaluated in a node session.

```{r}
bubble::set_node_engine()
```

Once set we can run node code.

```{node}
console.log(2 + 3);
```

## Npm {-}

Npm is to node.js what CRAN is to R; a repository of packages that can be conveniently installed. Such packages can be installed using another Reference class called `NPM`. While with V8 one needs to "browserify" npm packages in hope that they work, with bubble, since it interacts with node js directly, there is no need for to "browserify" packages and we can be assured that they work.

Let us demonstrate with the [natural](https://github.com/NaturalNode/natural) package which provides general natural language facility. 

```{r}
# initialise and install
npm <- Npm$new()$install("natural")
```

The above snippet initialises npm, which creates the pacakge.json file and a node_modules directory. The first is a DESCRIPTION file for node projects so to speak, the latter is a directory to hold dependencies installed.

The packages can then be imported in the node session and interacted with.

```{r}
n$eval("const natural = require('natural')")
n$eval("var tokenizer = new natural.WordTokenizer();")
n$eval("var words = tokenizer.tokenize('Using nodejs from R with npm.')")
n$get("words")
```

We initialised a tokeniser then used its `tokenize` method to split the sentence into an array of words.
